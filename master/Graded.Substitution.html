<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">import</a> <a id="228" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="283" class="Keyword">module</a> <a id="290" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="312" class="Symbol">{</a><a id="313" href="Graded.Substitution.html#313" class="Bound">a</a><a id="314" class="Symbol">}</a> <a id="316" class="Symbol">{</a><a id="317" href="Graded.Substitution.html#317" class="Bound">M</a> <a id="319" class="Symbol">:</a> <a id="321" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="325" href="Graded.Substitution.html#313" class="Bound">a</a><a id="326" class="Symbol">}</a>
  <a id="330" class="Symbol">(</a><a id="331" class="Keyword">open</a> <a id="336" href="Graded.Modality.html" class="Module">Graded.Modality</a> <a id="352" href="Graded.Substitution.html#317" class="Bound">M</a><a id="353" class="Symbol">)</a>
  <a id="357" class="Symbol">(</a><a id="358" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="360" class="Symbol">:</a> <a id="362" href="Graded.Modality.html#7127" class="Record">Modality</a><a id="370" class="Symbol">)</a>
  <a id="374" class="Symbol">(</a><a id="375" href="Graded.Substitution.html#375" class="Bound">R</a> <a id="377" class="Symbol">:</a> <a id="379" href="Graded.Usage.Restrictions.html#688" class="Record">Usage-restrictions</a> <a id="398" href="Graded.Substitution.html#358" class="Bound">𝕄</a><a id="399" class="Symbol">)</a>
  <a id="403" class="Keyword">where</a>

<a id="410" class="Keyword">open</a> <a id="415" href="Graded.Modality.html#7127" class="Module">Modality</a> <a id="424" href="Graded.Substitution.html#358" class="Bound">𝕄</a>

<a id="427" class="Keyword">open</a> <a id="432" class="Keyword">import</a> <a id="439" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="458" href="Graded.Substitution.html#317" class="Bound">M</a>
  <a id="462" class="Keyword">using</a> <a id="468" class="Symbol">(</a><a id="469" href="Definition.Untyped.html#15962" class="Function">Subst</a> <a id="475" class="Symbol">;</a> <a id="477" href="Definition.Untyped.html#16728" class="Function">tail</a> <a id="482" class="Symbol">;</a> <a id="484" href="Definition.Untyped.html#16545" class="Function">head</a> <a id="489" class="Symbol">;</a> <a id="491" href="Definition.Untyped.NotParametrised.html#2207" class="Datatype">Wk</a> <a id="494" class="Symbol">;</a> <a id="496" href="Definition.Untyped.NotParametrised.html#2236" class="InductiveConstructor">id</a> <a id="499" class="Symbol">;</a> <a id="501" href="Definition.Untyped.NotParametrised.html#2300" class="InductiveConstructor">step</a> <a id="506" class="Symbol">;</a> <a id="508" href="Definition.Untyped.NotParametrised.html#2389" class="InductiveConstructor">lift</a><a id="512" class="Symbol">)</a>
<a id="514" class="Keyword">open</a> <a id="519" class="Keyword">import</a> <a id="526" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="541" href="Graded.Substitution.html#358" class="Bound">𝕄</a>
<a id="543" class="Keyword">open</a> <a id="548" class="Keyword">import</a> <a id="555" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="568" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="570" href="Graded.Substitution.html#375" class="Bound">R</a>
<a id="572" class="Keyword">open</a> <a id="577" class="Keyword">import</a> <a id="584" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="607" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="609" href="Graded.Substitution.html#375" class="Bound">R</a>
<a id="611" class="Keyword">open</a> <a id="616" class="Keyword">import</a> <a id="623" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="635" href="Graded.Substitution.html#358" class="Bound">𝕄</a>

<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="660" class="Keyword">open</a> <a id="665" class="Keyword">import</a> <a id="672" href="Tools.Nat.html" class="Module">Tools.Nat</a> <a id="682" class="Keyword">using</a> <a id="688" class="Symbol">(</a><a id="689" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a><a id="692" class="Symbol">;</a> <a id="694" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a><a id="696" class="Symbol">)</a>

<a id="699" class="Keyword">infixl</a> <a id="706" class="Number">50</a> <a id="709" href="Graded.Substitution.html#1366" class="Function Operator">_&lt;*_</a>
<a id="714" class="Keyword">infixr</a> <a id="721" class="Number">50</a> <a id="724" href="Graded.Substitution.html#1221" class="Function Operator">_*&gt;_</a>
<a id="729" class="Keyword">infix</a>  <a id="736" class="Number">20</a> <a id="739" href="Graded.Substitution.html#2108" class="Function Operator">∥_∥</a>
<a id="743" class="Keyword">infixl</a> <a id="750" class="Number">30</a> <a id="753" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a>

<a id="758" class="Keyword">private</a>
  <a id="768" class="Keyword">variable</a>
    <a id="781" href="Graded.Substitution.html#781" class="Generalizable">k</a> <a id="783" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="785" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="787" class="Symbol">:</a> <a id="789" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a>

<a id="794" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>
<a id="872" class="Comment">-- Ψ : Substₘ m n is an n×m-matrix.</a>

<a id="909" class="Keyword">data</a> <a id="Substₘ"></a><a id="914" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="921" class="Symbol">:</a> <a id="923" class="Symbol">(</a><a id="924" href="Graded.Substitution.html#924" class="Bound">m</a> <a id="926" href="Graded.Substitution.html#926" class="Bound">n</a> <a id="928" class="Symbol">:</a> <a id="930" href="Agda.Builtin.Nat.html#203" class="Datatype">Nat</a><a id="933" class="Symbol">)</a> <a id="935" class="Symbol">→</a> <a id="937" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="941" href="Graded.Substitution.html#313" class="Bound">a</a> <a id="943" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="951" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>  <a id="955" class="Symbol">:</a> <a id="957" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="964" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="966" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="970" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a> <a id="974" class="Symbol">:</a> <a id="976" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="983" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="985" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="987" class="Symbol">→</a> <a id="989" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="994" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="996" class="Symbol">→</a> <a id="998" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1005" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1007" class="Symbol">(</a><a id="1008" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="1011" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1012" class="Symbol">)</a>

<a id="1015" class="Keyword">private</a>
  <a id="1025" class="Keyword">variable</a>
    <a id="1038" href="Graded.Substitution.html#1038" class="Generalizable">Ψ</a> <a id="1040" href="Graded.Substitution.html#1040" class="Generalizable">Φ</a> <a id="1042" class="Symbol">:</a> <a id="1044" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1051" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1053" href="Graded.Substitution.html#785" class="Generalizable">n</a>

<a id="1056" class="Comment">-- Substitutions that contain empty usage contexts.</a>

<a id="εₘ"></a><a id="1109" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1121" class="Number">0</a> <a id="1123" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1125" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1128" class="Symbol">{</a><a id="1129" class="Argument">n</a> <a id="1131" class="Symbol">=</a> <a id="1133" class="Number">0</a><a id="1134" class="Symbol">}</a>    <a id="1139" class="Symbol">=</a> <a id="1141" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="1144" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1147" class="Symbol">{</a><a id="1148" class="Argument">n</a> <a id="1150" class="Symbol">=</a> <a id="1152" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="1155" href="Graded.Substitution.html#1155" class="Bound">n</a><a id="1156" class="Symbol">}</a> <a id="1158" class="Symbol">=</a> <a id="1160" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1163" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1165" href="Graded.Context.html#719" class="InductiveConstructor">ε</a>

<a id="1168" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1221" href="Graded.Substitution.html#1221" class="Function Operator">_*&gt;_</a> <a id="1226" class="Symbol">:</a> <a id="1228" class="Symbol">(</a><a id="1229" href="Graded.Substitution.html#1229" class="Bound">Ψ</a> <a id="1231" class="Symbol">:</a> <a id="1233" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1240" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1242" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1243" class="Symbol">)</a> <a id="1245" class="Symbol">→</a> <a id="1247" class="Symbol">(</a><a id="1248" href="Graded.Substitution.html#1248" class="Bound">γ</a> <a id="1250" class="Symbol">:</a> <a id="1252" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1257" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="1258" class="Symbol">)</a> <a id="1260" class="Symbol">→</a> <a id="1262" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1267" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1269" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1272" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1275" href="Graded.Substitution.html#1275" class="Bound">γ</a> <a id="1277" class="Symbol">=</a> <a id="1279" href="Graded.Context.html#719" class="InductiveConstructor">ε</a>
<a id="1281" class="Symbol">(</a><a id="1282" href="Graded.Substitution.html#1282" class="Bound">Ψ</a> <a id="1284" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1286" href="Graded.Substitution.html#1286" class="Bound">δ</a><a id="1287" class="Symbol">)</a> <a id="1289" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1292" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1294" class="Symbol">=</a> <a id="1296" href="Graded.Substitution.html#1282" class="Bound">Ψ</a> <a id="1298" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1301" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1303" href="Graded.Context.html#734" class="InductiveConstructor Operator">∙</a> <a id="1305" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1307" href="Graded.Context.html#1390" class="Function Operator">*</a> <a id="1309" href="Graded.Substitution.html#1286" class="Bound">δ</a>

<a id="1312" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1366" href="Graded.Substitution.html#1366" class="Function Operator">_&lt;*_</a> <a id="1371" class="Symbol">:</a> <a id="1373" class="Symbol">(</a><a id="1374" href="Graded.Substitution.html#1374" class="Bound">γ</a> <a id="1376" class="Symbol">:</a> <a id="1378" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1383" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1384" class="Symbol">)</a> <a id="1386" class="Symbol">→</a> <a id="1388" class="Symbol">(</a><a id="1389" href="Graded.Substitution.html#1389" class="Bound">Ψ</a> <a id="1391" class="Symbol">:</a> <a id="1393" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1400" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1402" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1403" class="Symbol">)</a> <a id="1405" class="Symbol">→</a> <a id="1407" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1412" href="Graded.Substitution.html#783" class="Generalizable">m</a>
<a id="1414" href="Graded.Context.html#719" class="InductiveConstructor">ε</a> <a id="1416" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1419" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1422" class="Symbol">=</a> <a id="1424" href="Graded.Context.html#2498" class="Function">𝟘ᶜ</a>
<a id="1427" class="Symbol">(</a><a id="1428" href="Graded.Substitution.html#1428" class="Bound">γ</a> <a id="1430" href="Graded.Context.html#734" class="InductiveConstructor Operator">∙</a> <a id="1432" href="Graded.Substitution.html#1432" class="Bound">p</a><a id="1433" class="Symbol">)</a> <a id="1435" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1438" class="Symbol">(</a><a id="1439" href="Graded.Substitution.html#1439" class="Bound">Ψ</a> <a id="1441" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1443" href="Graded.Substitution.html#1443" class="Bound">δ</a><a id="1444" class="Symbol">)</a> <a id="1446" class="Symbol">=</a> <a id="1448" href="Graded.Substitution.html#1432" class="Bound">p</a> <a id="1450" href="Graded.Context.html#1733" class="Function Operator">·ᶜ</a> <a id="1453" href="Graded.Substitution.html#1443" class="Bound">δ</a> <a id="1455" href="Graded.Context.html#1501" class="Function Operator">+ᶜ</a> <a id="1458" class="Symbol">(</a><a id="1459" href="Graded.Substitution.html#1428" class="Bound">γ</a> <a id="1461" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1464" href="Graded.Substitution.html#1439" class="Bound">Ψ</a><a id="1465" class="Symbol">)</a>

<a id="substₘ"></a><a id="1468" href="Graded.Substitution.html#1468" class="Function">substₘ</a> <a id="1475" class="Symbol">:</a> <a id="1477" class="Symbol">(</a><a id="1478" href="Graded.Substitution.html#1478" class="Bound">Ψ</a> <a id="1480" class="Symbol">:</a> <a id="1482" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1489" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1491" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1492" class="Symbol">)</a> <a id="1494" class="Symbol">→</a> <a id="1496" class="Symbol">(</a><a id="1497" href="Graded.Substitution.html#1497" class="Bound">γ</a> <a id="1499" class="Symbol">:</a> <a id="1501" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1506" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1507" class="Symbol">)</a> <a id="1509" class="Symbol">→</a> <a id="1511" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="1516" href="Graded.Substitution.html#783" class="Generalizable">m</a>
<a id="1518" href="Graded.Substitution.html#1468" class="Function">substₘ</a> <a id="1525" href="Graded.Substitution.html#1525" class="Bound">Ψ</a> <a id="1527" href="Graded.Substitution.html#1527" class="Bound">γ</a> <a id="1529" class="Symbol">=</a> <a id="1531" href="Graded.Substitution.html#1527" class="Bound">γ</a> <a id="1533" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1536" href="Graded.Substitution.html#1525" class="Bound">Ψ</a>

<a id="1539" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1580" href="Graded.Substitution.html#1580" class="Function Operator">_&lt;*&gt;_</a> <a id="1586" class="Symbol">:</a> <a id="1588" class="Symbol">(</a><a id="1589" href="Graded.Substitution.html#1589" class="Bound">Ψ</a> <a id="1591" class="Symbol">:</a> <a id="1593" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1600" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1602" href="Graded.Substitution.html#781" class="Generalizable">k</a><a id="1603" class="Symbol">)</a> <a id="1605" class="Symbol">(</a><a id="1606" href="Graded.Substitution.html#1606" class="Bound">Φ</a> <a id="1608" class="Symbol">:</a> <a id="1610" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1617" href="Graded.Substitution.html#781" class="Generalizable">k</a> <a id="1619" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1620" class="Symbol">)</a> <a id="1622" class="Symbol">→</a> <a id="1624" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1631" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1633" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1635" href="Graded.Substitution.html#1635" class="Bound">Ψ</a> <a id="1637" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1641" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1644" class="Symbol">=</a> <a id="1646" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="1649" href="Graded.Substitution.html#1649" class="Bound">Ψ</a> <a id="1651" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1655" class="Symbol">(</a><a id="1656" href="Graded.Substitution.html#1656" class="Bound">Φ</a> <a id="1658" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1660" href="Graded.Substitution.html#1660" class="Bound">δ</a><a id="1661" class="Symbol">)</a> <a id="1663" class="Symbol">=</a> <a id="1665" class="Symbol">(</a><a id="1666" href="Graded.Substitution.html#1649" class="Bound">Ψ</a> <a id="1668" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1672" href="Graded.Substitution.html#1656" class="Bound">Φ</a><a id="1673" class="Symbol">)</a> <a id="1675" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1677" class="Symbol">(</a><a id="1678" href="Graded.Substitution.html#1660" class="Bound">δ</a> <a id="1680" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1683" href="Graded.Substitution.html#1649" class="Bound">Ψ</a><a id="1684" class="Symbol">)</a>

<a id="1687" class="Comment">---------------------------------------------------------------</a>

<a id="1752" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1823" class="Comment">-- γ_x is the x-th row vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1887" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1903" href="Graded.Substitution.html#1903" class="Function Operator">_▶[_]_</a> <a id="1910" class="Symbol">:</a> <a id="1912" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1919" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1921" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1923" class="Symbol">→</a> <a id="1925" href="Graded.Mode.html#5856" class="Function">Mode-vector</a> <a id="1937" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1939" class="Symbol">→</a> <a id="1941" href="Definition.Untyped.html#15962" class="Function">Subst</a> <a id="1947" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1949" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1951" class="Symbol">→</a> <a id="1953" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1957" href="Graded.Substitution.html#313" class="Bound">a</a>
<a id="1959" href="Graded.Substitution.html#1903" class="Function Operator">_▶[_]_</a> <a id="1966" class="Symbol">{</a><a id="1967" class="Argument">n</a> <a id="1969" class="Symbol">=</a> <a id="1971" href="Graded.Substitution.html#1971" class="Bound">n</a><a id="1972" class="Symbol">}</a> <a id="1974" href="Graded.Substitution.html#1974" class="Bound">Ψ</a> <a id="1976" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="1978" href="Graded.Substitution.html#1978" class="Bound">σ</a> <a id="1980" class="Symbol">=</a>
  <a id="1984" class="Symbol">(</a><a id="1985" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="1987" class="Symbol">:</a> <a id="1989" href="Data.Fin.Base.html#1154" class="Datatype">Fin</a> <a id="1993" href="Graded.Substitution.html#1971" class="Bound">n</a><a id="1994" class="Symbol">)</a> <a id="1996" class="Symbol">→</a> <a id="1998" class="Symbol">((</a><a id="2000" href="Graded.Context.html#2498" class="Function">𝟘ᶜ</a> <a id="2003" href="Graded.Context.html#1107" class="Function Operator">,</a> <a id="2005" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2007" href="Graded.Context.html#1107" class="Function Operator">≔</a> <a id="2009" href="Graded.Mode.html#4918" class="Function Operator">⌜</a> <a id="2011" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="2013" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2015" href="Graded.Mode.html#4918" class="Function Operator">⌝</a><a id="2016" class="Symbol">)</a> <a id="2018" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="2021" href="Graded.Substitution.html#1974" class="Bound">Ψ</a><a id="2022" class="Symbol">)</a> <a id="2024" href="Graded.Usage.html#8181" class="Datatype Operator">▸[</a> <a id="2027" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="2029" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2031" href="Graded.Usage.html#8181" class="Datatype Operator">]</a> <a id="2033" href="Graded.Substitution.html#1978" class="Bound">σ</a> <a id="2035" href="Graded.Substitution.html#1985" class="Bound">x</a>

<a id="2038" class="Comment">-- Substitution matrix inference (for modalities with nr functions).</a>

<a id="∥_∥"></a><a id="2108" href="Graded.Substitution.html#2108" class="Function Operator">∥_∥</a> <a id="2112" class="Symbol">:</a>
  <a id="2116" class="Symbol">⦃</a> <a id="2118" href="Graded.Substitution.html#2118" class="Bound">has-nr</a> <a id="2125" class="Symbol">:</a> <a id="2127" href="Graded.Modality.html#4596" class="Record">Has-nr</a> <a id="2134" href="Graded.Modality.html#7240" class="Function">semiring-with-meet</a> <a id="2153" class="Symbol">⦄</a> <a id="2155" class="Symbol">→</a>
  <a id="2159" href="Definition.Untyped.html#15962" class="Function">Subst</a> <a id="2165" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2167" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2169" class="Symbol">→</a> <a id="2171" href="Graded.Mode.html#5856" class="Function">Mode-vector</a> <a id="2183" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2185" class="Symbol">→</a> <a id="2187" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2194" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2196" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2198" href="Graded.Substitution.html#2108" class="Function Operator">∥_∥</a> <a id="2202" class="Symbol">{</a><a id="2203" class="Argument">n</a> <a id="2205" class="Symbol">=</a> <a id="2207" class="Number">0</a><a id="2208" class="Symbol">}</a>    <a id="2213" class="Symbol">_</a> <a id="2215" class="Symbol">_</a>  <a id="2218" class="Symbol">=</a> <a id="2220" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2223" href="Graded.Substitution.html#2108" class="Function Operator">∥_∥</a> <a id="2227" class="Symbol">{</a><a id="2228" class="Argument">n</a> <a id="2230" class="Symbol">=</a> <a id="2232" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="2235" href="Graded.Substitution.html#2235" class="Bound">n</a><a id="2236" class="Symbol">}</a> <a id="2238" href="Graded.Substitution.html#2238" class="Bound">σ</a> <a id="2240" href="Graded.Substitution.html#2240" class="Bound">ms</a> <a id="2243" class="Symbol">=</a> <a id="2245" href="Graded.Substitution.html#2108" class="Function Operator">∥</a> <a id="2247" href="Definition.Untyped.html#16728" class="Function">tail</a> <a id="2252" href="Graded.Substitution.html#2238" class="Bound">σ</a> <a id="2254" href="Graded.Substitution.html#2108" class="Function Operator">∥</a> <a id="2256" class="Symbol">(</a><a id="2257" href="Graded.Mode.html#6256" class="Function">tailᵐ</a> <a id="2263" href="Graded.Substitution.html#2240" class="Bound">ms</a><a id="2265" class="Symbol">)</a> <a id="2267" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2269" href="Graded.Usage.html#2172" class="Function Operator">⌈</a> <a id="2271" href="Definition.Untyped.html#16545" class="Function">head</a> <a id="2276" href="Graded.Substitution.html#2238" class="Bound">σ</a> <a id="2278" href="Graded.Usage.html#2172" class="Function Operator">⌉</a> <a id="2280" class="Symbol">(</a><a id="2281" href="Graded.Mode.html#6173" class="Function">headᵐ</a> <a id="2287" href="Graded.Substitution.html#2240" class="Bound">ms</a><a id="2289" class="Symbol">)</a>

<a id="2292" class="Comment">---------------------------------------------------------------</a>
<a id="2356" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2420" class="Comment">---------------------------------------------------------------</a>

<a id="2485" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2536" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="2546" class="Symbol">:</a> <a id="2548" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2555" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2557" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2559" class="Symbol">→</a> <a id="2561" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2568" class="Symbol">(</a><a id="2569" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="2572" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="2573" class="Symbol">)</a> <a id="2575" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2577" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="2587" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="2590" class="Symbol">=</a> <a id="2592" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2595" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="2605" class="Symbol">(</a><a id="2606" href="Graded.Substitution.html#2606" class="Bound">Ψ</a> <a id="2608" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2610" href="Graded.Substitution.html#2610" class="Bound">δ</a><a id="2611" class="Symbol">)</a> <a id="2613" class="Symbol">=</a> <a id="2615" class="Symbol">(</a><a id="2616" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="2626" href="Graded.Substitution.html#2606" class="Bound">Ψ</a><a id="2627" class="Symbol">)</a> <a id="2629" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2631" href="Graded.Usage.Weakening.html#1300" class="Function">wkConₘ</a> <a id="2638" class="Symbol">(</a><a id="2639" href="Definition.Untyped.NotParametrised.html#2300" class="InductiveConstructor">step</a> <a id="2644" href="Definition.Untyped.NotParametrised.html#2236" class="InductiveConstructor">id</a><a id="2646" class="Symbol">)</a> <a id="2648" href="Graded.Substitution.html#2610" class="Bound">δ</a>

<a id="2651" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2685" href="Graded.Substitution.html#2685" class="Function">liftSubstₘ</a> <a id="2696" class="Symbol">:</a> <a id="2698" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2705" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2707" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2709" class="Symbol">→</a> <a id="2711" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2718" class="Symbol">(</a><a id="2719" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="2722" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="2723" class="Symbol">)</a> <a id="2725" class="Symbol">(</a><a id="2726" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="2729" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="2730" class="Symbol">)</a>
<a id="2732" href="Graded.Substitution.html#2685" class="Function">liftSubstₘ</a> <a id="2743" href="Graded.Substitution.html#2743" class="Bound">Ψ</a> <a id="2745" class="Symbol">=</a> <a id="2747" class="Symbol">(</a><a id="2748" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="2758" href="Graded.Substitution.html#2743" class="Bound">Ψ</a><a id="2759" class="Symbol">)</a> <a id="2761" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2763" class="Symbol">(</a><a id="2764" href="Graded.Context.html#2498" class="Function">𝟘ᶜ</a> <a id="2767" href="Graded.Context.html#734" class="InductiveConstructor Operator">∙</a> <a id="2769" href="Graded.Modality.html#849" class="Function">𝟙</a><a id="2770" class="Symbol">)</a>

<a id="2773" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2806" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a> <a id="2815" class="Symbol">:</a> <a id="2817" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2824" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2826" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2828" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a> <a id="2837" class="Symbol">{</a><a id="2838" class="Argument">n</a> <a id="2840" class="Symbol">=</a> <a id="2842" class="Number">0</a><a id="2843" class="Symbol">}</a> <a id="2845" class="Symbol">=</a> <a id="2847" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2850" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a> <a id="2859" class="Symbol">{</a><a id="2860" class="Argument">n</a> <a id="2862" class="Symbol">=</a> <a id="2864" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="2867" href="Graded.Substitution.html#2867" class="Bound">n</a><a id="2868" class="Symbol">}</a> <a id="2870" class="Symbol">=</a> <a id="2872" href="Graded.Substitution.html#2685" class="Function">liftSubstₘ</a> <a id="2883" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a>

<a id="2893" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2934" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="2943" class="Symbol">:</a> <a id="2945" class="Symbol">(</a><a id="2946" href="Graded.Substitution.html#2946" class="Bound">ρ</a> <a id="2948" class="Symbol">:</a> <a id="2950" href="Definition.Untyped.NotParametrised.html#2207" class="Datatype">Wk</a> <a id="2953" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2955" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="2956" class="Symbol">)</a> <a id="2958" class="Symbol">→</a> <a id="2960" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2967" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2969" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2971" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="2980" href="Definition.Untyped.NotParametrised.html#2236" class="InductiveConstructor">id</a>       <a id="2989" class="Symbol">=</a> <a id="2991" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a>
<a id="3000" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="3009" class="Symbol">(</a><a id="3010" href="Definition.Untyped.NotParametrised.html#2300" class="InductiveConstructor">step</a> <a id="3015" href="Graded.Substitution.html#3015" class="Bound">ρ</a><a id="3016" class="Symbol">)</a> <a id="3018" class="Symbol">=</a> <a id="3020" href="Graded.Substitution.html#2536" class="Function">wk1Substₘ</a> <a id="3030" class="Symbol">(</a><a id="3031" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="3040" href="Graded.Substitution.html#3015" class="Bound">ρ</a><a id="3041" class="Symbol">)</a>
<a id="3043" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="3052" class="Symbol">(</a><a id="3053" href="Definition.Untyped.NotParametrised.html#2389" class="InductiveConstructor">lift</a> <a id="3058" href="Graded.Substitution.html#3058" class="Bound">ρ</a><a id="3059" class="Symbol">)</a> <a id="3061" class="Symbol">=</a> <a id="3063" href="Graded.Substitution.html#2685" class="Function">liftSubstₘ</a> <a id="3074" class="Symbol">(</a><a id="3075" href="Graded.Substitution.html#2934" class="Function">wkSubstₘ</a> <a id="3084" href="Graded.Substitution.html#3058" class="Bound">ρ</a><a id="3085" class="Symbol">)</a>

<a id="3088" class="Comment">------------------------------------------------------------------</a>
<a id="3155" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3222" class="Comment">------------------------------------------------------------------</a>

<a id="3290" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3356" href="Graded.Substitution.html#3356" class="Function">consSubstₘ</a> <a id="3367" class="Symbol">:</a> <a id="3369" class="Symbol">(</a><a id="3370" href="Graded.Substitution.html#3370" class="Bound">Ψ</a> <a id="3372" class="Symbol">:</a> <a id="3374" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3381" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="3383" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3384" class="Symbol">)</a> <a id="3386" class="Symbol">→</a> <a id="3388" class="Symbol">(</a><a id="3389" href="Graded.Substitution.html#3389" class="Bound">γ</a> <a id="3391" class="Symbol">:</a> <a id="3393" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="3398" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="3399" class="Symbol">)</a> <a id="3401" class="Symbol">→</a> <a id="3403" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3410" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="3412" class="Symbol">(</a><a id="3413" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="3416" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3417" class="Symbol">)</a>
<a id="3419" href="Graded.Substitution.html#3356" class="Function">consSubstₘ</a> <a id="3430" class="Symbol">=</a> <a id="3432" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a>

<a id="3437" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3473" href="Graded.Substitution.html#3473" class="Function">sgSubstₘ</a> <a id="3482" class="Symbol">:</a> <a id="3484" class="Symbol">(</a><a id="3485" href="Graded.Substitution.html#3485" class="Bound">γ</a> <a id="3487" class="Symbol">:</a> <a id="3489" href="Graded.Context.html#692" class="Datatype">Conₘ</a> <a id="3494" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3495" class="Symbol">)</a> <a id="3497" class="Symbol">→</a> <a id="3499" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3506" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="3508" class="Symbol">(</a><a id="3509" href="Tools.Nat.html#1726" class="InductiveConstructor">1+</a> <a id="3512" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3513" class="Symbol">)</a>
<a id="3515" href="Graded.Substitution.html#3473" class="Function">sgSubstₘ</a> <a id="3524" class="Symbol">=</a> <a id="3526" href="Graded.Substitution.html#3356" class="Function">consSubstₘ</a> <a id="3537" href="Graded.Substitution.html#2806" class="Function">idSubstₘ</a>
</pre></body></html>