<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="288" class="Keyword">module</a> <a id="295" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="317" class="Symbol">{</a><a id="318" href="Graded.Substitution.html#318" class="Bound">a</a><a id="319" class="Symbol">}</a> <a id="321" class="Symbol">{</a><a id="322" href="Graded.Substitution.html#322" class="Bound">M</a> <a id="324" class="Symbol">:</a> <a id="326" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="330" href="Graded.Substitution.html#318" class="Bound">a</a><a id="331" class="Symbol">}</a>
  <a id="335" class="Symbol">(</a><a id="336" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="338" class="Symbol">:</a> <a id="340" href="Graded.Modality.html#5274" class="Record">Modality</a> <a id="349" href="Graded.Substitution.html#322" class="Bound">M</a><a id="350" class="Symbol">)</a>
  <a id="354" class="Symbol">(</a><a id="355" href="Graded.Substitution.html#355" class="Bound">R</a> <a id="357" class="Symbol">:</a> <a id="359" href="Graded.Usage.Restrictions.html#316" class="Record">Usage-restrictions</a> <a id="378" href="Graded.Substitution.html#322" class="Bound">M</a><a id="379" class="Symbol">)</a>
  <a id="383" class="Keyword">where</a>

<a id="390" class="Keyword">open</a> <a id="395" href="Graded.Modality.html#5274" class="Module">Modality</a> <a id="404" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="438" href="Graded.Substitution.html#322" class="Bound">M</a>
  <a id="442" class="Keyword">using</a> <a id="448" class="Symbol">(</a><a id="449" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="455" class="Symbol">;</a> <a id="457" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="462" class="Symbol">;</a> <a id="464" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="469" class="Symbol">;</a> <a id="471" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="474" class="Symbol">;</a> <a id="476" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a> <a id="479" class="Symbol">;</a> <a id="481" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="486" class="Symbol">;</a> <a id="488" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="521" href="Graded.Substitution.html#336" class="Bound">𝕄</a>
<a id="523" class="Keyword">open</a> <a id="528" class="Keyword">import</a> <a id="535" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="548" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="550" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="587" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="589" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="591" class="Keyword">open</a> <a id="596" class="Keyword">import</a> <a id="603" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="615" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Tools.Nat.html" class="Module">Tools.Nat</a> <a id="662" class="Keyword">using</a> <a id="668" class="Symbol">(</a><a id="669" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="672" class="Symbol">;</a> <a id="674" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a><a id="676" class="Symbol">)</a>

<a id="679" class="Keyword">infixl</a> <a id="686" class="Number">50</a> <a id="689" href="Graded.Substitution.html#1346" class="Function Operator">_&lt;*_</a>
<a id="694" class="Keyword">infixr</a> <a id="701" class="Number">50</a> <a id="704" href="Graded.Substitution.html#1201" class="Function Operator">_*&gt;_</a>
<a id="709" class="Keyword">infix</a>  <a id="716" class="Number">20</a> <a id="719" href="Graded.Substitution.html#2052" class="Function Operator">∥_∥</a>
<a id="723" class="Keyword">infixl</a> <a id="730" class="Number">30</a> <a id="733" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">_⊙_</a>

<a id="738" class="Keyword">private</a>
  <a id="748" class="Keyword">variable</a>
    <a id="761" href="Graded.Substitution.html#761" class="Generalizable">k</a> <a id="763" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="765" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="767" class="Symbol">:</a> <a id="769" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="774" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>
<a id="852" class="Comment">-- Ψ : Substₘ m n is an n×m-matrix.</a>

<a id="889" class="Keyword">data</a> <a id="Substₘ"></a><a id="894" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="901" class="Symbol">:</a> <a id="903" class="Symbol">(</a><a id="904" href="Graded.Substitution.html#904" class="Bound">m</a> <a id="906" href="Graded.Substitution.html#906" class="Bound">n</a> <a id="908" class="Symbol">:</a> <a id="910" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="913" class="Symbol">)</a> <a id="915" class="Symbol">→</a> <a id="917" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="921" href="Graded.Substitution.html#318" class="Bound">a</a> <a id="923" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="931" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>  <a id="935" class="Symbol">:</a> <a id="937" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="944" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="946" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="950" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">_⊙_</a> <a id="954" class="Symbol">:</a> <a id="956" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="963" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="965" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="967" class="Symbol">→</a> <a id="969" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="974" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="976" class="Symbol">→</a> <a id="978" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="985" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="987" class="Symbol">(</a><a id="988" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="991" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="992" class="Symbol">)</a>

<a id="995" class="Keyword">private</a>
  <a id="1005" class="Keyword">variable</a>
    <a id="1018" href="Graded.Substitution.html#1018" class="Generalizable">Ψ</a> <a id="1020" href="Graded.Substitution.html#1020" class="Generalizable">Φ</a> <a id="1022" class="Symbol">:</a> <a id="1024" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1031" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1033" href="Graded.Substitution.html#765" class="Generalizable">n</a>

<a id="1036" class="Comment">-- Substitutions that contain empty usage contexts.</a>

<a id="εₘ"></a><a id="1089" href="Graded.Substitution.html#1089" class="Function">εₘ</a> <a id="1092" class="Symbol">:</a> <a id="1094" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1101" class="Number">0</a> <a id="1103" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="1105" href="Graded.Substitution.html#1089" class="Function">εₘ</a> <a id="1108" class="Symbol">{</a><a id="1109" class="Argument">n</a> <a id="1111" class="Symbol">=</a> <a id="1113" class="Number">0</a><a id="1114" class="Symbol">}</a>    <a id="1119" class="Symbol">=</a> <a id="1121" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>
<a id="1124" href="Graded.Substitution.html#1089" class="Function">εₘ</a> <a id="1127" class="Symbol">{</a><a id="1128" class="Argument">n</a> <a id="1130" class="Symbol">=</a> <a id="1132" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="1135" href="Graded.Substitution.html#1135" class="Bound">n</a><a id="1136" class="Symbol">}</a> <a id="1138" class="Symbol">=</a> <a id="1140" href="Graded.Substitution.html#1089" class="Function">εₘ</a> <a id="1143" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="1145" href="Graded.Context.html#653" class="InductiveConstructor">ε</a>

<a id="1148" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1201" href="Graded.Substitution.html#1201" class="Function Operator">_*&gt;_</a> <a id="1206" class="Symbol">:</a> <a id="1208" class="Symbol">(</a><a id="1209" href="Graded.Substitution.html#1209" class="Bound">Ψ</a> <a id="1211" class="Symbol">:</a> <a id="1213" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1220" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1222" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1223" class="Symbol">)</a> <a id="1225" class="Symbol">→</a> <a id="1227" class="Symbol">(</a><a id="1228" href="Graded.Substitution.html#1228" class="Bound">γ</a> <a id="1230" class="Symbol">:</a> <a id="1232" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1237" href="Graded.Substitution.html#763" class="Generalizable">m</a><a id="1238" class="Symbol">)</a> <a id="1240" class="Symbol">→</a> <a id="1242" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1247" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="1249" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a> <a id="1252" href="Graded.Substitution.html#1201" class="Function Operator">*&gt;</a> <a id="1255" href="Graded.Substitution.html#1255" class="Bound">γ</a> <a id="1257" class="Symbol">=</a> <a id="1259" href="Graded.Context.html#653" class="InductiveConstructor">ε</a>
<a id="1261" class="Symbol">(</a><a id="1262" href="Graded.Substitution.html#1262" class="Bound">Ψ</a> <a id="1264" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="1266" href="Graded.Substitution.html#1266" class="Bound">δ</a><a id="1267" class="Symbol">)</a> <a id="1269" href="Graded.Substitution.html#1201" class="Function Operator">*&gt;</a> <a id="1272" href="Graded.Substitution.html#1272" class="Bound">γ</a> <a id="1274" class="Symbol">=</a> <a id="1276" href="Graded.Substitution.html#1262" class="Bound">Ψ</a> <a id="1278" href="Graded.Substitution.html#1201" class="Function Operator">*&gt;</a> <a id="1281" href="Graded.Substitution.html#1272" class="Bound">γ</a> <a id="1283" href="Graded.Context.html#668" class="InductiveConstructor Operator">∙</a> <a id="1285" href="Graded.Substitution.html#1272" class="Bound">γ</a> <a id="1287" href="Graded.Context.html#1324" class="Function Operator">*</a> <a id="1289" href="Graded.Substitution.html#1266" class="Bound">δ</a>

<a id="1292" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1346" href="Graded.Substitution.html#1346" class="Function Operator">_&lt;*_</a> <a id="1351" class="Symbol">:</a> <a id="1353" class="Symbol">(</a><a id="1354" href="Graded.Substitution.html#1354" class="Bound">γ</a> <a id="1356" class="Symbol">:</a> <a id="1358" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1363" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1364" class="Symbol">)</a> <a id="1366" class="Symbol">→</a> <a id="1368" class="Symbol">(</a><a id="1369" href="Graded.Substitution.html#1369" class="Bound">Ψ</a> <a id="1371" class="Symbol">:</a> <a id="1373" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1380" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1382" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1383" class="Symbol">)</a> <a id="1385" class="Symbol">→</a> <a id="1387" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1392" href="Graded.Substitution.html#763" class="Generalizable">m</a>
<a id="1394" href="Graded.Context.html#653" class="InductiveConstructor">ε</a> <a id="1396" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="1399" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a> <a id="1402" class="Symbol">=</a> <a id="1404" href="Graded.Context.html#2010" class="Function">𝟘ᶜ</a>
<a id="1407" class="Symbol">(</a><a id="1408" href="Graded.Substitution.html#1408" class="Bound">γ</a> <a id="1410" href="Graded.Context.html#668" class="InductiveConstructor Operator">∙</a> <a id="1412" href="Graded.Substitution.html#1412" class="Bound">p</a><a id="1413" class="Symbol">)</a> <a id="1415" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="1418" class="Symbol">(</a><a id="1419" href="Graded.Substitution.html#1419" class="Bound">Ψ</a> <a id="1421" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="1423" href="Graded.Substitution.html#1423" class="Bound">δ</a><a id="1424" class="Symbol">)</a> <a id="1426" class="Symbol">=</a> <a id="1428" href="Graded.Substitution.html#1412" class="Bound">p</a> <a id="1430" href="Graded.Context.html#1667" class="Function Operator">·ᶜ</a> <a id="1433" href="Graded.Substitution.html#1423" class="Bound">δ</a> <a id="1435" href="Graded.Context.html#1435" class="Function Operator">+ᶜ</a> <a id="1438" class="Symbol">(</a><a id="1439" href="Graded.Substitution.html#1408" class="Bound">γ</a> <a id="1441" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="1444" href="Graded.Substitution.html#1419" class="Bound">Ψ</a><a id="1445" class="Symbol">)</a>

<a id="substₘ"></a><a id="1448" href="Graded.Substitution.html#1448" class="Function">substₘ</a> <a id="1455" class="Symbol">:</a> <a id="1457" class="Symbol">(</a><a id="1458" href="Graded.Substitution.html#1458" class="Bound">Ψ</a> <a id="1460" class="Symbol">:</a> <a id="1462" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1469" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1471" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1472" class="Symbol">)</a> <a id="1474" class="Symbol">→</a> <a id="1476" class="Symbol">(</a><a id="1477" href="Graded.Substitution.html#1477" class="Bound">γ</a> <a id="1479" class="Symbol">:</a> <a id="1481" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1486" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1487" class="Symbol">)</a> <a id="1489" class="Symbol">→</a> <a id="1491" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="1496" href="Graded.Substitution.html#763" class="Generalizable">m</a>
<a id="1498" href="Graded.Substitution.html#1448" class="Function">substₘ</a> <a id="1505" href="Graded.Substitution.html#1505" class="Bound">Ψ</a> <a id="1507" href="Graded.Substitution.html#1507" class="Bound">γ</a> <a id="1509" class="Symbol">=</a> <a id="1511" href="Graded.Substitution.html#1507" class="Bound">γ</a> <a id="1513" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="1516" href="Graded.Substitution.html#1505" class="Bound">Ψ</a>

<a id="1519" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1560" href="Graded.Substitution.html#1560" class="Function Operator">_&lt;*&gt;_</a> <a id="1566" class="Symbol">:</a> <a id="1568" class="Symbol">(</a><a id="1569" href="Graded.Substitution.html#1569" class="Bound">Ψ</a> <a id="1571" class="Symbol">:</a> <a id="1573" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1580" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1582" href="Graded.Substitution.html#761" class="Generalizable">k</a><a id="1583" class="Symbol">)</a> <a id="1585" class="Symbol">(</a><a id="1586" href="Graded.Substitution.html#1586" class="Bound">Φ</a> <a id="1588" class="Symbol">:</a> <a id="1590" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1597" href="Graded.Substitution.html#761" class="Generalizable">k</a> <a id="1599" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="1600" class="Symbol">)</a> <a id="1602" class="Symbol">→</a> <a id="1604" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1611" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1613" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="1615" href="Graded.Substitution.html#1615" class="Bound">Ψ</a> <a id="1617" href="Graded.Substitution.html#1560" class="Function Operator">&lt;*&gt;</a> <a id="1621" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a> <a id="1624" class="Symbol">=</a> <a id="1626" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>
<a id="1629" href="Graded.Substitution.html#1629" class="Bound">Ψ</a> <a id="1631" href="Graded.Substitution.html#1560" class="Function Operator">&lt;*&gt;</a> <a id="1635" class="Symbol">(</a><a id="1636" href="Graded.Substitution.html#1636" class="Bound">Φ</a> <a id="1638" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="1640" href="Graded.Substitution.html#1640" class="Bound">δ</a><a id="1641" class="Symbol">)</a> <a id="1643" class="Symbol">=</a> <a id="1645" class="Symbol">(</a><a id="1646" href="Graded.Substitution.html#1629" class="Bound">Ψ</a> <a id="1648" href="Graded.Substitution.html#1560" class="Function Operator">&lt;*&gt;</a> <a id="1652" href="Graded.Substitution.html#1636" class="Bound">Φ</a><a id="1653" class="Symbol">)</a> <a id="1655" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="1657" class="Symbol">(</a><a id="1658" href="Graded.Substitution.html#1640" class="Bound">δ</a> <a id="1660" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="1663" href="Graded.Substitution.html#1629" class="Bound">Ψ</a><a id="1664" class="Symbol">)</a>

<a id="1667" class="Comment">---------------------------------------------------------------</a>

<a id="1732" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1803" class="Comment">-- γ_x is the x-th row vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1867" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1883" href="Graded.Substitution.html#1883" class="Function Operator">_▶[_]_</a> <a id="1890" class="Symbol">:</a> <a id="1892" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="1899" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1901" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="1903" class="Symbol">→</a> <a id="1905" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="1917" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="1919" class="Symbol">→</a> <a id="1921" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="1927" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="1929" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="1931" class="Symbol">→</a> <a id="1933" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1937" href="Graded.Substitution.html#318" class="Bound">a</a>
<a id="1939" href="Graded.Substitution.html#1883" class="Function Operator">_▶[_]_</a> <a id="1946" class="Symbol">{</a><a id="1947" class="Argument">n</a> <a id="1949" class="Symbol">=</a> <a id="1951" href="Graded.Substitution.html#1951" class="Bound">n</a><a id="1952" class="Symbol">}</a> <a id="1954" href="Graded.Substitution.html#1954" class="Bound">Ψ</a> <a id="1956" href="Graded.Substitution.html#1956" class="Bound">γ</a> <a id="1958" href="Graded.Substitution.html#1958" class="Bound">σ</a> <a id="1960" class="Symbol">=</a>
  <a id="1964" class="Symbol">(</a><a id="1965" href="Graded.Substitution.html#1965" class="Bound">x</a> <a id="1967" class="Symbol">:</a> <a id="1969" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1973" href="Graded.Substitution.html#1951" class="Bound">n</a><a id="1974" class="Symbol">)</a> <a id="1976" class="Symbol">→</a> <a id="1978" class="Symbol">((</a><a id="1980" href="Graded.Context.html#2010" class="Function">𝟘ᶜ</a> <a id="1983" href="Graded.Context.html#1041" class="Function Operator">,</a> <a id="1985" href="Graded.Substitution.html#1965" class="Bound">x</a> <a id="1987" href="Graded.Context.html#1041" class="Function Operator">≔</a> <a id="1989" href="Graded.Mode.html#3577" class="Function Operator">⌜</a> <a id="1991" href="Graded.Substitution.html#1956" class="Bound">γ</a> <a id="1993" href="Graded.Substitution.html#1965" class="Bound">x</a> <a id="1995" href="Graded.Mode.html#3577" class="Function Operator">⌝</a><a id="1996" class="Symbol">)</a> <a id="1998" href="Graded.Substitution.html#1346" class="Function Operator">&lt;*</a> <a id="2001" href="Graded.Substitution.html#1954" class="Bound">Ψ</a><a id="2002" class="Symbol">)</a> <a id="2004" href="Graded.Usage.html#1080" class="Datatype Operator">▸[</a> <a id="2007" href="Graded.Substitution.html#1956" class="Bound">γ</a> <a id="2009" href="Graded.Substitution.html#1965" class="Bound">x</a> <a id="2011" href="Graded.Usage.html#1080" class="Datatype Operator">]</a> <a id="2013" href="Graded.Substitution.html#1958" class="Bound">σ</a> <a id="2015" href="Graded.Substitution.html#1965" class="Bound">x</a>

<a id="2018" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="2052" href="Graded.Substitution.html#2052" class="Function Operator">∥_∥</a> <a id="2056" class="Symbol">:</a> <a id="2058" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="2064" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2066" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="2068" class="Symbol">→</a> <a id="2070" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="2082" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="2084" class="Symbol">→</a> <a id="2086" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2093" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2095" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="2097" href="Graded.Substitution.html#2052" class="Function Operator">∥_∥</a> <a id="2101" class="Symbol">{</a><a id="2102" class="Argument">n</a> <a id="2104" class="Symbol">=</a> <a id="2106" class="Number">0</a><a id="2107" class="Symbol">}</a>    <a id="2112" class="Symbol">_</a> <a id="2114" class="Symbol">_</a>  <a id="2117" class="Symbol">=</a> <a id="2119" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>
<a id="2122" href="Graded.Substitution.html#2052" class="Function Operator">∥_∥</a> <a id="2126" class="Symbol">{</a><a id="2127" class="Argument">n</a> <a id="2129" class="Symbol">=</a> <a id="2131" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="2134" href="Graded.Substitution.html#2134" class="Bound">n</a><a id="2135" class="Symbol">}</a> <a id="2137" href="Graded.Substitution.html#2137" class="Bound">σ</a> <a id="2139" href="Graded.Substitution.html#2139" class="Bound">ms</a> <a id="2142" class="Symbol">=</a> <a id="2144" href="Graded.Substitution.html#2052" class="Function Operator">∥</a> <a id="2146" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="2151" href="Graded.Substitution.html#2137" class="Bound">σ</a> <a id="2153" href="Graded.Substitution.html#2052" class="Function Operator">∥</a> <a id="2155" class="Symbol">(</a><a id="2156" href="Graded.Mode.html#4693" class="Function">tailᵐ</a> <a id="2162" href="Graded.Substitution.html#2139" class="Bound">ms</a><a id="2164" class="Symbol">)</a> <a id="2166" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="2168" href="Graded.Usage.html#2810" class="Function Operator">⌈</a> <a id="2170" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="2175" href="Graded.Substitution.html#2137" class="Bound">σ</a> <a id="2177" href="Graded.Usage.html#2810" class="Function Operator">⌉</a> <a id="2179" class="Symbol">(</a><a id="2180" href="Graded.Mode.html#4610" class="Function">headᵐ</a> <a id="2186" href="Graded.Substitution.html#2139" class="Bound">ms</a><a id="2188" class="Symbol">)</a>

<a id="2191" class="Comment">---------------------------------------------------------------</a>
<a id="2255" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2319" class="Comment">---------------------------------------------------------------</a>

<a id="2384" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2435" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2445" class="Symbol">:</a> <a id="2447" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2454" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2456" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="2458" class="Symbol">→</a> <a id="2460" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2467" class="Symbol">(</a><a id="2468" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="2471" href="Graded.Substitution.html#763" class="Generalizable">m</a><a id="2472" class="Symbol">)</a> <a id="2474" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="2476" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2486" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a> <a id="2489" class="Symbol">=</a> <a id="2491" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>
<a id="2494" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2504" class="Symbol">(</a><a id="2505" href="Graded.Substitution.html#2505" class="Bound">Ψ</a> <a id="2507" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="2509" href="Graded.Substitution.html#2509" class="Bound">δ</a><a id="2510" class="Symbol">)</a> <a id="2512" class="Symbol">=</a> <a id="2514" class="Symbol">(</a><a id="2515" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2525" href="Graded.Substitution.html#2505" class="Bound">Ψ</a><a id="2526" class="Symbol">)</a> <a id="2528" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="2530" href="Graded.Usage.Weakening.html#1386" class="Function">wkConₘ</a> <a id="2537" class="Symbol">(</a><a id="2538" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2543" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a><a id="2545" class="Symbol">)</a> <a id="2547" href="Graded.Substitution.html#2509" class="Bound">δ</a>

<a id="2550" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2584" href="Graded.Substitution.html#2584" class="Function">liftSubstₘ</a> <a id="2595" class="Symbol">:</a> <a id="2597" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2604" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2606" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="2608" class="Symbol">→</a> <a id="2610" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2617" class="Symbol">(</a><a id="2618" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="2621" href="Graded.Substitution.html#763" class="Generalizable">m</a><a id="2622" class="Symbol">)</a> <a id="2624" class="Symbol">(</a><a id="2625" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="2628" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="2629" class="Symbol">)</a>
<a id="2631" href="Graded.Substitution.html#2584" class="Function">liftSubstₘ</a> <a id="2642" href="Graded.Substitution.html#2642" class="Bound">Ψ</a> <a id="2644" class="Symbol">=</a> <a id="2646" class="Symbol">(</a><a id="2647" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2657" href="Graded.Substitution.html#2642" class="Bound">Ψ</a><a id="2658" class="Symbol">)</a> <a id="2660" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">⊙</a> <a id="2662" class="Symbol">(</a><a id="2663" href="Graded.Context.html#2010" class="Function">𝟘ᶜ</a> <a id="2666" href="Graded.Context.html#668" class="InductiveConstructor Operator">∙</a> <a id="2668" href="Graded.Modality.html#819" class="Function">𝟙</a><a id="2669" class="Symbol">)</a>

<a id="2672" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2705" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a> <a id="2714" class="Symbol">:</a> <a id="2716" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2723" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="2725" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="2727" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a> <a id="2736" class="Symbol">{</a><a id="2737" class="Argument">n</a> <a id="2739" class="Symbol">=</a> <a id="2741" class="Number">0</a><a id="2742" class="Symbol">}</a> <a id="2744" class="Symbol">=</a> <a id="2746" href="Graded.Substitution.html#931" class="InductiveConstructor">[]</a>
<a id="2749" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a> <a id="2758" class="Symbol">{</a><a id="2759" class="Argument">n</a> <a id="2761" class="Symbol">=</a> <a id="2763" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="2766" href="Graded.Substitution.html#2766" class="Bound">n</a><a id="2767" class="Symbol">}</a> <a id="2769" class="Symbol">=</a> <a id="2771" href="Graded.Substitution.html#2584" class="Function">liftSubstₘ</a> <a id="2782" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a>

<a id="2792" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2833" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2842" class="Symbol">:</a> <a id="2844" class="Symbol">(</a><a id="2845" href="Graded.Substitution.html#2845" class="Bound">ρ</a> <a id="2847" class="Symbol">:</a> <a id="2849" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="2852" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2854" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="2855" class="Symbol">)</a> <a id="2857" class="Symbol">→</a> <a id="2859" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="2866" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="2868" href="Graded.Substitution.html#765" class="Generalizable">n</a>
<a id="2870" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2879" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a>       <a id="2888" class="Symbol">=</a> <a id="2890" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a>
<a id="2899" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2908" class="Symbol">(</a><a id="2909" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2914" href="Graded.Substitution.html#2914" class="Bound">ρ</a><a id="2915" class="Symbol">)</a> <a id="2917" class="Symbol">=</a> <a id="2919" href="Graded.Substitution.html#2435" class="Function">wk1Substₘ</a> <a id="2929" class="Symbol">(</a><a id="2930" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2939" href="Graded.Substitution.html#2914" class="Bound">ρ</a><a id="2940" class="Symbol">)</a>
<a id="2942" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2951" class="Symbol">(</a><a id="2952" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a> <a id="2957" href="Graded.Substitution.html#2957" class="Bound">ρ</a><a id="2958" class="Symbol">)</a> <a id="2960" class="Symbol">=</a> <a id="2962" href="Graded.Substitution.html#2584" class="Function">liftSubstₘ</a> <a id="2973" class="Symbol">(</a><a id="2974" href="Graded.Substitution.html#2833" class="Function">wkSubstₘ</a> <a id="2983" href="Graded.Substitution.html#2957" class="Bound">ρ</a><a id="2984" class="Symbol">)</a>

<a id="2987" class="Comment">------------------------------------------------------------------</a>
<a id="3054" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3121" class="Comment">------------------------------------------------------------------</a>

<a id="3189" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3255" href="Graded.Substitution.html#3255" class="Function">consSubstₘ</a> <a id="3266" class="Symbol">:</a> <a id="3268" class="Symbol">(</a><a id="3269" href="Graded.Substitution.html#3269" class="Bound">Ψ</a> <a id="3271" class="Symbol">:</a> <a id="3273" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="3280" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="3282" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="3283" class="Symbol">)</a> <a id="3285" class="Symbol">→</a> <a id="3287" class="Symbol">(</a><a id="3288" href="Graded.Substitution.html#3288" class="Bound">γ</a> <a id="3290" class="Symbol">:</a> <a id="3292" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="3297" href="Graded.Substitution.html#763" class="Generalizable">m</a><a id="3298" class="Symbol">)</a> <a id="3300" class="Symbol">→</a> <a id="3302" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="3309" href="Graded.Substitution.html#763" class="Generalizable">m</a> <a id="3311" class="Symbol">(</a><a id="3312" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="3315" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="3316" class="Symbol">)</a>
<a id="3318" href="Graded.Substitution.html#3255" class="Function">consSubstₘ</a> <a id="3329" class="Symbol">=</a> <a id="3331" href="Graded.Substitution.html#950" class="InductiveConstructor Operator">_⊙_</a>

<a id="3336" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3372" href="Graded.Substitution.html#3372" class="Function">sgSubstₘ</a> <a id="3381" class="Symbol">:</a> <a id="3383" class="Symbol">(</a><a id="3384" href="Graded.Substitution.html#3384" class="Bound">γ</a> <a id="3386" class="Symbol">:</a> <a id="3388" href="Graded.Context.html#626" class="Datatype">Conₘ</a> <a id="3393" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="3394" class="Symbol">)</a> <a id="3396" class="Symbol">→</a> <a id="3398" href="Graded.Substitution.html#894" class="Datatype">Substₘ</a> <a id="3405" href="Graded.Substitution.html#765" class="Generalizable">n</a> <a id="3407" class="Symbol">(</a><a id="3408" href="Tools.Nat.html#698" class="InductiveConstructor">1+</a> <a id="3411" href="Graded.Substitution.html#765" class="Generalizable">n</a><a id="3412" class="Symbol">)</a>
<a id="3414" href="Graded.Substitution.html#3372" class="Function">sgSubstₘ</a> <a id="3423" class="Symbol">=</a> <a id="3425" href="Graded.Substitution.html#3255" class="Function">consSubstₘ</a> <a id="3436" href="Graded.Substitution.html#2705" class="Function">idSubstₘ</a>
</pre></body></html>