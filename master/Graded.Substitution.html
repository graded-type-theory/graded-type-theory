<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">import</a> <a id="228" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="244" class="Keyword">open</a> <a id="249" class="Keyword">import</a> <a id="256" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="283" class="Keyword">module</a> <a id="290" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="312" class="Symbol">{</a><a id="313" href="Graded.Substitution.html#313" class="Bound">a</a><a id="314" class="Symbol">}</a> <a id="316" class="Symbol">{</a><a id="317" href="Graded.Substitution.html#317" class="Bound">M</a> <a id="319" class="Symbol">:</a> <a id="321" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="325" href="Graded.Substitution.html#313" class="Bound">a</a><a id="326" class="Symbol">}</a>
  <a id="330" class="Symbol">(</a><a id="331" class="Keyword">open</a> <a id="336" href="Graded.Modality.html" class="Module">Graded.Modality</a> <a id="352" href="Graded.Substitution.html#317" class="Bound">M</a><a id="353" class="Symbol">)</a>
  <a id="357" class="Symbol">(</a><a id="358" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="360" class="Symbol">:</a> <a id="362" href="Graded.Modality.html#5282" class="Record">Modality</a><a id="370" class="Symbol">)</a>
  <a id="374" class="Symbol">(</a><a id="375" href="Graded.Substitution.html#375" class="Bound">R</a> <a id="377" class="Symbol">:</a> <a id="379" href="Graded.Usage.Restrictions.html#316" class="Record">Usage-restrictions</a> <a id="398" href="Graded.Substitution.html#317" class="Bound">M</a><a id="399" class="Symbol">)</a>
  <a id="403" class="Keyword">where</a>

<a id="410" class="Keyword">open</a> <a id="415" href="Graded.Modality.html#5282" class="Module">Modality</a> <a id="424" href="Graded.Substitution.html#358" class="Bound">𝕄</a>

<a id="427" class="Keyword">open</a> <a id="432" class="Keyword">import</a> <a id="439" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="458" href="Graded.Substitution.html#317" class="Bound">M</a>
  <a id="462" class="Keyword">using</a> <a id="468" class="Symbol">(</a><a id="469" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="475" class="Symbol">;</a> <a id="477" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="482" class="Symbol">;</a> <a id="484" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="489" class="Symbol">;</a> <a id="491" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="494" class="Symbol">;</a> <a id="496" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a> <a id="499" class="Symbol">;</a> <a id="501" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="506" class="Symbol">;</a> <a id="508" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a><a id="512" class="Symbol">)</a>
<a id="514" class="Keyword">open</a> <a id="519" class="Keyword">import</a> <a id="526" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="541" href="Graded.Substitution.html#358" class="Bound">𝕄</a>
<a id="543" class="Keyword">open</a> <a id="548" class="Keyword">import</a> <a id="555" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="568" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="570" href="Graded.Substitution.html#375" class="Bound">R</a>
<a id="572" class="Keyword">open</a> <a id="577" class="Keyword">import</a> <a id="584" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="607" href="Graded.Substitution.html#358" class="Bound">𝕄</a> <a id="609" href="Graded.Substitution.html#375" class="Bound">R</a>
<a id="611" class="Keyword">open</a> <a id="616" class="Keyword">import</a> <a id="623" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="635" href="Graded.Substitution.html#358" class="Bound">𝕄</a>

<a id="638" class="Keyword">open</a> <a id="643" class="Keyword">import</a> <a id="650" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="660" class="Keyword">open</a> <a id="665" class="Keyword">import</a> <a id="672" href="Tools.Nat.html" class="Module">Tools.Nat</a> <a id="682" class="Keyword">using</a> <a id="688" class="Symbol">(</a><a id="689" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="692" class="Symbol">;</a> <a id="694" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a><a id="696" class="Symbol">)</a>

<a id="699" class="Keyword">infixl</a> <a id="706" class="Number">50</a> <a id="709" href="Graded.Substitution.html#1366" class="Function Operator">_&lt;*_</a>
<a id="714" class="Keyword">infixr</a> <a id="721" class="Number">50</a> <a id="724" href="Graded.Substitution.html#1221" class="Function Operator">_*&gt;_</a>
<a id="729" class="Keyword">infix</a>  <a id="736" class="Number">20</a> <a id="739" href="Graded.Substitution.html#2120" class="Function Operator">∥_∥</a>
<a id="743" class="Keyword">infixl</a> <a id="750" class="Number">30</a> <a id="753" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a>

<a id="758" class="Keyword">private</a>
  <a id="768" class="Keyword">variable</a>
    <a id="781" href="Graded.Substitution.html#781" class="Generalizable">k</a> <a id="783" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="785" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="787" class="Symbol">:</a> <a id="789" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="794" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>
<a id="872" class="Comment">-- Ψ : Substₘ m n is an n×m-matrix.</a>

<a id="909" class="Keyword">data</a> <a id="Substₘ"></a><a id="914" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="921" class="Symbol">:</a> <a id="923" class="Symbol">(</a><a id="924" href="Graded.Substitution.html#924" class="Bound">m</a> <a id="926" href="Graded.Substitution.html#926" class="Bound">n</a> <a id="928" class="Symbol">:</a> <a id="930" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="933" class="Symbol">)</a> <a id="935" class="Symbol">→</a> <a id="937" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="941" href="Graded.Substitution.html#313" class="Bound">a</a> <a id="943" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="951" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>  <a id="955" class="Symbol">:</a> <a id="957" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="964" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="966" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="970" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a> <a id="974" class="Symbol">:</a> <a id="976" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="983" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="985" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="987" class="Symbol">→</a> <a id="989" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="994" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="996" class="Symbol">→</a> <a id="998" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1005" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1007" class="Symbol">(</a><a id="1008" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="1011" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1012" class="Symbol">)</a>

<a id="1015" class="Keyword">private</a>
  <a id="1025" class="Keyword">variable</a>
    <a id="1038" href="Graded.Substitution.html#1038" class="Generalizable">Ψ</a> <a id="1040" href="Graded.Substitution.html#1040" class="Generalizable">Φ</a> <a id="1042" class="Symbol">:</a> <a id="1044" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1051" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1053" href="Graded.Substitution.html#785" class="Generalizable">n</a>

<a id="1056" class="Comment">-- Substitutions that contain empty usage contexts.</a>

<a id="εₘ"></a><a id="1109" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1121" class="Number">0</a> <a id="1123" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1125" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1128" class="Symbol">{</a><a id="1129" class="Argument">n</a> <a id="1131" class="Symbol">=</a> <a id="1133" class="Number">0</a><a id="1134" class="Symbol">}</a>    <a id="1139" class="Symbol">=</a> <a id="1141" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="1144" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1147" class="Symbol">{</a><a id="1148" class="Argument">n</a> <a id="1150" class="Symbol">=</a> <a id="1152" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="1155" href="Graded.Substitution.html#1155" class="Bound">n</a><a id="1156" class="Symbol">}</a> <a id="1158" class="Symbol">=</a> <a id="1160" href="Graded.Substitution.html#1109" class="Function">εₘ</a> <a id="1163" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1165" href="Graded.Context.html#728" class="InductiveConstructor">ε</a>

<a id="1168" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1221" href="Graded.Substitution.html#1221" class="Function Operator">_*&gt;_</a> <a id="1226" class="Symbol">:</a> <a id="1228" class="Symbol">(</a><a id="1229" href="Graded.Substitution.html#1229" class="Bound">Ψ</a> <a id="1231" class="Symbol">:</a> <a id="1233" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1240" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1242" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1243" class="Symbol">)</a> <a id="1245" class="Symbol">→</a> <a id="1247" class="Symbol">(</a><a id="1248" href="Graded.Substitution.html#1248" class="Bound">γ</a> <a id="1250" class="Symbol">:</a> <a id="1252" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1257" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="1258" class="Symbol">)</a> <a id="1260" class="Symbol">→</a> <a id="1262" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1267" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1269" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1272" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1275" href="Graded.Substitution.html#1275" class="Bound">γ</a> <a id="1277" class="Symbol">=</a> <a id="1279" href="Graded.Context.html#728" class="InductiveConstructor">ε</a>
<a id="1281" class="Symbol">(</a><a id="1282" href="Graded.Substitution.html#1282" class="Bound">Ψ</a> <a id="1284" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1286" href="Graded.Substitution.html#1286" class="Bound">δ</a><a id="1287" class="Symbol">)</a> <a id="1289" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1292" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1294" class="Symbol">=</a> <a id="1296" href="Graded.Substitution.html#1282" class="Bound">Ψ</a> <a id="1298" href="Graded.Substitution.html#1221" class="Function Operator">*&gt;</a> <a id="1301" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1303" href="Graded.Context.html#743" class="InductiveConstructor Operator">∙</a> <a id="1305" href="Graded.Substitution.html#1292" class="Bound">γ</a> <a id="1307" href="Graded.Context.html#1399" class="Function Operator">*</a> <a id="1309" href="Graded.Substitution.html#1286" class="Bound">δ</a>

<a id="1312" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1366" href="Graded.Substitution.html#1366" class="Function Operator">_&lt;*_</a> <a id="1371" class="Symbol">:</a> <a id="1373" class="Symbol">(</a><a id="1374" href="Graded.Substitution.html#1374" class="Bound">γ</a> <a id="1376" class="Symbol">:</a> <a id="1378" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1383" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1384" class="Symbol">)</a> <a id="1386" class="Symbol">→</a> <a id="1388" class="Symbol">(</a><a id="1389" href="Graded.Substitution.html#1389" class="Bound">Ψ</a> <a id="1391" class="Symbol">:</a> <a id="1393" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1400" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1402" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1403" class="Symbol">)</a> <a id="1405" class="Symbol">→</a> <a id="1407" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1412" href="Graded.Substitution.html#783" class="Generalizable">m</a>
<a id="1414" href="Graded.Context.html#728" class="InductiveConstructor">ε</a> <a id="1416" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1419" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1422" class="Symbol">=</a> <a id="1424" href="Graded.Context.html#2211" class="Function">𝟘ᶜ</a>
<a id="1427" class="Symbol">(</a><a id="1428" href="Graded.Substitution.html#1428" class="Bound">γ</a> <a id="1430" href="Graded.Context.html#743" class="InductiveConstructor Operator">∙</a> <a id="1432" href="Graded.Substitution.html#1432" class="Bound">p</a><a id="1433" class="Symbol">)</a> <a id="1435" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1438" class="Symbol">(</a><a id="1439" href="Graded.Substitution.html#1439" class="Bound">Ψ</a> <a id="1441" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1443" href="Graded.Substitution.html#1443" class="Bound">δ</a><a id="1444" class="Symbol">)</a> <a id="1446" class="Symbol">=</a> <a id="1448" href="Graded.Substitution.html#1432" class="Bound">p</a> <a id="1450" href="Graded.Context.html#1742" class="Function Operator">·ᶜ</a> <a id="1453" href="Graded.Substitution.html#1443" class="Bound">δ</a> <a id="1455" href="Graded.Context.html#1510" class="Function Operator">+ᶜ</a> <a id="1458" class="Symbol">(</a><a id="1459" href="Graded.Substitution.html#1428" class="Bound">γ</a> <a id="1461" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1464" href="Graded.Substitution.html#1439" class="Bound">Ψ</a><a id="1465" class="Symbol">)</a>

<a id="substₘ"></a><a id="1468" href="Graded.Substitution.html#1468" class="Function">substₘ</a> <a id="1475" class="Symbol">:</a> <a id="1477" class="Symbol">(</a><a id="1478" href="Graded.Substitution.html#1478" class="Bound">Ψ</a> <a id="1480" class="Symbol">:</a> <a id="1482" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1489" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1491" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1492" class="Symbol">)</a> <a id="1494" class="Symbol">→</a> <a id="1496" class="Symbol">(</a><a id="1497" href="Graded.Substitution.html#1497" class="Bound">γ</a> <a id="1499" class="Symbol">:</a> <a id="1501" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1506" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1507" class="Symbol">)</a> <a id="1509" class="Symbol">→</a> <a id="1511" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="1516" href="Graded.Substitution.html#783" class="Generalizable">m</a>
<a id="1518" href="Graded.Substitution.html#1468" class="Function">substₘ</a> <a id="1525" href="Graded.Substitution.html#1525" class="Bound">Ψ</a> <a id="1527" href="Graded.Substitution.html#1527" class="Bound">γ</a> <a id="1529" class="Symbol">=</a> <a id="1531" href="Graded.Substitution.html#1527" class="Bound">γ</a> <a id="1533" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1536" href="Graded.Substitution.html#1525" class="Bound">Ψ</a>

<a id="1539" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1580" href="Graded.Substitution.html#1580" class="Function Operator">_&lt;*&gt;_</a> <a id="1586" class="Symbol">:</a> <a id="1588" class="Symbol">(</a><a id="1589" href="Graded.Substitution.html#1589" class="Bound">Ψ</a> <a id="1591" class="Symbol">:</a> <a id="1593" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1600" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1602" href="Graded.Substitution.html#781" class="Generalizable">k</a><a id="1603" class="Symbol">)</a> <a id="1605" class="Symbol">(</a><a id="1606" href="Graded.Substitution.html#1606" class="Bound">Φ</a> <a id="1608" class="Symbol">:</a> <a id="1610" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1617" href="Graded.Substitution.html#781" class="Generalizable">k</a> <a id="1619" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="1620" class="Symbol">)</a> <a id="1622" class="Symbol">→</a> <a id="1624" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1631" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1633" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="1635" href="Graded.Substitution.html#1635" class="Bound">Ψ</a> <a id="1637" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1641" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="1644" class="Symbol">=</a> <a id="1646" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="1649" href="Graded.Substitution.html#1649" class="Bound">Ψ</a> <a id="1651" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1655" class="Symbol">(</a><a id="1656" href="Graded.Substitution.html#1656" class="Bound">Φ</a> <a id="1658" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1660" href="Graded.Substitution.html#1660" class="Bound">δ</a><a id="1661" class="Symbol">)</a> <a id="1663" class="Symbol">=</a> <a id="1665" class="Symbol">(</a><a id="1666" href="Graded.Substitution.html#1649" class="Bound">Ψ</a> <a id="1668" href="Graded.Substitution.html#1580" class="Function Operator">&lt;*&gt;</a> <a id="1672" href="Graded.Substitution.html#1656" class="Bound">Φ</a><a id="1673" class="Symbol">)</a> <a id="1675" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="1677" class="Symbol">(</a><a id="1678" href="Graded.Substitution.html#1660" class="Bound">δ</a> <a id="1680" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="1683" href="Graded.Substitution.html#1649" class="Bound">Ψ</a><a id="1684" class="Symbol">)</a>

<a id="1687" class="Comment">---------------------------------------------------------------</a>

<a id="1752" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1823" class="Comment">-- γ_x is the x-th row vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1887" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1903" href="Graded.Substitution.html#1903" class="Function Operator">_▶[_]_</a> <a id="1910" class="Symbol">:</a> <a id="1912" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="1919" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1921" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1923" class="Symbol">→</a> <a id="1925" href="Graded.Mode.html#4370" class="Function">Mode-vector</a> <a id="1937" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1939" class="Symbol">→</a> <a id="1941" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="1947" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="1949" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="1951" class="Symbol">→</a> <a id="1953" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1957" href="Graded.Substitution.html#313" class="Bound">a</a>
<a id="1959" href="Graded.Substitution.html#1903" class="Function Operator">_▶[_]_</a> <a id="1966" class="Symbol">{</a><a id="1967" class="Argument">n</a> <a id="1969" class="Symbol">=</a> <a id="1971" href="Graded.Substitution.html#1971" class="Bound">n</a><a id="1972" class="Symbol">}</a> <a id="1974" href="Graded.Substitution.html#1974" class="Bound">Ψ</a> <a id="1976" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="1978" href="Graded.Substitution.html#1978" class="Bound">σ</a> <a id="1980" class="Symbol">=</a>
  <a id="1984" class="Symbol">(</a><a id="1985" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="1987" class="Symbol">:</a> <a id="1989" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1993" href="Graded.Substitution.html#1971" class="Bound">n</a><a id="1994" class="Symbol">)</a> <a id="1996" class="Symbol">→</a> <a id="1998" class="Symbol">((</a><a id="2000" href="Graded.Context.html#2211" class="Function">𝟘ᶜ</a> <a id="2003" href="Graded.Context.html#1116" class="Function Operator">,</a> <a id="2005" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2007" href="Graded.Context.html#1116" class="Function Operator">≔</a> <a id="2009" href="Graded.Mode.html#3651" class="Function Operator">⌜</a> <a id="2011" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="2013" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2015" href="Graded.Mode.html#3651" class="Function Operator">⌝</a><a id="2016" class="Symbol">)</a> <a id="2018" href="Graded.Substitution.html#1366" class="Function Operator">&lt;*</a> <a id="2021" href="Graded.Substitution.html#1974" class="Bound">Ψ</a><a id="2022" class="Symbol">)</a> <a id="2024" href="Graded.Usage.html#2186" class="Datatype Operator">▸[</a> <a id="2027" href="Graded.Substitution.html#1976" class="Bound">γ</a> <a id="2029" href="Graded.Substitution.html#1985" class="Bound">x</a> <a id="2031" href="Graded.Usage.html#2186" class="Datatype Operator">]</a> <a id="2033" href="Graded.Substitution.html#1978" class="Bound">σ</a> <a id="2035" href="Graded.Substitution.html#1985" class="Bound">x</a>

<a id="2038" class="Comment">-- Substitution matrix inference (for modalities with natrec-star</a>
<a id="2104" class="Comment">-- operators).</a>

<a id="∥_∥"></a><a id="2120" href="Graded.Substitution.html#2120" class="Function Operator">∥_∥</a> <a id="2124" class="Symbol">:</a>
  <a id="2128" class="Symbol">⦃</a> <a id="2130" href="Graded.Substitution.html#2130" class="Bound">has-star</a> <a id="2139" class="Symbol">:</a> <a id="2141" href="Graded.Modality.html#4079" class="Record">Has-star</a> <a id="2150" href="Graded.Modality.html#5395" class="Function">semiring-with-meet</a> <a id="2169" class="Symbol">⦄</a> <a id="2171" class="Symbol">→</a>
  <a id="2175" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="2181" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2183" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2185" class="Symbol">→</a> <a id="2187" href="Graded.Mode.html#4370" class="Function">Mode-vector</a> <a id="2199" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2201" class="Symbol">→</a> <a id="2203" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2210" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2212" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2214" href="Graded.Substitution.html#2120" class="Function Operator">∥_∥</a> <a id="2218" class="Symbol">{</a><a id="2219" class="Argument">n</a> <a id="2221" class="Symbol">=</a> <a id="2223" class="Number">0</a><a id="2224" class="Symbol">}</a>    <a id="2229" class="Symbol">_</a> <a id="2231" class="Symbol">_</a>  <a id="2234" class="Symbol">=</a> <a id="2236" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2239" href="Graded.Substitution.html#2120" class="Function Operator">∥_∥</a> <a id="2243" class="Symbol">{</a><a id="2244" class="Argument">n</a> <a id="2246" class="Symbol">=</a> <a id="2248" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="2251" href="Graded.Substitution.html#2251" class="Bound">n</a><a id="2252" class="Symbol">}</a> <a id="2254" href="Graded.Substitution.html#2254" class="Bound">σ</a> <a id="2256" href="Graded.Substitution.html#2256" class="Bound">ms</a> <a id="2259" class="Symbol">=</a> <a id="2261" href="Graded.Substitution.html#2120" class="Function Operator">∥</a> <a id="2263" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="2268" href="Graded.Substitution.html#2254" class="Bound">σ</a> <a id="2270" href="Graded.Substitution.html#2120" class="Function Operator">∥</a> <a id="2272" class="Symbol">(</a><a id="2273" href="Graded.Mode.html#4770" class="Function">tailᵐ</a> <a id="2279" href="Graded.Substitution.html#2256" class="Bound">ms</a><a id="2281" class="Symbol">)</a> <a id="2283" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2285" href="Graded.Usage.html#958" class="Function Operator">⌈</a> <a id="2287" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="2292" href="Graded.Substitution.html#2254" class="Bound">σ</a> <a id="2294" href="Graded.Usage.html#958" class="Function Operator">⌉</a> <a id="2296" class="Symbol">(</a><a id="2297" href="Graded.Mode.html#4687" class="Function">headᵐ</a> <a id="2303" href="Graded.Substitution.html#2256" class="Bound">ms</a><a id="2305" class="Symbol">)</a>

<a id="2308" class="Comment">---------------------------------------------------------------</a>
<a id="2372" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2436" class="Comment">---------------------------------------------------------------</a>

<a id="2501" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2552" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="2562" class="Symbol">:</a> <a id="2564" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2571" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2573" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2575" class="Symbol">→</a> <a id="2577" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2584" class="Symbol">(</a><a id="2585" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="2588" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="2589" class="Symbol">)</a> <a id="2591" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2593" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="2603" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a> <a id="2606" class="Symbol">=</a> <a id="2608" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2611" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="2621" class="Symbol">(</a><a id="2622" href="Graded.Substitution.html#2622" class="Bound">Ψ</a> <a id="2624" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2626" href="Graded.Substitution.html#2626" class="Bound">δ</a><a id="2627" class="Symbol">)</a> <a id="2629" class="Symbol">=</a> <a id="2631" class="Symbol">(</a><a id="2632" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="2642" href="Graded.Substitution.html#2622" class="Bound">Ψ</a><a id="2643" class="Symbol">)</a> <a id="2645" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2647" href="Graded.Usage.Weakening.html#1429" class="Function">wkConₘ</a> <a id="2654" class="Symbol">(</a><a id="2655" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2660" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a><a id="2662" class="Symbol">)</a> <a id="2664" href="Graded.Substitution.html#2626" class="Bound">δ</a>

<a id="2667" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2701" href="Graded.Substitution.html#2701" class="Function">liftSubstₘ</a> <a id="2712" class="Symbol">:</a> <a id="2714" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2721" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2723" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2725" class="Symbol">→</a> <a id="2727" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2734" class="Symbol">(</a><a id="2735" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="2738" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="2739" class="Symbol">)</a> <a id="2741" class="Symbol">(</a><a id="2742" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="2745" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="2746" class="Symbol">)</a>
<a id="2748" href="Graded.Substitution.html#2701" class="Function">liftSubstₘ</a> <a id="2759" href="Graded.Substitution.html#2759" class="Bound">Ψ</a> <a id="2761" class="Symbol">=</a> <a id="2763" class="Symbol">(</a><a id="2764" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="2774" href="Graded.Substitution.html#2759" class="Bound">Ψ</a><a id="2775" class="Symbol">)</a> <a id="2777" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">⊙</a> <a id="2779" class="Symbol">(</a><a id="2780" href="Graded.Context.html#2211" class="Function">𝟘ᶜ</a> <a id="2783" href="Graded.Context.html#743" class="InductiveConstructor Operator">∙</a> <a id="2785" href="Graded.Modality.html#846" class="Function">𝟙</a><a id="2786" class="Symbol">)</a>

<a id="2789" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2822" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a> <a id="2831" class="Symbol">:</a> <a id="2833" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2840" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="2842" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2844" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a> <a id="2853" class="Symbol">{</a><a id="2854" class="Argument">n</a> <a id="2856" class="Symbol">=</a> <a id="2858" class="Number">0</a><a id="2859" class="Symbol">}</a> <a id="2861" class="Symbol">=</a> <a id="2863" href="Graded.Substitution.html#951" class="InductiveConstructor">[]</a>
<a id="2866" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a> <a id="2875" class="Symbol">{</a><a id="2876" class="Argument">n</a> <a id="2878" class="Symbol">=</a> <a id="2880" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="2883" href="Graded.Substitution.html#2883" class="Bound">n</a><a id="2884" class="Symbol">}</a> <a id="2886" class="Symbol">=</a> <a id="2888" href="Graded.Substitution.html#2701" class="Function">liftSubstₘ</a> <a id="2899" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a>

<a id="2909" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2950" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="2959" class="Symbol">:</a> <a id="2961" class="Symbol">(</a><a id="2962" href="Graded.Substitution.html#2962" class="Bound">ρ</a> <a id="2964" class="Symbol">:</a> <a id="2966" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="2969" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2971" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="2972" class="Symbol">)</a> <a id="2974" class="Symbol">→</a> <a id="2976" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="2983" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="2985" href="Graded.Substitution.html#785" class="Generalizable">n</a>
<a id="2987" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="2996" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a>       <a id="3005" class="Symbol">=</a> <a id="3007" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a>
<a id="3016" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="3025" class="Symbol">(</a><a id="3026" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="3031" href="Graded.Substitution.html#3031" class="Bound">ρ</a><a id="3032" class="Symbol">)</a> <a id="3034" class="Symbol">=</a> <a id="3036" href="Graded.Substitution.html#2552" class="Function">wk1Substₘ</a> <a id="3046" class="Symbol">(</a><a id="3047" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="3056" href="Graded.Substitution.html#3031" class="Bound">ρ</a><a id="3057" class="Symbol">)</a>
<a id="3059" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="3068" class="Symbol">(</a><a id="3069" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a> <a id="3074" href="Graded.Substitution.html#3074" class="Bound">ρ</a><a id="3075" class="Symbol">)</a> <a id="3077" class="Symbol">=</a> <a id="3079" href="Graded.Substitution.html#2701" class="Function">liftSubstₘ</a> <a id="3090" class="Symbol">(</a><a id="3091" href="Graded.Substitution.html#2950" class="Function">wkSubstₘ</a> <a id="3100" href="Graded.Substitution.html#3074" class="Bound">ρ</a><a id="3101" class="Symbol">)</a>

<a id="3104" class="Comment">------------------------------------------------------------------</a>
<a id="3171" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3238" class="Comment">------------------------------------------------------------------</a>

<a id="3306" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3372" href="Graded.Substitution.html#3372" class="Function">consSubstₘ</a> <a id="3383" class="Symbol">:</a> <a id="3385" class="Symbol">(</a><a id="3386" href="Graded.Substitution.html#3386" class="Bound">Ψ</a> <a id="3388" class="Symbol">:</a> <a id="3390" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3397" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="3399" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3400" class="Symbol">)</a> <a id="3402" class="Symbol">→</a> <a id="3404" class="Symbol">(</a><a id="3405" href="Graded.Substitution.html#3405" class="Bound">γ</a> <a id="3407" class="Symbol">:</a> <a id="3409" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="3414" href="Graded.Substitution.html#783" class="Generalizable">m</a><a id="3415" class="Symbol">)</a> <a id="3417" class="Symbol">→</a> <a id="3419" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3426" href="Graded.Substitution.html#783" class="Generalizable">m</a> <a id="3428" class="Symbol">(</a><a id="3429" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="3432" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3433" class="Symbol">)</a>
<a id="3435" href="Graded.Substitution.html#3372" class="Function">consSubstₘ</a> <a id="3446" class="Symbol">=</a> <a id="3448" href="Graded.Substitution.html#970" class="InductiveConstructor Operator">_⊙_</a>

<a id="3453" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3489" href="Graded.Substitution.html#3489" class="Function">sgSubstₘ</a> <a id="3498" class="Symbol">:</a> <a id="3500" class="Symbol">(</a><a id="3501" href="Graded.Substitution.html#3501" class="Bound">γ</a> <a id="3503" class="Symbol">:</a> <a id="3505" href="Graded.Context.html#701" class="Datatype">Conₘ</a> <a id="3510" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3511" class="Symbol">)</a> <a id="3513" class="Symbol">→</a> <a id="3515" href="Graded.Substitution.html#914" class="Datatype">Substₘ</a> <a id="3522" href="Graded.Substitution.html#785" class="Generalizable">n</a> <a id="3524" class="Symbol">(</a><a id="3525" href="Tools.Nat.html#1071" class="InductiveConstructor">1+</a> <a id="3528" href="Graded.Substitution.html#785" class="Generalizable">n</a><a id="3529" class="Symbol">)</a>
<a id="3531" href="Graded.Substitution.html#3489" class="Function">sgSubstₘ</a> <a id="3540" class="Symbol">=</a> <a id="3542" href="Graded.Substitution.html#3372" class="Function">consSubstₘ</a> <a id="3553" href="Graded.Substitution.html#2822" class="Function">idSubstₘ</a>
</pre></body></html>