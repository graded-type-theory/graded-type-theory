<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="288" class="Keyword">module</a> <a id="295" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="317" class="Symbol">{</a><a id="318" href="Graded.Substitution.html#318" class="Bound">a</a><a id="319" class="Symbol">}</a> <a id="321" class="Symbol">{</a><a id="322" href="Graded.Substitution.html#322" class="Bound">M</a> <a id="324" class="Symbol">:</a> <a id="326" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="330" href="Graded.Substitution.html#318" class="Bound">a</a><a id="331" class="Symbol">}</a>
  <a id="335" class="Symbol">(</a><a id="336" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="338" class="Symbol">:</a> <a id="340" href="Graded.Modality.html#5337" class="Record">Modality</a> <a id="349" href="Graded.Substitution.html#322" class="Bound">M</a><a id="350" class="Symbol">)</a>
  <a id="354" class="Symbol">(</a><a id="355" href="Graded.Substitution.html#355" class="Bound">R</a> <a id="357" class="Symbol">:</a> <a id="359" href="Graded.Usage.Restrictions.html#316" class="Record">Usage-restrictions</a> <a id="378" href="Graded.Substitution.html#322" class="Bound">M</a><a id="379" class="Symbol">)</a>
  <a id="383" class="Keyword">where</a>

<a id="390" class="Keyword">open</a> <a id="395" href="Graded.Modality.html#5337" class="Module">Modality</a> <a id="404" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="438" href="Graded.Substitution.html#322" class="Bound">M</a>
  <a id="442" class="Keyword">using</a> <a id="448" class="Symbol">(</a><a id="449" href="Definition.Untyped.html#11868" class="Function">Subst</a> <a id="455" class="Symbol">;</a> <a id="457" href="Definition.Untyped.html#12640" class="Function">tail</a> <a id="462" class="Symbol">;</a> <a id="464" href="Definition.Untyped.html#12457" class="Function">head</a> <a id="469" class="Symbol">;</a> <a id="471" href="Definition.Untyped.NotParametrised.html#2135" class="Datatype">Wk</a> <a id="474" class="Symbol">;</a> <a id="476" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a> <a id="479" class="Symbol">;</a> <a id="481" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="486" class="Symbol">;</a> <a id="488" href="Definition.Untyped.NotParametrised.html#2317" class="InductiveConstructor">lift</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="521" href="Graded.Substitution.html#336" class="Bound">𝕄</a>
<a id="523" class="Keyword">open</a> <a id="528" class="Keyword">import</a> <a id="535" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="548" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="550" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="587" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="589" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="591" class="Keyword">open</a> <a id="596" class="Keyword">import</a> <a id="603" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="615" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Tools.Nat.html" class="Module">Tools.Nat</a>

<a id="663" class="Keyword">infixr</a> <a id="670" class="Number">50</a> <a id="673" href="Graded.Substitution.html#1022" class="Function Operator">_*&gt;_</a>
<a id="678" class="Keyword">infix</a>  <a id="685" class="Number">20</a> <a id="688" href="Graded.Substitution.html#1992" class="Function Operator">∥_∥</a>
<a id="692" class="Keyword">infixl</a> <a id="699" class="Number">30</a> <a id="702" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a>

<a id="707" class="Keyword">private</a>
  <a id="717" class="Keyword">variable</a>
    <a id="730" href="Graded.Substitution.html#730" class="Generalizable">k</a> <a id="732" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="734" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="736" class="Symbol">:</a> <a id="738" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="743" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>

<a id="822" class="Keyword">data</a> <a id="Substₘ"></a><a id="827" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="834" class="Symbol">:</a> <a id="836" class="Symbol">(</a><a id="837" href="Graded.Substitution.html#837" class="Bound">m</a> <a id="839" href="Graded.Substitution.html#839" class="Bound">n</a> <a id="841" class="Symbol">:</a> <a id="843" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="846" class="Symbol">)</a> <a id="848" class="Symbol">→</a> <a id="850" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="854" href="Graded.Substitution.html#318" class="Bound">a</a> <a id="856" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="864" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>  <a id="868" class="Symbol">:</a> <a id="870" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="877" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="879" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="883" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a> <a id="887" class="Symbol">:</a> <a id="889" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="896" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="898" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="900" class="Symbol">→</a> <a id="902" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="907" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="909" class="Symbol">→</a> <a id="911" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="918" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="920" class="Symbol">(</a><a id="921" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="924" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="925" class="Symbol">)</a>

<a id="928" class="Keyword">private</a>
  <a id="938" class="Keyword">variable</a>
    <a id="951" href="Graded.Substitution.html#951" class="Generalizable">Ψ</a> <a id="953" href="Graded.Substitution.html#953" class="Generalizable">Φ</a> <a id="955" class="Symbol">:</a> <a id="957" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="964" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="966" href="Graded.Substitution.html#734" class="Generalizable">n</a>

<a id="969" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1022" href="Graded.Substitution.html#1022" class="Function Operator">_*&gt;_</a> <a id="1027" class="Symbol">:</a> <a id="1029" class="Symbol">(</a><a id="1030" href="Graded.Substitution.html#1030" class="Bound">Ψ</a> <a id="1032" class="Symbol">:</a> <a id="1034" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1041" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1043" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1044" class="Symbol">)</a> <a id="1046" class="Symbol">→</a> <a id="1048" class="Symbol">(</a><a id="1049" href="Graded.Substitution.html#1049" class="Bound">γ</a> <a id="1051" class="Symbol">:</a> <a id="1053" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1058" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1059" class="Symbol">)</a> <a id="1061" class="Symbol">→</a> <a id="1063" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1068" href="Graded.Substitution.html#732" class="Generalizable">m</a>
<a id="1070" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1073" href="Graded.Substitution.html#1022" class="Function Operator">*&gt;</a> <a id="1076" href="Graded.Context.html#637" class="InductiveConstructor">ε</a> <a id="1078" class="Symbol">=</a> <a id="1080" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a>
<a id="1083" class="Symbol">(</a><a id="1084" href="Graded.Substitution.html#1084" class="Bound">Ψ</a> <a id="1086" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1088" href="Graded.Substitution.html#1088" class="Bound">δ</a><a id="1089" class="Symbol">)</a> <a id="1091" href="Graded.Substitution.html#1022" class="Function Operator">*&gt;</a> <a id="1094" class="Symbol">(</a><a id="1095" href="Graded.Substitution.html#1095" class="Bound">γ</a> <a id="1097" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1099" href="Graded.Substitution.html#1099" class="Bound">p</a><a id="1100" class="Symbol">)</a> <a id="1102" class="Symbol">=</a> <a id="1104" href="Graded.Substitution.html#1099" class="Bound">p</a> <a id="1106" href="Graded.Context.html#1651" class="Function Operator">·ᶜ</a> <a id="1109" href="Graded.Substitution.html#1088" class="Bound">δ</a> <a id="1111" href="Graded.Context.html#1419" class="Function Operator">+ᶜ</a> <a id="1114" class="Symbol">(</a><a id="1115" href="Graded.Substitution.html#1084" class="Bound">Ψ</a> <a id="1117" href="Graded.Substitution.html#1022" class="Function Operator">*&gt;</a> <a id="1120" href="Graded.Substitution.html#1095" class="Bound">γ</a><a id="1121" class="Symbol">)</a>

<a id="substₘ"></a><a id="1124" href="Graded.Substitution.html#1124" class="Function">substₘ</a> <a id="1131" class="Symbol">=</a> <a id="1133" href="Graded.Substitution.html#1022" class="Function Operator">_*&gt;_</a>

<a id="1139" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1193" href="Graded.Substitution.html#1193" class="Function Operator">_&lt;*_</a> <a id="1198" class="Symbol">:</a> <a id="1200" class="Symbol">(</a><a id="1201" href="Graded.Substitution.html#1201" class="Bound">γ</a> <a id="1203" class="Symbol">:</a> <a id="1205" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1210" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="1211" class="Symbol">)</a> <a id="1213" class="Symbol">→</a> <a id="1215" class="Symbol">(</a><a id="1216" href="Graded.Substitution.html#1216" class="Bound">Ψ</a> <a id="1218" class="Symbol">:</a> <a id="1220" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1227" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1229" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1230" class="Symbol">)</a> <a id="1232" class="Symbol">→</a> <a id="1234" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1239" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1241" href="Graded.Substitution.html#1241" class="Bound">γ</a> <a id="1243" href="Graded.Substitution.html#1193" class="Function Operator">&lt;*</a> <a id="1246" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1249" class="Symbol">=</a> <a id="1251" href="Graded.Context.html#637" class="InductiveConstructor">ε</a>
<a id="1253" href="Graded.Substitution.html#1253" class="Bound">γ</a> <a id="1255" href="Graded.Substitution.html#1193" class="Function Operator">&lt;*</a> <a id="1258" class="Symbol">(</a><a id="1259" href="Graded.Substitution.html#1259" class="Bound">Ψ</a> <a id="1261" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1263" href="Graded.Substitution.html#1263" class="Bound">δ</a><a id="1264" class="Symbol">)</a> <a id="1266" class="Symbol">=</a> <a id="1268" class="Symbol">(</a><a id="1269" href="Graded.Substitution.html#1253" class="Bound">γ</a> <a id="1271" href="Graded.Substitution.html#1193" class="Function Operator">&lt;*</a> <a id="1274" href="Graded.Substitution.html#1259" class="Bound">Ψ</a><a id="1275" class="Symbol">)</a> <a id="1277" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1279" class="Symbol">(</a><a id="1280" href="Graded.Substitution.html#1253" class="Bound">γ</a> <a id="1282" href="Graded.Context.html#1308" class="Function Operator">*</a> <a id="1284" href="Graded.Substitution.html#1263" class="Bound">δ</a><a id="1285" class="Symbol">)</a>

<a id="1288" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1329" href="Graded.Substitution.html#1329" class="Function Operator">_&lt;*&gt;_</a> <a id="1335" class="Symbol">:</a> <a id="1337" class="Symbol">(</a><a id="1338" href="Graded.Substitution.html#1338" class="Bound">Ψ</a> <a id="1340" class="Symbol">:</a> <a id="1342" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1349" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1351" href="Graded.Substitution.html#730" class="Generalizable">k</a><a id="1352" class="Symbol">)</a> <a id="1354" class="Symbol">(</a><a id="1355" href="Graded.Substitution.html#1355" class="Bound">Φ</a> <a id="1357" class="Symbol">:</a> <a id="1359" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1366" href="Graded.Substitution.html#730" class="Generalizable">k</a> <a id="1368" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1369" class="Symbol">)</a> <a id="1371" class="Symbol">→</a> <a id="1373" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1380" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1382" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1384" href="Graded.Substitution.html#1384" class="Bound">Ψ</a> <a id="1386" href="Graded.Substitution.html#1329" class="Function Operator">&lt;*&gt;</a> <a id="1390" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1393" class="Symbol">=</a> <a id="1395" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="1398" href="Graded.Substitution.html#1398" class="Bound">Ψ</a> <a id="1400" href="Graded.Substitution.html#1329" class="Function Operator">&lt;*&gt;</a> <a id="1404" class="Symbol">(</a><a id="1405" href="Graded.Substitution.html#1405" class="Bound">Φ</a> <a id="1407" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1409" href="Graded.Substitution.html#1409" class="Bound">δ</a><a id="1410" class="Symbol">)</a> <a id="1412" class="Symbol">=</a> <a id="1414" class="Symbol">(</a><a id="1415" href="Graded.Substitution.html#1398" class="Bound">Ψ</a> <a id="1417" href="Graded.Substitution.html#1329" class="Function Operator">&lt;*&gt;</a> <a id="1421" href="Graded.Substitution.html#1405" class="Bound">Φ</a><a id="1422" class="Symbol">)</a> <a id="1424" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1426" class="Symbol">(</a><a id="1427" href="Graded.Substitution.html#1398" class="Bound">Ψ</a> <a id="1429" href="Graded.Substitution.html#1022" class="Function Operator">*&gt;</a> <a id="1432" href="Graded.Substitution.html#1409" class="Bound">δ</a><a id="1433" class="Symbol">)</a>

<a id="1436" class="Comment">-- Prepend a substitution matrix with a row</a>

<a id="addrow"></a><a id="1481" href="Graded.Substitution.html#1481" class="Function">addrow</a> <a id="1488" class="Symbol">:</a> <a id="1490" class="Symbol">(</a><a id="1491" href="Graded.Substitution.html#1491" class="Bound">Ψ</a> <a id="1493" class="Symbol">:</a> <a id="1495" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1502" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1504" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1505" class="Symbol">)</a> <a id="1507" class="Symbol">→</a> <a id="1509" class="Symbol">(</a><a id="1510" href="Graded.Substitution.html#1510" class="Bound">γ</a> <a id="1512" class="Symbol">:</a> <a id="1514" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1519" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1520" class="Symbol">)</a> <a id="1522" class="Symbol">→</a> <a id="1524" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1531" class="Symbol">(</a><a id="1532" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="1535" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="1536" class="Symbol">)</a> <a id="1538" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1540" href="Graded.Substitution.html#1481" class="Function">addrow</a> <a id="1547" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1550" href="Graded.Context.html#637" class="InductiveConstructor">ε</a> <a id="1552" class="Symbol">=</a> <a id="1554" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="1557" href="Graded.Substitution.html#1481" class="Function">addrow</a> <a id="1564" class="Symbol">(</a><a id="1565" href="Graded.Substitution.html#1565" class="Bound">Ψ</a> <a id="1567" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1569" href="Graded.Substitution.html#1569" class="Bound">δ</a><a id="1570" class="Symbol">)</a> <a id="1572" class="Symbol">(</a><a id="1573" href="Graded.Substitution.html#1573" class="Bound">γ</a> <a id="1575" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1577" href="Graded.Substitution.html#1577" class="Bound">p</a><a id="1578" class="Symbol">)</a> <a id="1580" class="Symbol">=</a> <a id="1582" href="Graded.Substitution.html#1481" class="Function">addrow</a> <a id="1589" href="Graded.Substitution.html#1565" class="Bound">Ψ</a> <a id="1591" href="Graded.Substitution.html#1573" class="Bound">γ</a> <a id="1593" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1595" class="Symbol">(</a><a id="1596" href="Graded.Substitution.html#1569" class="Bound">δ</a> <a id="1598" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1600" href="Graded.Substitution.html#1577" class="Bound">p</a><a id="1601" class="Symbol">)</a>

<a id="1604" class="Comment">---------------------------------------------------------------</a>

<a id="1669" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1740" class="Comment">-- γ_x is the x-th column vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1807" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1823" href="Graded.Substitution.html#1823" class="Function Operator">_▶[_]_</a> <a id="1830" class="Symbol">:</a> <a id="1832" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1839" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1841" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1843" class="Symbol">→</a> <a id="1845" href="Graded.Mode.html#4328" class="Function">Mode-vector</a> <a id="1857" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1859" class="Symbol">→</a> <a id="1861" href="Definition.Untyped.html#11868" class="Function">Subst</a> <a id="1867" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1869" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1871" class="Symbol">→</a> <a id="1873" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1877" href="Graded.Substitution.html#318" class="Bound">a</a>
<a id="1879" href="Graded.Substitution.html#1823" class="Function Operator">_▶[_]_</a> <a id="1886" class="Symbol">{</a><a id="1887" class="Argument">n</a> <a id="1889" class="Symbol">=</a> <a id="1891" href="Graded.Substitution.html#1891" class="Bound">n</a><a id="1892" class="Symbol">}</a> <a id="1894" href="Graded.Substitution.html#1894" class="Bound">Ψ</a> <a id="1896" href="Graded.Substitution.html#1896" class="Bound">γ</a> <a id="1898" href="Graded.Substitution.html#1898" class="Bound">σ</a> <a id="1900" class="Symbol">=</a>
  <a id="1904" class="Symbol">(</a><a id="1905" href="Graded.Substitution.html#1905" class="Bound">x</a> <a id="1907" class="Symbol">:</a> <a id="1909" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1913" href="Graded.Substitution.html#1891" class="Bound">n</a><a id="1914" class="Symbol">)</a> <a id="1916" class="Symbol">→</a> <a id="1918" class="Symbol">(</a><a id="1919" href="Graded.Substitution.html#1894" class="Bound">Ψ</a> <a id="1921" href="Graded.Substitution.html#1022" class="Function Operator">*&gt;</a> <a id="1924" class="Symbol">(</a><a id="1925" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="1928" href="Graded.Context.html#1025" class="Function Operator">,</a> <a id="1930" href="Graded.Substitution.html#1905" class="Bound">x</a> <a id="1932" href="Graded.Context.html#1025" class="Function Operator">≔</a> <a id="1934" href="Graded.Mode.html#3612" class="Function Operator">⌜</a> <a id="1936" href="Graded.Substitution.html#1896" class="Bound">γ</a> <a id="1938" href="Graded.Substitution.html#1905" class="Bound">x</a> <a id="1940" href="Graded.Mode.html#3612" class="Function Operator">⌝</a><a id="1941" class="Symbol">))</a> <a id="1944" href="Graded.Usage.html#1086" class="Datatype Operator">▸[</a> <a id="1947" href="Graded.Substitution.html#1896" class="Bound">γ</a> <a id="1949" href="Graded.Substitution.html#1905" class="Bound">x</a> <a id="1951" href="Graded.Usage.html#1086" class="Datatype Operator">]</a> <a id="1953" href="Graded.Substitution.html#1898" class="Bound">σ</a> <a id="1955" href="Graded.Substitution.html#1905" class="Bound">x</a>

<a id="1958" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="1992" href="Graded.Substitution.html#1992" class="Function Operator">∥_∥</a> <a id="1996" class="Symbol">:</a> <a id="1998" href="Definition.Untyped.html#11868" class="Function">Subst</a> <a id="2004" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2006" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2008" class="Symbol">→</a> <a id="2010" href="Graded.Mode.html#4328" class="Function">Mode-vector</a> <a id="2022" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2024" class="Symbol">→</a> <a id="2026" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2033" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2035" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2037" href="Graded.Substitution.html#1992" class="Function Operator">∥_∥</a> <a id="2041" class="Symbol">{</a><a id="2042" class="Argument">n</a> <a id="2044" class="Symbol">=</a> <a id="2046" class="Number">0</a><a id="2047" class="Symbol">}</a>    <a id="2052" class="Symbol">_</a> <a id="2054" class="Symbol">_</a>  <a id="2057" class="Symbol">=</a> <a id="2059" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2062" href="Graded.Substitution.html#1992" class="Function Operator">∥_∥</a> <a id="2066" class="Symbol">{</a><a id="2067" class="Argument">n</a> <a id="2069" class="Symbol">=</a> <a id="2071" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2074" href="Graded.Substitution.html#2074" class="Bound">n</a><a id="2075" class="Symbol">}</a> <a id="2077" href="Graded.Substitution.html#2077" class="Bound">σ</a> <a id="2079" href="Graded.Substitution.html#2079" class="Bound">ms</a> <a id="2082" class="Symbol">=</a> <a id="2084" href="Graded.Substitution.html#1992" class="Function Operator">∥</a> <a id="2086" href="Definition.Untyped.html#12640" class="Function">tail</a> <a id="2091" href="Graded.Substitution.html#2077" class="Bound">σ</a> <a id="2093" href="Graded.Substitution.html#1992" class="Function Operator">∥</a> <a id="2095" class="Symbol">(</a><a id="2096" href="Graded.Mode.html#4728" class="Function">tailᵐ</a> <a id="2102" href="Graded.Substitution.html#2079" class="Bound">ms</a><a id="2104" class="Symbol">)</a> <a id="2106" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2108" href="Graded.Usage.html#2826" class="Function Operator">⌈</a> <a id="2110" href="Definition.Untyped.html#12457" class="Function">head</a> <a id="2115" href="Graded.Substitution.html#2077" class="Bound">σ</a> <a id="2117" href="Graded.Usage.html#2826" class="Function Operator">⌉</a> <a id="2119" class="Symbol">(</a><a id="2120" href="Graded.Mode.html#4645" class="Function">headᵐ</a> <a id="2126" href="Graded.Substitution.html#2079" class="Bound">ms</a><a id="2128" class="Symbol">)</a>

<a id="2131" class="Comment">---------------------------------------------------------------</a>
<a id="2195" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2259" class="Comment">---------------------------------------------------------------</a>

<a id="2324" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2375" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2385" class="Symbol">:</a> <a id="2387" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2394" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2396" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2398" class="Symbol">→</a> <a id="2400" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2407" class="Symbol">(</a><a id="2408" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2411" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="2412" class="Symbol">)</a> <a id="2414" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2416" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2426" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="2429" class="Symbol">=</a> <a id="2431" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2434" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2444" class="Symbol">(</a><a id="2445" href="Graded.Substitution.html#2445" class="Bound">Ψ</a> <a id="2447" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2449" href="Graded.Substitution.html#2449" class="Bound">δ</a><a id="2450" class="Symbol">)</a> <a id="2452" class="Symbol">=</a> <a id="2454" class="Symbol">(</a><a id="2455" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2465" href="Graded.Substitution.html#2445" class="Bound">Ψ</a><a id="2466" class="Symbol">)</a> <a id="2468" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2470" href="Graded.Usage.Weakening.html#1395" class="Function">wkConₘ</a> <a id="2477" class="Symbol">(</a><a id="2478" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="2483" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a><a id="2485" class="Symbol">)</a> <a id="2487" href="Graded.Substitution.html#2449" class="Bound">δ</a>

<a id="2490" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2524" href="Graded.Substitution.html#2524" class="Function">liftSubstₘ</a> <a id="2535" class="Symbol">:</a> <a id="2537" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2544" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2546" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2548" class="Symbol">→</a> <a id="2550" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2557" class="Symbol">(</a><a id="2558" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2561" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="2562" class="Symbol">)</a> <a id="2564" class="Symbol">(</a><a id="2565" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2568" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="2569" class="Symbol">)</a>
<a id="2571" href="Graded.Substitution.html#2524" class="Function">liftSubstₘ</a> <a id="2582" href="Graded.Substitution.html#2582" class="Bound">Ψ</a> <a id="2584" class="Symbol">=</a> <a id="2586" class="Symbol">(</a><a id="2587" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2597" href="Graded.Substitution.html#2582" class="Bound">Ψ</a><a id="2598" class="Symbol">)</a> <a id="2600" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2602" class="Symbol">(</a><a id="2603" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="2606" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="2608" href="Graded.Modality.html#819" class="Function">𝟙</a><a id="2609" class="Symbol">)</a>

<a id="2612" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2645" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a> <a id="2654" class="Symbol">:</a> <a id="2656" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2663" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2665" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2667" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a> <a id="2676" class="Symbol">{</a><a id="2677" class="Argument">n</a> <a id="2679" class="Symbol">=</a> <a id="2681" class="Number">0</a><a id="2682" class="Symbol">}</a> <a id="2684" class="Symbol">=</a> <a id="2686" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2689" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a> <a id="2698" class="Symbol">{</a><a id="2699" class="Argument">n</a> <a id="2701" class="Symbol">=</a> <a id="2703" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2706" href="Graded.Substitution.html#2706" class="Bound">n</a><a id="2707" class="Symbol">}</a> <a id="2709" class="Symbol">=</a> <a id="2711" href="Graded.Substitution.html#2524" class="Function">liftSubstₘ</a> <a id="2722" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a>

<a id="2732" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2773" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2782" class="Symbol">:</a> <a id="2784" class="Symbol">(</a><a id="2785" href="Graded.Substitution.html#2785" class="Bound">ρ</a> <a id="2787" class="Symbol">:</a> <a id="2789" href="Definition.Untyped.NotParametrised.html#2135" class="Datatype">Wk</a> <a id="2792" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2794" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="2795" class="Symbol">)</a> <a id="2797" class="Symbol">→</a> <a id="2799" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2806" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2808" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2810" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2819" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a>       <a id="2828" class="Symbol">=</a> <a id="2830" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a>
<a id="2839" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2848" class="Symbol">(</a><a id="2849" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="2854" href="Graded.Substitution.html#2854" class="Bound">ρ</a><a id="2855" class="Symbol">)</a> <a id="2857" class="Symbol">=</a> <a id="2859" href="Graded.Substitution.html#2375" class="Function">wk1Substₘ</a> <a id="2869" class="Symbol">(</a><a id="2870" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2879" href="Graded.Substitution.html#2854" class="Bound">ρ</a><a id="2880" class="Symbol">)</a>
<a id="2882" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2891" class="Symbol">(</a><a id="2892" href="Definition.Untyped.NotParametrised.html#2317" class="InductiveConstructor">lift</a> <a id="2897" href="Graded.Substitution.html#2897" class="Bound">ρ</a><a id="2898" class="Symbol">)</a> <a id="2900" class="Symbol">=</a> <a id="2902" href="Graded.Substitution.html#2524" class="Function">liftSubstₘ</a> <a id="2913" class="Symbol">(</a><a id="2914" href="Graded.Substitution.html#2773" class="Function">wkSubstₘ</a> <a id="2923" href="Graded.Substitution.html#2897" class="Bound">ρ</a><a id="2924" class="Symbol">)</a>

<a id="2927" class="Comment">------------------------------------------------------------------</a>
<a id="2994" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3061" class="Comment">------------------------------------------------------------------</a>

<a id="3129" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3195" href="Graded.Substitution.html#3195" class="Function">consSubstₘ</a> <a id="3206" class="Symbol">:</a> <a id="3208" class="Symbol">(</a><a id="3209" href="Graded.Substitution.html#3209" class="Bound">Ψ</a> <a id="3211" class="Symbol">:</a> <a id="3213" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3220" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="3222" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3223" class="Symbol">)</a> <a id="3225" class="Symbol">→</a> <a id="3227" class="Symbol">(</a><a id="3228" href="Graded.Substitution.html#3228" class="Bound">γ</a> <a id="3230" class="Symbol">:</a> <a id="3232" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3237" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="3238" class="Symbol">)</a> <a id="3240" class="Symbol">→</a> <a id="3242" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3249" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="3251" class="Symbol">(</a><a id="3252" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3255" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3256" class="Symbol">)</a>
<a id="3258" href="Graded.Substitution.html#3195" class="Function">consSubstₘ</a> <a id="3269" class="Symbol">=</a> <a id="3271" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a>

<a id="3276" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3312" href="Graded.Substitution.html#3312" class="Function">sgSubstₘ</a> <a id="3321" class="Symbol">:</a> <a id="3323" class="Symbol">(</a><a id="3324" href="Graded.Substitution.html#3324" class="Bound">γ</a> <a id="3326" class="Symbol">:</a> <a id="3328" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3333" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3334" class="Symbol">)</a> <a id="3336" class="Symbol">→</a> <a id="3338" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3345" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="3347" class="Symbol">(</a><a id="3348" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3351" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3352" class="Symbol">)</a>
<a id="3354" href="Graded.Substitution.html#3312" class="Function">sgSubstₘ</a> <a id="3363" class="Symbol">=</a> <a id="3365" href="Graded.Substitution.html#3195" class="Function">consSubstₘ</a> <a id="3376" href="Graded.Substitution.html#2645" class="Function">idSubstₘ</a>
</pre></body></html>