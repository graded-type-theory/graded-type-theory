<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="288" class="Keyword">module</a> <a id="295" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="317" class="Symbol">{</a><a id="318" href="Graded.Substitution.html#318" class="Bound">a</a><a id="319" class="Symbol">}</a> <a id="321" class="Symbol">{</a><a id="322" href="Graded.Substitution.html#322" class="Bound">M</a> <a id="324" class="Symbol">:</a> <a id="326" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="330" href="Graded.Substitution.html#318" class="Bound">a</a><a id="331" class="Symbol">}</a>
  <a id="335" class="Symbol">(</a><a id="336" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="338" class="Symbol">:</a> <a id="340" href="Graded.Modality.html#5274" class="Record">Modality</a> <a id="349" href="Graded.Substitution.html#322" class="Bound">M</a><a id="350" class="Symbol">)</a>
  <a id="354" class="Symbol">(</a><a id="355" href="Graded.Substitution.html#355" class="Bound">R</a> <a id="357" class="Symbol">:</a> <a id="359" href="Graded.Usage.Restrictions.html#316" class="Record">Usage-restrictions</a> <a id="378" href="Graded.Substitution.html#322" class="Bound">M</a><a id="379" class="Symbol">)</a>
  <a id="383" class="Keyword">where</a>

<a id="390" class="Keyword">open</a> <a id="395" href="Graded.Modality.html#5274" class="Module">Modality</a> <a id="404" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="438" href="Graded.Substitution.html#322" class="Bound">M</a>
  <a id="442" class="Keyword">using</a> <a id="448" class="Symbol">(</a><a id="449" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="455" class="Symbol">;</a> <a id="457" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="462" class="Symbol">;</a> <a id="464" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="469" class="Symbol">;</a> <a id="471" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="474" class="Symbol">;</a> <a id="476" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a> <a id="479" class="Symbol">;</a> <a id="481" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="486" class="Symbol">;</a> <a id="488" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="521" href="Graded.Substitution.html#336" class="Bound">𝕄</a>
<a id="523" class="Keyword">open</a> <a id="528" class="Keyword">import</a> <a id="535" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="548" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="550" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="587" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="589" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="591" class="Keyword">open</a> <a id="596" class="Keyword">import</a> <a id="603" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="615" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Tools.Nat.html" class="Module">Tools.Nat</a>

<a id="663" class="Keyword">infixl</a> <a id="670" class="Number">50</a> <a id="673" href="Graded.Substitution.html#1330" class="Function Operator">_&lt;*_</a>
<a id="678" class="Keyword">infixr</a> <a id="685" class="Number">50</a> <a id="688" href="Graded.Substitution.html#1185" class="Function Operator">_*&gt;_</a>
<a id="693" class="Keyword">infix</a>  <a id="700" class="Number">20</a> <a id="703" href="Graded.Substitution.html#2036" class="Function Operator">∥_∥</a>
<a id="707" class="Keyword">infixl</a> <a id="714" class="Number">30</a> <a id="717" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">_⊙_</a>

<a id="722" class="Keyword">private</a>
  <a id="732" class="Keyword">variable</a>
    <a id="745" href="Graded.Substitution.html#745" class="Generalizable">k</a> <a id="747" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="749" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="751" class="Symbol">:</a> <a id="753" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="758" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>
<a id="836" class="Comment">-- Ψ : Substₘ m n is an n×m-matrix.</a>

<a id="873" class="Keyword">data</a> <a id="Substₘ"></a><a id="878" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="885" class="Symbol">:</a> <a id="887" class="Symbol">(</a><a id="888" href="Graded.Substitution.html#888" class="Bound">m</a> <a id="890" href="Graded.Substitution.html#890" class="Bound">n</a> <a id="892" class="Symbol">:</a> <a id="894" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="897" class="Symbol">)</a> <a id="899" class="Symbol">→</a> <a id="901" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="905" href="Graded.Substitution.html#318" class="Bound">a</a> <a id="907" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="915" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>  <a id="919" class="Symbol">:</a> <a id="921" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="928" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="930" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="934" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">_⊙_</a> <a id="938" class="Symbol">:</a> <a id="940" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="947" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="949" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="951" class="Symbol">→</a> <a id="953" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="958" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="960" class="Symbol">→</a> <a id="962" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="969" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="971" class="Symbol">(</a><a id="972" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="975" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="976" class="Symbol">)</a>

<a id="979" class="Keyword">private</a>
  <a id="989" class="Keyword">variable</a>
    <a id="1002" href="Graded.Substitution.html#1002" class="Generalizable">Ψ</a> <a id="1004" href="Graded.Substitution.html#1004" class="Generalizable">Φ</a> <a id="1006" class="Symbol">:</a> <a id="1008" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1015" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1017" href="Graded.Substitution.html#749" class="Generalizable">n</a>

<a id="1020" class="Comment">-- Substitutions that contain empty usage contexts.</a>

<a id="εₘ"></a><a id="1073" href="Graded.Substitution.html#1073" class="Function">εₘ</a> <a id="1076" class="Symbol">:</a> <a id="1078" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1085" class="Number">0</a> <a id="1087" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="1089" href="Graded.Substitution.html#1073" class="Function">εₘ</a> <a id="1092" class="Symbol">{</a><a id="1093" class="Argument">n</a> <a id="1095" class="Symbol">=</a> <a id="1097" class="Number">0</a><a id="1098" class="Symbol">}</a>    <a id="1103" class="Symbol">=</a> <a id="1105" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>
<a id="1108" href="Graded.Substitution.html#1073" class="Function">εₘ</a> <a id="1111" class="Symbol">{</a><a id="1112" class="Argument">n</a> <a id="1114" class="Symbol">=</a> <a id="1116" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="1119" href="Graded.Substitution.html#1119" class="Bound">n</a><a id="1120" class="Symbol">}</a> <a id="1122" class="Symbol">=</a> <a id="1124" href="Graded.Substitution.html#1073" class="Function">εₘ</a> <a id="1127" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="1129" href="Graded.Context.html#637" class="InductiveConstructor">ε</a>

<a id="1132" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1185" href="Graded.Substitution.html#1185" class="Function Operator">_*&gt;_</a> <a id="1190" class="Symbol">:</a> <a id="1192" class="Symbol">(</a><a id="1193" href="Graded.Substitution.html#1193" class="Bound">Ψ</a> <a id="1195" class="Symbol">:</a> <a id="1197" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1204" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1206" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1207" class="Symbol">)</a> <a id="1209" class="Symbol">→</a> <a id="1211" class="Symbol">(</a><a id="1212" href="Graded.Substitution.html#1212" class="Bound">γ</a> <a id="1214" class="Symbol">:</a> <a id="1216" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1221" href="Graded.Substitution.html#747" class="Generalizable">m</a><a id="1222" class="Symbol">)</a> <a id="1224" class="Symbol">→</a> <a id="1226" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1231" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="1233" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a> <a id="1236" href="Graded.Substitution.html#1185" class="Function Operator">*&gt;</a> <a id="1239" href="Graded.Substitution.html#1239" class="Bound">γ</a> <a id="1241" class="Symbol">=</a> <a id="1243" href="Graded.Context.html#637" class="InductiveConstructor">ε</a>
<a id="1245" class="Symbol">(</a><a id="1246" href="Graded.Substitution.html#1246" class="Bound">Ψ</a> <a id="1248" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="1250" href="Graded.Substitution.html#1250" class="Bound">δ</a><a id="1251" class="Symbol">)</a> <a id="1253" href="Graded.Substitution.html#1185" class="Function Operator">*&gt;</a> <a id="1256" href="Graded.Substitution.html#1256" class="Bound">γ</a> <a id="1258" class="Symbol">=</a> <a id="1260" href="Graded.Substitution.html#1246" class="Bound">Ψ</a> <a id="1262" href="Graded.Substitution.html#1185" class="Function Operator">*&gt;</a> <a id="1265" href="Graded.Substitution.html#1256" class="Bound">γ</a> <a id="1267" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1269" href="Graded.Substitution.html#1256" class="Bound">γ</a> <a id="1271" href="Graded.Context.html#1308" class="Function Operator">*</a> <a id="1273" href="Graded.Substitution.html#1250" class="Bound">δ</a>

<a id="1276" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1330" href="Graded.Substitution.html#1330" class="Function Operator">_&lt;*_</a> <a id="1335" class="Symbol">:</a> <a id="1337" class="Symbol">(</a><a id="1338" href="Graded.Substitution.html#1338" class="Bound">γ</a> <a id="1340" class="Symbol">:</a> <a id="1342" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1347" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1348" class="Symbol">)</a> <a id="1350" class="Symbol">→</a> <a id="1352" class="Symbol">(</a><a id="1353" href="Graded.Substitution.html#1353" class="Bound">Ψ</a> <a id="1355" class="Symbol">:</a> <a id="1357" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1364" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1366" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1367" class="Symbol">)</a> <a id="1369" class="Symbol">→</a> <a id="1371" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1376" href="Graded.Substitution.html#747" class="Generalizable">m</a>
<a id="1378" href="Graded.Context.html#637" class="InductiveConstructor">ε</a> <a id="1380" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1383" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a> <a id="1386" class="Symbol">=</a> <a id="1388" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a>
<a id="1391" class="Symbol">(</a><a id="1392" href="Graded.Substitution.html#1392" class="Bound">γ</a> <a id="1394" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1396" href="Graded.Substitution.html#1396" class="Bound">p</a><a id="1397" class="Symbol">)</a> <a id="1399" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1402" class="Symbol">(</a><a id="1403" href="Graded.Substitution.html#1403" class="Bound">Ψ</a> <a id="1405" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="1407" href="Graded.Substitution.html#1407" class="Bound">δ</a><a id="1408" class="Symbol">)</a> <a id="1410" class="Symbol">=</a> <a id="1412" href="Graded.Substitution.html#1396" class="Bound">p</a> <a id="1414" href="Graded.Context.html#1651" class="Function Operator">·ᶜ</a> <a id="1417" href="Graded.Substitution.html#1407" class="Bound">δ</a> <a id="1419" href="Graded.Context.html#1419" class="Function Operator">+ᶜ</a> <a id="1422" class="Symbol">(</a><a id="1423" href="Graded.Substitution.html#1392" class="Bound">γ</a> <a id="1425" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1428" href="Graded.Substitution.html#1403" class="Bound">Ψ</a><a id="1429" class="Symbol">)</a>

<a id="substₘ"></a><a id="1432" href="Graded.Substitution.html#1432" class="Function">substₘ</a> <a id="1439" class="Symbol">:</a> <a id="1441" class="Symbol">(</a><a id="1442" href="Graded.Substitution.html#1442" class="Bound">Ψ</a> <a id="1444" class="Symbol">:</a> <a id="1446" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1453" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1455" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1456" class="Symbol">)</a> <a id="1458" class="Symbol">→</a> <a id="1460" class="Symbol">(</a><a id="1461" href="Graded.Substitution.html#1461" class="Bound">γ</a> <a id="1463" class="Symbol">:</a> <a id="1465" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1470" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1471" class="Symbol">)</a> <a id="1473" class="Symbol">→</a> <a id="1475" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1480" href="Graded.Substitution.html#747" class="Generalizable">m</a>
<a id="1482" href="Graded.Substitution.html#1432" class="Function">substₘ</a> <a id="1489" href="Graded.Substitution.html#1489" class="Bound">Ψ</a> <a id="1491" href="Graded.Substitution.html#1491" class="Bound">γ</a> <a id="1493" class="Symbol">=</a> <a id="1495" href="Graded.Substitution.html#1491" class="Bound">γ</a> <a id="1497" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1500" href="Graded.Substitution.html#1489" class="Bound">Ψ</a>

<a id="1503" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1544" href="Graded.Substitution.html#1544" class="Function Operator">_&lt;*&gt;_</a> <a id="1550" class="Symbol">:</a> <a id="1552" class="Symbol">(</a><a id="1553" href="Graded.Substitution.html#1553" class="Bound">Ψ</a> <a id="1555" class="Symbol">:</a> <a id="1557" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1564" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1566" href="Graded.Substitution.html#745" class="Generalizable">k</a><a id="1567" class="Symbol">)</a> <a id="1569" class="Symbol">(</a><a id="1570" href="Graded.Substitution.html#1570" class="Bound">Φ</a> <a id="1572" class="Symbol">:</a> <a id="1574" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1581" href="Graded.Substitution.html#745" class="Generalizable">k</a> <a id="1583" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="1584" class="Symbol">)</a> <a id="1586" class="Symbol">→</a> <a id="1588" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1595" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1597" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="1599" href="Graded.Substitution.html#1599" class="Bound">Ψ</a> <a id="1601" href="Graded.Substitution.html#1544" class="Function Operator">&lt;*&gt;</a> <a id="1605" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a> <a id="1608" class="Symbol">=</a> <a id="1610" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>
<a id="1613" href="Graded.Substitution.html#1613" class="Bound">Ψ</a> <a id="1615" href="Graded.Substitution.html#1544" class="Function Operator">&lt;*&gt;</a> <a id="1619" class="Symbol">(</a><a id="1620" href="Graded.Substitution.html#1620" class="Bound">Φ</a> <a id="1622" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="1624" href="Graded.Substitution.html#1624" class="Bound">δ</a><a id="1625" class="Symbol">)</a> <a id="1627" class="Symbol">=</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Graded.Substitution.html#1613" class="Bound">Ψ</a> <a id="1632" href="Graded.Substitution.html#1544" class="Function Operator">&lt;*&gt;</a> <a id="1636" href="Graded.Substitution.html#1620" class="Bound">Φ</a><a id="1637" class="Symbol">)</a> <a id="1639" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="1641" class="Symbol">(</a><a id="1642" href="Graded.Substitution.html#1624" class="Bound">δ</a> <a id="1644" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1647" href="Graded.Substitution.html#1613" class="Bound">Ψ</a><a id="1648" class="Symbol">)</a>

<a id="1651" class="Comment">---------------------------------------------------------------</a>

<a id="1716" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1787" class="Comment">-- γ_x is the x-th row vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1851" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1867" href="Graded.Substitution.html#1867" class="Function Operator">_▶[_]_</a> <a id="1874" class="Symbol">:</a> <a id="1876" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="1883" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1885" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="1887" class="Symbol">→</a> <a id="1889" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="1901" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="1903" class="Symbol">→</a> <a id="1905" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="1911" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="1913" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="1915" class="Symbol">→</a> <a id="1917" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1921" href="Graded.Substitution.html#318" class="Bound">a</a>
<a id="1923" href="Graded.Substitution.html#1867" class="Function Operator">_▶[_]_</a> <a id="1930" class="Symbol">{</a><a id="1931" class="Argument">n</a> <a id="1933" class="Symbol">=</a> <a id="1935" href="Graded.Substitution.html#1935" class="Bound">n</a><a id="1936" class="Symbol">}</a> <a id="1938" href="Graded.Substitution.html#1938" class="Bound">Ψ</a> <a id="1940" href="Graded.Substitution.html#1940" class="Bound">γ</a> <a id="1942" href="Graded.Substitution.html#1942" class="Bound">σ</a> <a id="1944" class="Symbol">=</a>
  <a id="1948" class="Symbol">(</a><a id="1949" href="Graded.Substitution.html#1949" class="Bound">x</a> <a id="1951" class="Symbol">:</a> <a id="1953" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1957" href="Graded.Substitution.html#1935" class="Bound">n</a><a id="1958" class="Symbol">)</a> <a id="1960" class="Symbol">→</a> <a id="1962" class="Symbol">((</a><a id="1964" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="1967" href="Graded.Context.html#1025" class="Function Operator">,</a> <a id="1969" href="Graded.Substitution.html#1949" class="Bound">x</a> <a id="1971" href="Graded.Context.html#1025" class="Function Operator">≔</a> <a id="1973" href="Graded.Mode.html#3577" class="Function Operator">⌜</a> <a id="1975" href="Graded.Substitution.html#1940" class="Bound">γ</a> <a id="1977" href="Graded.Substitution.html#1949" class="Bound">x</a> <a id="1979" href="Graded.Mode.html#3577" class="Function Operator">⌝</a><a id="1980" class="Symbol">)</a> <a id="1982" href="Graded.Substitution.html#1330" class="Function Operator">&lt;*</a> <a id="1985" href="Graded.Substitution.html#1938" class="Bound">Ψ</a><a id="1986" class="Symbol">)</a> <a id="1988" href="Graded.Usage.html#1080" class="Datatype Operator">▸[</a> <a id="1991" href="Graded.Substitution.html#1940" class="Bound">γ</a> <a id="1993" href="Graded.Substitution.html#1949" class="Bound">x</a> <a id="1995" href="Graded.Usage.html#1080" class="Datatype Operator">]</a> <a id="1997" href="Graded.Substitution.html#1942" class="Bound">σ</a> <a id="1999" href="Graded.Substitution.html#1949" class="Bound">x</a>

<a id="2002" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="2036" href="Graded.Substitution.html#2036" class="Function Operator">∥_∥</a> <a id="2040" class="Symbol">:</a> <a id="2042" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="2048" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2050" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="2052" class="Symbol">→</a> <a id="2054" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="2066" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="2068" class="Symbol">→</a> <a id="2070" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2077" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2079" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="2081" href="Graded.Substitution.html#2036" class="Function Operator">∥_∥</a> <a id="2085" class="Symbol">{</a><a id="2086" class="Argument">n</a> <a id="2088" class="Symbol">=</a> <a id="2090" class="Number">0</a><a id="2091" class="Symbol">}</a>    <a id="2096" class="Symbol">_</a> <a id="2098" class="Symbol">_</a>  <a id="2101" class="Symbol">=</a> <a id="2103" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>
<a id="2106" href="Graded.Substitution.html#2036" class="Function Operator">∥_∥</a> <a id="2110" class="Symbol">{</a><a id="2111" class="Argument">n</a> <a id="2113" class="Symbol">=</a> <a id="2115" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2118" href="Graded.Substitution.html#2118" class="Bound">n</a><a id="2119" class="Symbol">}</a> <a id="2121" href="Graded.Substitution.html#2121" class="Bound">σ</a> <a id="2123" href="Graded.Substitution.html#2123" class="Bound">ms</a> <a id="2126" class="Symbol">=</a> <a id="2128" href="Graded.Substitution.html#2036" class="Function Operator">∥</a> <a id="2130" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="2135" href="Graded.Substitution.html#2121" class="Bound">σ</a> <a id="2137" href="Graded.Substitution.html#2036" class="Function Operator">∥</a> <a id="2139" class="Symbol">(</a><a id="2140" href="Graded.Mode.html#4693" class="Function">tailᵐ</a> <a id="2146" href="Graded.Substitution.html#2123" class="Bound">ms</a><a id="2148" class="Symbol">)</a> <a id="2150" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="2152" href="Graded.Usage.html#2810" class="Function Operator">⌈</a> <a id="2154" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="2159" href="Graded.Substitution.html#2121" class="Bound">σ</a> <a id="2161" href="Graded.Usage.html#2810" class="Function Operator">⌉</a> <a id="2163" class="Symbol">(</a><a id="2164" href="Graded.Mode.html#4610" class="Function">headᵐ</a> <a id="2170" href="Graded.Substitution.html#2123" class="Bound">ms</a><a id="2172" class="Symbol">)</a>

<a id="2175" class="Comment">---------------------------------------------------------------</a>
<a id="2239" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2303" class="Comment">---------------------------------------------------------------</a>

<a id="2368" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2419" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2429" class="Symbol">:</a> <a id="2431" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2438" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2440" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="2442" class="Symbol">→</a> <a id="2444" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2451" class="Symbol">(</a><a id="2452" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2455" href="Graded.Substitution.html#747" class="Generalizable">m</a><a id="2456" class="Symbol">)</a> <a id="2458" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="2460" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2470" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a> <a id="2473" class="Symbol">=</a> <a id="2475" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>
<a id="2478" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2488" class="Symbol">(</a><a id="2489" href="Graded.Substitution.html#2489" class="Bound">Ψ</a> <a id="2491" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="2493" href="Graded.Substitution.html#2493" class="Bound">δ</a><a id="2494" class="Symbol">)</a> <a id="2496" class="Symbol">=</a> <a id="2498" class="Symbol">(</a><a id="2499" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2509" href="Graded.Substitution.html#2489" class="Bound">Ψ</a><a id="2510" class="Symbol">)</a> <a id="2512" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="2514" href="Graded.Usage.Weakening.html#1374" class="Function">wkConₘ</a> <a id="2521" class="Symbol">(</a><a id="2522" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2527" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a><a id="2529" class="Symbol">)</a> <a id="2531" href="Graded.Substitution.html#2493" class="Bound">δ</a>

<a id="2534" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2568" href="Graded.Substitution.html#2568" class="Function">liftSubstₘ</a> <a id="2579" class="Symbol">:</a> <a id="2581" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2588" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2590" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="2592" class="Symbol">→</a> <a id="2594" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2601" class="Symbol">(</a><a id="2602" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2605" href="Graded.Substitution.html#747" class="Generalizable">m</a><a id="2606" class="Symbol">)</a> <a id="2608" class="Symbol">(</a><a id="2609" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2612" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="2613" class="Symbol">)</a>
<a id="2615" href="Graded.Substitution.html#2568" class="Function">liftSubstₘ</a> <a id="2626" href="Graded.Substitution.html#2626" class="Bound">Ψ</a> <a id="2628" class="Symbol">=</a> <a id="2630" class="Symbol">(</a><a id="2631" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2641" href="Graded.Substitution.html#2626" class="Bound">Ψ</a><a id="2642" class="Symbol">)</a> <a id="2644" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">⊙</a> <a id="2646" class="Symbol">(</a><a id="2647" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="2650" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="2652" href="Graded.Modality.html#819" class="Function">𝟙</a><a id="2653" class="Symbol">)</a>

<a id="2656" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2689" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a> <a id="2698" class="Symbol">:</a> <a id="2700" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2707" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="2709" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="2711" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a> <a id="2720" class="Symbol">{</a><a id="2721" class="Argument">n</a> <a id="2723" class="Symbol">=</a> <a id="2725" class="Number">0</a><a id="2726" class="Symbol">}</a> <a id="2728" class="Symbol">=</a> <a id="2730" href="Graded.Substitution.html#915" class="InductiveConstructor">[]</a>
<a id="2733" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a> <a id="2742" class="Symbol">{</a><a id="2743" class="Argument">n</a> <a id="2745" class="Symbol">=</a> <a id="2747" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2750" href="Graded.Substitution.html#2750" class="Bound">n</a><a id="2751" class="Symbol">}</a> <a id="2753" class="Symbol">=</a> <a id="2755" href="Graded.Substitution.html#2568" class="Function">liftSubstₘ</a> <a id="2766" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a>

<a id="2776" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2817" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2826" class="Symbol">:</a> <a id="2828" class="Symbol">(</a><a id="2829" href="Graded.Substitution.html#2829" class="Bound">ρ</a> <a id="2831" class="Symbol">:</a> <a id="2833" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="2836" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2838" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="2839" class="Symbol">)</a> <a id="2841" class="Symbol">→</a> <a id="2843" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="2850" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="2852" href="Graded.Substitution.html#749" class="Generalizable">n</a>
<a id="2854" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2863" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a>       <a id="2872" class="Symbol">=</a> <a id="2874" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a>
<a id="2883" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2892" class="Symbol">(</a><a id="2893" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2898" href="Graded.Substitution.html#2898" class="Bound">ρ</a><a id="2899" class="Symbol">)</a> <a id="2901" class="Symbol">=</a> <a id="2903" href="Graded.Substitution.html#2419" class="Function">wk1Substₘ</a> <a id="2913" class="Symbol">(</a><a id="2914" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2923" href="Graded.Substitution.html#2898" class="Bound">ρ</a><a id="2924" class="Symbol">)</a>
<a id="2926" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2935" class="Symbol">(</a><a id="2936" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a> <a id="2941" href="Graded.Substitution.html#2941" class="Bound">ρ</a><a id="2942" class="Symbol">)</a> <a id="2944" class="Symbol">=</a> <a id="2946" href="Graded.Substitution.html#2568" class="Function">liftSubstₘ</a> <a id="2957" class="Symbol">(</a><a id="2958" href="Graded.Substitution.html#2817" class="Function">wkSubstₘ</a> <a id="2967" href="Graded.Substitution.html#2941" class="Bound">ρ</a><a id="2968" class="Symbol">)</a>

<a id="2971" class="Comment">------------------------------------------------------------------</a>
<a id="3038" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3105" class="Comment">------------------------------------------------------------------</a>

<a id="3173" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3239" href="Graded.Substitution.html#3239" class="Function">consSubstₘ</a> <a id="3250" class="Symbol">:</a> <a id="3252" class="Symbol">(</a><a id="3253" href="Graded.Substitution.html#3253" class="Bound">Ψ</a> <a id="3255" class="Symbol">:</a> <a id="3257" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="3264" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="3266" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="3267" class="Symbol">)</a> <a id="3269" class="Symbol">→</a> <a id="3271" class="Symbol">(</a><a id="3272" href="Graded.Substitution.html#3272" class="Bound">γ</a> <a id="3274" class="Symbol">:</a> <a id="3276" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3281" href="Graded.Substitution.html#747" class="Generalizable">m</a><a id="3282" class="Symbol">)</a> <a id="3284" class="Symbol">→</a> <a id="3286" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="3293" href="Graded.Substitution.html#747" class="Generalizable">m</a> <a id="3295" class="Symbol">(</a><a id="3296" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3299" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="3300" class="Symbol">)</a>
<a id="3302" href="Graded.Substitution.html#3239" class="Function">consSubstₘ</a> <a id="3313" class="Symbol">=</a> <a id="3315" href="Graded.Substitution.html#934" class="InductiveConstructor Operator">_⊙_</a>

<a id="3320" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3356" href="Graded.Substitution.html#3356" class="Function">sgSubstₘ</a> <a id="3365" class="Symbol">:</a> <a id="3367" class="Symbol">(</a><a id="3368" href="Graded.Substitution.html#3368" class="Bound">γ</a> <a id="3370" class="Symbol">:</a> <a id="3372" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3377" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="3378" class="Symbol">)</a> <a id="3380" class="Symbol">→</a> <a id="3382" href="Graded.Substitution.html#878" class="Datatype">Substₘ</a> <a id="3389" href="Graded.Substitution.html#749" class="Generalizable">n</a> <a id="3391" class="Symbol">(</a><a id="3392" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3395" href="Graded.Substitution.html#749" class="Generalizable">n</a><a id="3396" class="Symbol">)</a>
<a id="3398" href="Graded.Substitution.html#3356" class="Function">sgSubstₘ</a> <a id="3407" class="Symbol">=</a> <a id="3409" href="Graded.Substitution.html#3239" class="Function">consSubstₘ</a> <a id="3420" href="Graded.Substitution.html#2689" class="Function">idSubstₘ</a>
</pre></body></html>