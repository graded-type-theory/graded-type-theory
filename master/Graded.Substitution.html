<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Graded.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Graded.Modality.html" class="Module">Graded.Modality</a>
<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Graded.Usage.Restrictions.html" class="Module">Graded.Usage.Restrictions</a>

<a id="288" class="Keyword">module</a> <a id="295" href="Graded.Substitution.html" class="Module">Graded.Substitution</a>
  <a id="317" class="Symbol">{</a><a id="318" href="Graded.Substitution.html#318" class="Bound">a</a><a id="319" class="Symbol">}</a> <a id="321" class="Symbol">{</a><a id="322" href="Graded.Substitution.html#322" class="Bound">M</a> <a id="324" class="Symbol">:</a> <a id="326" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="330" href="Graded.Substitution.html#318" class="Bound">a</a><a id="331" class="Symbol">}</a>
  <a id="335" class="Symbol">(</a><a id="336" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="338" class="Symbol">:</a> <a id="340" href="Graded.Modality.html#5274" class="Record">Modality</a> <a id="349" href="Graded.Substitution.html#322" class="Bound">M</a><a id="350" class="Symbol">)</a>
  <a id="354" class="Symbol">(</a><a id="355" href="Graded.Substitution.html#355" class="Bound">R</a> <a id="357" class="Symbol">:</a> <a id="359" href="Graded.Usage.Restrictions.html#316" class="Record">Usage-restrictions</a> <a id="378" href="Graded.Substitution.html#322" class="Bound">M</a><a id="379" class="Symbol">)</a>
  <a id="383" class="Keyword">where</a>

<a id="390" class="Keyword">open</a> <a id="395" href="Graded.Modality.html#5274" class="Module">Modality</a> <a id="404" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="407" class="Keyword">open</a> <a id="412" class="Keyword">import</a> <a id="419" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="438" href="Graded.Substitution.html#322" class="Bound">M</a>
  <a id="442" class="Keyword">using</a> <a id="448" class="Symbol">(</a><a id="449" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="455" class="Symbol">;</a> <a id="457" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="462" class="Symbol">;</a> <a id="464" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="469" class="Symbol">;</a> <a id="471" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="474" class="Symbol">;</a> <a id="476" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a> <a id="479" class="Symbol">;</a> <a id="481" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="486" class="Symbol">;</a> <a id="488" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a><a id="492" class="Symbol">)</a>
<a id="494" class="Keyword">open</a> <a id="499" class="Keyword">import</a> <a id="506" href="Graded.Context.html" class="Module">Graded.Context</a> <a id="521" href="Graded.Substitution.html#336" class="Bound">𝕄</a>
<a id="523" class="Keyword">open</a> <a id="528" class="Keyword">import</a> <a id="535" href="Graded.Usage.html" class="Module">Graded.Usage</a> <a id="548" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="550" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="552" class="Keyword">open</a> <a id="557" class="Keyword">import</a> <a id="564" href="Graded.Usage.Weakening.html" class="Module">Graded.Usage.Weakening</a> <a id="587" href="Graded.Substitution.html#336" class="Bound">𝕄</a> <a id="589" href="Graded.Substitution.html#355" class="Bound">R</a>
<a id="591" class="Keyword">open</a> <a id="596" class="Keyword">import</a> <a id="603" href="Graded.Mode.html" class="Module">Graded.Mode</a> <a id="615" href="Graded.Substitution.html#336" class="Bound">𝕄</a>

<a id="618" class="Keyword">open</a> <a id="623" class="Keyword">import</a> <a id="630" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Tools.Nat.html" class="Module">Tools.Nat</a>

<a id="663" class="Keyword">infixr</a> <a id="670" class="Number">50</a> <a id="673" href="Graded.Substitution.html#1134" class="Function Operator">_*&gt;_</a>
<a id="678" class="Keyword">infix</a>  <a id="685" class="Number">20</a> <a id="688" href="Graded.Substitution.html#2104" class="Function Operator">∥_∥</a>
<a id="692" class="Keyword">infixl</a> <a id="699" class="Number">30</a> <a id="702" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a>

<a id="707" class="Keyword">private</a>
  <a id="717" class="Keyword">variable</a>
    <a id="730" href="Graded.Substitution.html#730" class="Generalizable">k</a> <a id="732" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="734" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="736" class="Symbol">:</a> <a id="738" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="743" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>

<a id="822" class="Keyword">data</a> <a id="Substₘ"></a><a id="827" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="834" class="Symbol">:</a> <a id="836" class="Symbol">(</a><a id="837" href="Graded.Substitution.html#837" class="Bound">m</a> <a id="839" href="Graded.Substitution.html#839" class="Bound">n</a> <a id="841" class="Symbol">:</a> <a id="843" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="846" class="Symbol">)</a> <a id="848" class="Symbol">→</a> <a id="850" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="854" href="Graded.Substitution.html#318" class="Bound">a</a> <a id="856" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="864" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>  <a id="868" class="Symbol">:</a> <a id="870" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="877" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="879" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="883" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a> <a id="887" class="Symbol">:</a> <a id="889" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="896" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="898" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="900" class="Symbol">→</a> <a id="902" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="907" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="909" class="Symbol">→</a> <a id="911" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="918" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="920" class="Symbol">(</a><a id="921" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="924" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="925" class="Symbol">)</a>

<a id="928" class="Keyword">private</a>
  <a id="938" class="Keyword">variable</a>
    <a id="951" href="Graded.Substitution.html#951" class="Generalizable">Ψ</a> <a id="953" href="Graded.Substitution.html#953" class="Generalizable">Φ</a> <a id="955" class="Symbol">:</a> <a id="957" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="964" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="966" href="Graded.Substitution.html#734" class="Generalizable">n</a>

<a id="969" class="Comment">-- Substitutions that contain empty usage contexts.</a>

<a id="εₘ"></a><a id="1022" href="Graded.Substitution.html#1022" class="Function">εₘ</a> <a id="1025" class="Symbol">:</a> <a id="1027" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1034" class="Number">0</a> <a id="1036" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1038" href="Graded.Substitution.html#1022" class="Function">εₘ</a> <a id="1041" class="Symbol">{</a><a id="1042" class="Argument">n</a> <a id="1044" class="Symbol">=</a> <a id="1046" class="Number">0</a><a id="1047" class="Symbol">}</a>    <a id="1052" class="Symbol">=</a> <a id="1054" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="1057" href="Graded.Substitution.html#1022" class="Function">εₘ</a> <a id="1060" class="Symbol">{</a><a id="1061" class="Argument">n</a> <a id="1063" class="Symbol">=</a> <a id="1065" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="1068" href="Graded.Substitution.html#1068" class="Bound">n</a><a id="1069" class="Symbol">}</a> <a id="1071" class="Symbol">=</a> <a id="1073" href="Graded.Substitution.html#1022" class="Function">εₘ</a> <a id="1076" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1078" href="Graded.Context.html#637" class="InductiveConstructor">ε</a>

<a id="1081" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1134" href="Graded.Substitution.html#1134" class="Function Operator">_*&gt;_</a> <a id="1139" class="Symbol">:</a> <a id="1141" class="Symbol">(</a><a id="1142" href="Graded.Substitution.html#1142" class="Bound">Ψ</a> <a id="1144" class="Symbol">:</a> <a id="1146" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1153" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1155" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1156" class="Symbol">)</a> <a id="1158" class="Symbol">→</a> <a id="1160" class="Symbol">(</a><a id="1161" href="Graded.Substitution.html#1161" class="Bound">γ</a> <a id="1163" class="Symbol">:</a> <a id="1165" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1170" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1171" class="Symbol">)</a> <a id="1173" class="Symbol">→</a> <a id="1175" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1180" href="Graded.Substitution.html#732" class="Generalizable">m</a>
<a id="1182" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1185" href="Graded.Substitution.html#1134" class="Function Operator">*&gt;</a> <a id="1188" href="Graded.Context.html#637" class="InductiveConstructor">ε</a> <a id="1190" class="Symbol">=</a> <a id="1192" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a>
<a id="1195" class="Symbol">(</a><a id="1196" href="Graded.Substitution.html#1196" class="Bound">Ψ</a> <a id="1198" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1200" href="Graded.Substitution.html#1200" class="Bound">δ</a><a id="1201" class="Symbol">)</a> <a id="1203" href="Graded.Substitution.html#1134" class="Function Operator">*&gt;</a> <a id="1206" class="Symbol">(</a><a id="1207" href="Graded.Substitution.html#1207" class="Bound">γ</a> <a id="1209" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1211" href="Graded.Substitution.html#1211" class="Bound">p</a><a id="1212" class="Symbol">)</a> <a id="1214" class="Symbol">=</a> <a id="1216" href="Graded.Substitution.html#1211" class="Bound">p</a> <a id="1218" href="Graded.Context.html#1651" class="Function Operator">·ᶜ</a> <a id="1221" href="Graded.Substitution.html#1200" class="Bound">δ</a> <a id="1223" href="Graded.Context.html#1419" class="Function Operator">+ᶜ</a> <a id="1226" class="Symbol">(</a><a id="1227" href="Graded.Substitution.html#1196" class="Bound">Ψ</a> <a id="1229" href="Graded.Substitution.html#1134" class="Function Operator">*&gt;</a> <a id="1232" href="Graded.Substitution.html#1207" class="Bound">γ</a><a id="1233" class="Symbol">)</a>

<a id="substₘ"></a><a id="1236" href="Graded.Substitution.html#1236" class="Function">substₘ</a> <a id="1243" class="Symbol">=</a> <a id="1245" href="Graded.Substitution.html#1134" class="Function Operator">_*&gt;_</a>

<a id="1251" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1305" href="Graded.Substitution.html#1305" class="Function Operator">_&lt;*_</a> <a id="1310" class="Symbol">:</a> <a id="1312" class="Symbol">(</a><a id="1313" href="Graded.Substitution.html#1313" class="Bound">γ</a> <a id="1315" class="Symbol">:</a> <a id="1317" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1322" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="1323" class="Symbol">)</a> <a id="1325" class="Symbol">→</a> <a id="1327" class="Symbol">(</a><a id="1328" href="Graded.Substitution.html#1328" class="Bound">Ψ</a> <a id="1330" class="Symbol">:</a> <a id="1332" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1339" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1341" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1342" class="Symbol">)</a> <a id="1344" class="Symbol">→</a> <a id="1346" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1351" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1353" href="Graded.Substitution.html#1353" class="Bound">γ</a> <a id="1355" href="Graded.Substitution.html#1305" class="Function Operator">&lt;*</a> <a id="1358" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1361" class="Symbol">=</a> <a id="1363" href="Graded.Context.html#637" class="InductiveConstructor">ε</a>
<a id="1365" href="Graded.Substitution.html#1365" class="Bound">γ</a> <a id="1367" href="Graded.Substitution.html#1305" class="Function Operator">&lt;*</a> <a id="1370" class="Symbol">(</a><a id="1371" href="Graded.Substitution.html#1371" class="Bound">Ψ</a> <a id="1373" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1375" href="Graded.Substitution.html#1375" class="Bound">δ</a><a id="1376" class="Symbol">)</a> <a id="1378" class="Symbol">=</a> <a id="1380" class="Symbol">(</a><a id="1381" href="Graded.Substitution.html#1365" class="Bound">γ</a> <a id="1383" href="Graded.Substitution.html#1305" class="Function Operator">&lt;*</a> <a id="1386" href="Graded.Substitution.html#1371" class="Bound">Ψ</a><a id="1387" class="Symbol">)</a> <a id="1389" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1391" class="Symbol">(</a><a id="1392" href="Graded.Substitution.html#1365" class="Bound">γ</a> <a id="1394" href="Graded.Context.html#1308" class="Function Operator">*</a> <a id="1396" href="Graded.Substitution.html#1375" class="Bound">δ</a><a id="1397" class="Symbol">)</a>

<a id="1400" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1441" href="Graded.Substitution.html#1441" class="Function Operator">_&lt;*&gt;_</a> <a id="1447" class="Symbol">:</a> <a id="1449" class="Symbol">(</a><a id="1450" href="Graded.Substitution.html#1450" class="Bound">Ψ</a> <a id="1452" class="Symbol">:</a> <a id="1454" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1461" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1463" href="Graded.Substitution.html#730" class="Generalizable">k</a><a id="1464" class="Symbol">)</a> <a id="1466" class="Symbol">(</a><a id="1467" href="Graded.Substitution.html#1467" class="Bound">Φ</a> <a id="1469" class="Symbol">:</a> <a id="1471" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1478" href="Graded.Substitution.html#730" class="Generalizable">k</a> <a id="1480" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1481" class="Symbol">)</a> <a id="1483" class="Symbol">→</a> <a id="1485" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1492" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1494" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1496" href="Graded.Substitution.html#1496" class="Bound">Ψ</a> <a id="1498" href="Graded.Substitution.html#1441" class="Function Operator">&lt;*&gt;</a> <a id="1502" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1505" class="Symbol">=</a> <a id="1507" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="1510" href="Graded.Substitution.html#1510" class="Bound">Ψ</a> <a id="1512" href="Graded.Substitution.html#1441" class="Function Operator">&lt;*&gt;</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Graded.Substitution.html#1517" class="Bound">Φ</a> <a id="1519" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1521" href="Graded.Substitution.html#1521" class="Bound">δ</a><a id="1522" class="Symbol">)</a> <a id="1524" class="Symbol">=</a> <a id="1526" class="Symbol">(</a><a id="1527" href="Graded.Substitution.html#1510" class="Bound">Ψ</a> <a id="1529" href="Graded.Substitution.html#1441" class="Function Operator">&lt;*&gt;</a> <a id="1533" href="Graded.Substitution.html#1517" class="Bound">Φ</a><a id="1534" class="Symbol">)</a> <a id="1536" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1538" class="Symbol">(</a><a id="1539" href="Graded.Substitution.html#1510" class="Bound">Ψ</a> <a id="1541" href="Graded.Substitution.html#1134" class="Function Operator">*&gt;</a> <a id="1544" href="Graded.Substitution.html#1521" class="Bound">δ</a><a id="1545" class="Symbol">)</a>

<a id="1548" class="Comment">-- Prepend a substitution matrix with a row</a>

<a id="addrow"></a><a id="1593" href="Graded.Substitution.html#1593" class="Function">addrow</a> <a id="1600" class="Symbol">:</a> <a id="1602" class="Symbol">(</a><a id="1603" href="Graded.Substitution.html#1603" class="Bound">Ψ</a> <a id="1605" class="Symbol">:</a> <a id="1607" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1614" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1616" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1617" class="Symbol">)</a> <a id="1619" class="Symbol">→</a> <a id="1621" class="Symbol">(</a><a id="1622" href="Graded.Substitution.html#1622" class="Bound">γ</a> <a id="1624" class="Symbol">:</a> <a id="1626" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="1631" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="1632" class="Symbol">)</a> <a id="1634" class="Symbol">→</a> <a id="1636" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1643" class="Symbol">(</a><a id="1644" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="1647" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="1648" class="Symbol">)</a> <a id="1650" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="1652" href="Graded.Substitution.html#1593" class="Function">addrow</a> <a id="1659" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="1662" href="Graded.Context.html#637" class="InductiveConstructor">ε</a> <a id="1664" class="Symbol">=</a> <a id="1666" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="1669" href="Graded.Substitution.html#1593" class="Function">addrow</a> <a id="1676" class="Symbol">(</a><a id="1677" href="Graded.Substitution.html#1677" class="Bound">Ψ</a> <a id="1679" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1681" href="Graded.Substitution.html#1681" class="Bound">δ</a><a id="1682" class="Symbol">)</a> <a id="1684" class="Symbol">(</a><a id="1685" href="Graded.Substitution.html#1685" class="Bound">γ</a> <a id="1687" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1689" href="Graded.Substitution.html#1689" class="Bound">p</a><a id="1690" class="Symbol">)</a> <a id="1692" class="Symbol">=</a> <a id="1694" href="Graded.Substitution.html#1593" class="Function">addrow</a> <a id="1701" href="Graded.Substitution.html#1677" class="Bound">Ψ</a> <a id="1703" href="Graded.Substitution.html#1685" class="Bound">γ</a> <a id="1705" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="1707" class="Symbol">(</a><a id="1708" href="Graded.Substitution.html#1681" class="Bound">δ</a> <a id="1710" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="1712" href="Graded.Substitution.html#1689" class="Bound">p</a><a id="1713" class="Symbol">)</a>

<a id="1716" class="Comment">---------------------------------------------------------------</a>

<a id="1781" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1852" class="Comment">-- γ_x is the x-th column vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1919" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1935" href="Graded.Substitution.html#1935" class="Function Operator">_▶[_]_</a> <a id="1942" class="Symbol">:</a> <a id="1944" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="1951" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1953" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1955" class="Symbol">→</a> <a id="1957" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="1969" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1971" class="Symbol">→</a> <a id="1973" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="1979" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="1981" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="1983" class="Symbol">→</a> <a id="1985" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1989" href="Graded.Substitution.html#318" class="Bound">a</a>
<a id="1991" href="Graded.Substitution.html#1935" class="Function Operator">_▶[_]_</a> <a id="1998" class="Symbol">{</a><a id="1999" class="Argument">n</a> <a id="2001" class="Symbol">=</a> <a id="2003" href="Graded.Substitution.html#2003" class="Bound">n</a><a id="2004" class="Symbol">}</a> <a id="2006" href="Graded.Substitution.html#2006" class="Bound">Ψ</a> <a id="2008" href="Graded.Substitution.html#2008" class="Bound">γ</a> <a id="2010" href="Graded.Substitution.html#2010" class="Bound">σ</a> <a id="2012" class="Symbol">=</a>
  <a id="2016" class="Symbol">(</a><a id="2017" href="Graded.Substitution.html#2017" class="Bound">x</a> <a id="2019" class="Symbol">:</a> <a id="2021" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="2025" href="Graded.Substitution.html#2003" class="Bound">n</a><a id="2026" class="Symbol">)</a> <a id="2028" class="Symbol">→</a> <a id="2030" class="Symbol">(</a><a id="2031" href="Graded.Substitution.html#2006" class="Bound">Ψ</a> <a id="2033" href="Graded.Substitution.html#1134" class="Function Operator">*&gt;</a> <a id="2036" class="Symbol">(</a><a id="2037" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="2040" href="Graded.Context.html#1025" class="Function Operator">,</a> <a id="2042" href="Graded.Substitution.html#2017" class="Bound">x</a> <a id="2044" href="Graded.Context.html#1025" class="Function Operator">≔</a> <a id="2046" href="Graded.Mode.html#3577" class="Function Operator">⌜</a> <a id="2048" href="Graded.Substitution.html#2008" class="Bound">γ</a> <a id="2050" href="Graded.Substitution.html#2017" class="Bound">x</a> <a id="2052" href="Graded.Mode.html#3577" class="Function Operator">⌝</a><a id="2053" class="Symbol">))</a> <a id="2056" href="Graded.Usage.html#1080" class="Datatype Operator">▸[</a> <a id="2059" href="Graded.Substitution.html#2008" class="Bound">γ</a> <a id="2061" href="Graded.Substitution.html#2017" class="Bound">x</a> <a id="2063" href="Graded.Usage.html#1080" class="Datatype Operator">]</a> <a id="2065" href="Graded.Substitution.html#2010" class="Bound">σ</a> <a id="2067" href="Graded.Substitution.html#2017" class="Bound">x</a>

<a id="2070" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="2104" href="Graded.Substitution.html#2104" class="Function Operator">∥_∥</a> <a id="2108" class="Symbol">:</a> <a id="2110" href="Definition.Untyped.html#12627" class="Function">Subst</a> <a id="2116" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2118" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2120" class="Symbol">→</a> <a id="2122" href="Graded.Mode.html#4293" class="Function">Mode-vector</a> <a id="2134" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2136" class="Symbol">→</a> <a id="2138" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2145" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2147" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2149" href="Graded.Substitution.html#2104" class="Function Operator">∥_∥</a> <a id="2153" class="Symbol">{</a><a id="2154" class="Argument">n</a> <a id="2156" class="Symbol">=</a> <a id="2158" class="Number">0</a><a id="2159" class="Symbol">}</a>    <a id="2164" class="Symbol">_</a> <a id="2166" class="Symbol">_</a>  <a id="2169" class="Symbol">=</a> <a id="2171" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2174" href="Graded.Substitution.html#2104" class="Function Operator">∥_∥</a> <a id="2178" class="Symbol">{</a><a id="2179" class="Argument">n</a> <a id="2181" class="Symbol">=</a> <a id="2183" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2186" href="Graded.Substitution.html#2186" class="Bound">n</a><a id="2187" class="Symbol">}</a> <a id="2189" href="Graded.Substitution.html#2189" class="Bound">σ</a> <a id="2191" href="Graded.Substitution.html#2191" class="Bound">ms</a> <a id="2194" class="Symbol">=</a> <a id="2196" href="Graded.Substitution.html#2104" class="Function Operator">∥</a> <a id="2198" href="Definition.Untyped.html#13393" class="Function">tail</a> <a id="2203" href="Graded.Substitution.html#2189" class="Bound">σ</a> <a id="2205" href="Graded.Substitution.html#2104" class="Function Operator">∥</a> <a id="2207" class="Symbol">(</a><a id="2208" href="Graded.Mode.html#4693" class="Function">tailᵐ</a> <a id="2214" href="Graded.Substitution.html#2191" class="Bound">ms</a><a id="2216" class="Symbol">)</a> <a id="2218" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2220" href="Graded.Usage.html#2810" class="Function Operator">⌈</a> <a id="2222" href="Definition.Untyped.html#13210" class="Function">head</a> <a id="2227" href="Graded.Substitution.html#2189" class="Bound">σ</a> <a id="2229" href="Graded.Usage.html#2810" class="Function Operator">⌉</a> <a id="2231" class="Symbol">(</a><a id="2232" href="Graded.Mode.html#4610" class="Function">headᵐ</a> <a id="2238" href="Graded.Substitution.html#2191" class="Bound">ms</a><a id="2240" class="Symbol">)</a>

<a id="2243" class="Comment">---------------------------------------------------------------</a>
<a id="2307" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2371" class="Comment">---------------------------------------------------------------</a>

<a id="2436" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2487" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2497" class="Symbol">:</a> <a id="2499" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2506" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2508" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2510" class="Symbol">→</a> <a id="2512" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2519" class="Symbol">(</a><a id="2520" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2523" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="2524" class="Symbol">)</a> <a id="2526" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2528" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2538" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a> <a id="2541" class="Symbol">=</a> <a id="2543" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2546" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2556" class="Symbol">(</a><a id="2557" href="Graded.Substitution.html#2557" class="Bound">Ψ</a> <a id="2559" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2561" href="Graded.Substitution.html#2561" class="Bound">δ</a><a id="2562" class="Symbol">)</a> <a id="2564" class="Symbol">=</a> <a id="2566" class="Symbol">(</a><a id="2567" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2577" href="Graded.Substitution.html#2557" class="Bound">Ψ</a><a id="2578" class="Symbol">)</a> <a id="2580" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2582" href="Graded.Usage.Weakening.html#1374" class="Function">wkConₘ</a> <a id="2589" class="Symbol">(</a><a id="2590" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2595" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a><a id="2597" class="Symbol">)</a> <a id="2599" href="Graded.Substitution.html#2561" class="Bound">δ</a>

<a id="2602" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2636" href="Graded.Substitution.html#2636" class="Function">liftSubstₘ</a> <a id="2647" class="Symbol">:</a> <a id="2649" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2656" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2658" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2660" class="Symbol">→</a> <a id="2662" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2669" class="Symbol">(</a><a id="2670" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2673" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="2674" class="Symbol">)</a> <a id="2676" class="Symbol">(</a><a id="2677" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2680" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="2681" class="Symbol">)</a>
<a id="2683" href="Graded.Substitution.html#2636" class="Function">liftSubstₘ</a> <a id="2694" href="Graded.Substitution.html#2694" class="Bound">Ψ</a> <a id="2696" class="Symbol">=</a> <a id="2698" class="Symbol">(</a><a id="2699" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2709" href="Graded.Substitution.html#2694" class="Bound">Ψ</a><a id="2710" class="Symbol">)</a> <a id="2712" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">⊙</a> <a id="2714" class="Symbol">(</a><a id="2715" href="Graded.Context.html#1994" class="Function">𝟘ᶜ</a> <a id="2718" href="Graded.Context.html#652" class="InductiveConstructor Operator">∙</a> <a id="2720" href="Graded.Modality.html#819" class="Function">𝟙</a><a id="2721" class="Symbol">)</a>

<a id="2724" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2757" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a> <a id="2766" class="Symbol">:</a> <a id="2768" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2775" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="2777" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2779" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a> <a id="2788" class="Symbol">{</a><a id="2789" class="Argument">n</a> <a id="2791" class="Symbol">=</a> <a id="2793" class="Number">0</a><a id="2794" class="Symbol">}</a> <a id="2796" class="Symbol">=</a> <a id="2798" href="Graded.Substitution.html#864" class="InductiveConstructor">[]</a>
<a id="2801" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a> <a id="2810" class="Symbol">{</a><a id="2811" class="Argument">n</a> <a id="2813" class="Symbol">=</a> <a id="2815" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2818" href="Graded.Substitution.html#2818" class="Bound">n</a><a id="2819" class="Symbol">}</a> <a id="2821" class="Symbol">=</a> <a id="2823" href="Graded.Substitution.html#2636" class="Function">liftSubstₘ</a> <a id="2834" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a>

<a id="2844" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2885" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="2894" class="Symbol">:</a> <a id="2896" class="Symbol">(</a><a id="2897" href="Graded.Substitution.html#2897" class="Bound">ρ</a> <a id="2899" class="Symbol">:</a> <a id="2901" href="Definition.Untyped.NotParametrised.html#2145" class="Datatype">Wk</a> <a id="2904" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2906" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="2907" class="Symbol">)</a> <a id="2909" class="Symbol">→</a> <a id="2911" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="2918" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="2920" href="Graded.Substitution.html#734" class="Generalizable">n</a>
<a id="2922" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="2931" href="Definition.Untyped.NotParametrised.html#2174" class="InductiveConstructor">id</a>       <a id="2940" class="Symbol">=</a> <a id="2942" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a>
<a id="2951" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="2960" class="Symbol">(</a><a id="2961" href="Definition.Untyped.NotParametrised.html#2238" class="InductiveConstructor">step</a> <a id="2966" href="Graded.Substitution.html#2966" class="Bound">ρ</a><a id="2967" class="Symbol">)</a> <a id="2969" class="Symbol">=</a> <a id="2971" href="Graded.Substitution.html#2487" class="Function">wk1Substₘ</a> <a id="2981" class="Symbol">(</a><a id="2982" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="2991" href="Graded.Substitution.html#2966" class="Bound">ρ</a><a id="2992" class="Symbol">)</a>
<a id="2994" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="3003" class="Symbol">(</a><a id="3004" href="Definition.Untyped.NotParametrised.html#2327" class="InductiveConstructor">lift</a> <a id="3009" href="Graded.Substitution.html#3009" class="Bound">ρ</a><a id="3010" class="Symbol">)</a> <a id="3012" class="Symbol">=</a> <a id="3014" href="Graded.Substitution.html#2636" class="Function">liftSubstₘ</a> <a id="3025" class="Symbol">(</a><a id="3026" href="Graded.Substitution.html#2885" class="Function">wkSubstₘ</a> <a id="3035" href="Graded.Substitution.html#3009" class="Bound">ρ</a><a id="3036" class="Symbol">)</a>

<a id="3039" class="Comment">------------------------------------------------------------------</a>
<a id="3106" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3173" class="Comment">------------------------------------------------------------------</a>

<a id="3241" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3307" href="Graded.Substitution.html#3307" class="Function">consSubstₘ</a> <a id="3318" class="Symbol">:</a> <a id="3320" class="Symbol">(</a><a id="3321" href="Graded.Substitution.html#3321" class="Bound">Ψ</a> <a id="3323" class="Symbol">:</a> <a id="3325" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3332" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="3334" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3335" class="Symbol">)</a> <a id="3337" class="Symbol">→</a> <a id="3339" class="Symbol">(</a><a id="3340" href="Graded.Substitution.html#3340" class="Bound">γ</a> <a id="3342" class="Symbol">:</a> <a id="3344" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3349" href="Graded.Substitution.html#732" class="Generalizable">m</a><a id="3350" class="Symbol">)</a> <a id="3352" class="Symbol">→</a> <a id="3354" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3361" href="Graded.Substitution.html#732" class="Generalizable">m</a> <a id="3363" class="Symbol">(</a><a id="3364" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3367" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3368" class="Symbol">)</a>
<a id="3370" href="Graded.Substitution.html#3307" class="Function">consSubstₘ</a> <a id="3381" class="Symbol">=</a> <a id="3383" href="Graded.Substitution.html#883" class="InductiveConstructor Operator">_⊙_</a>

<a id="3388" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3424" href="Graded.Substitution.html#3424" class="Function">sgSubstₘ</a> <a id="3433" class="Symbol">:</a> <a id="3435" class="Symbol">(</a><a id="3436" href="Graded.Substitution.html#3436" class="Bound">γ</a> <a id="3438" class="Symbol">:</a> <a id="3440" href="Graded.Context.html#610" class="Datatype">Conₘ</a> <a id="3445" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3446" class="Symbol">)</a> <a id="3448" class="Symbol">→</a> <a id="3450" href="Graded.Substitution.html#827" class="Datatype">Substₘ</a> <a id="3457" href="Graded.Substitution.html#734" class="Generalizable">n</a> <a id="3459" class="Symbol">(</a><a id="3460" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3463" href="Graded.Substitution.html#734" class="Generalizable">n</a><a id="3464" class="Symbol">)</a>
<a id="3466" href="Graded.Substitution.html#3424" class="Function">sgSubstₘ</a> <a id="3475" class="Symbol">=</a> <a id="3477" href="Graded.Substitution.html#3307" class="Function">consSubstₘ</a> <a id="3488" href="Graded.Substitution.html#2757" class="Function">idSubstₘ</a>
</pre></body></html>