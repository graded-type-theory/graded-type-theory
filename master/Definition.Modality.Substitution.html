<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Definition.Modality.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Substitution matrices (action of substitutions on modality contexts).</a>
<a id="147" class="Comment">------------------------------------------------------------------------</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Definition.Modality.html" class="Module">Definition.Modality</a>

<a id="254" class="Keyword">module</a> <a id="261" href="Definition.Modality.Substitution.html" class="Module">Definition.Modality.Substitution</a>
  <a id="296" class="Symbol">{</a><a id="297" href="Definition.Modality.Substitution.html#297" class="Bound">a</a><a id="298" class="Symbol">}</a> <a id="300" class="Symbol">{</a><a id="301" href="Definition.Modality.Substitution.html#301" class="Bound">M</a> <a id="303" class="Symbol">:</a> <a id="305" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="309" href="Definition.Modality.Substitution.html#297" class="Bound">a</a><a id="310" class="Symbol">}</a> <a id="312" class="Symbol">(</a><a id="313" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a> <a id="315" class="Symbol">:</a> <a id="317" href="Definition.Modality.html#5116" class="Record">Modality</a> <a id="326" href="Definition.Modality.Substitution.html#301" class="Bound">M</a><a id="327" class="Symbol">)</a> <a id="329" class="Keyword">where</a>

<a id="336" class="Keyword">open</a> <a id="341" href="Definition.Modality.html#5116" class="Module">Modality</a> <a id="350" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a>

<a id="353" class="Keyword">open</a> <a id="358" class="Keyword">import</a> <a id="365" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="384" href="Definition.Modality.Substitution.html#301" class="Bound">M</a>
  <a id="388" class="Keyword">using</a> <a id="394" class="Symbol">(</a><a id="395" href="Definition.Untyped.html#11676" class="Function">Subst</a> <a id="401" class="Symbol">;</a> <a id="403" href="Definition.Untyped.html#12448" class="Function">tail</a> <a id="408" class="Symbol">;</a> <a id="410" href="Definition.Untyped.html#12265" class="Function">head</a> <a id="415" class="Symbol">;</a> <a id="417" href="Definition.Untyped.NotParametrised.html#2135" class="Datatype">Wk</a> <a id="420" class="Symbol">;</a> <a id="422" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a> <a id="425" class="Symbol">;</a> <a id="427" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="432" class="Symbol">;</a> <a id="434" href="Definition.Untyped.NotParametrised.html#2317" class="InductiveConstructor">lift</a><a id="438" class="Symbol">)</a>
<a id="440" class="Keyword">open</a> <a id="445" class="Keyword">import</a> <a id="452" href="Definition.Modality.Context.html" class="Module">Definition.Modality.Context</a> <a id="480" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a>
<a id="482" class="Keyword">open</a> <a id="487" class="Keyword">import</a> <a id="494" href="Definition.Modality.Usage.html" class="Module">Definition.Modality.Usage</a> <a id="520" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a>
<a id="522" class="Keyword">open</a> <a id="527" class="Keyword">import</a> <a id="534" href="Definition.Modality.Usage.Weakening.html" class="Module">Definition.Modality.Usage.Weakening</a> <a id="570" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a>
<a id="572" class="Keyword">open</a> <a id="577" class="Keyword">import</a> <a id="584" href="Definition.Mode.html" class="Module">Definition.Mode</a> <a id="600" href="Definition.Modality.Substitution.html#313" class="Bound">𝕄</a>

<a id="603" class="Keyword">open</a> <a id="608" class="Keyword">import</a> <a id="615" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="625" class="Keyword">open</a> <a id="630" class="Keyword">import</a> <a id="637" href="Tools.Nat.html" class="Module">Tools.Nat</a>

<a id="648" class="Keyword">infixr</a> <a id="655" class="Number">50</a> <a id="658" href="Definition.Modality.Substitution.html#1007" class="Function Operator">_*&gt;_</a>
<a id="663" class="Keyword">infix</a>  <a id="670" class="Number">20</a> <a id="673" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥_∥</a>
<a id="677" class="Keyword">infixl</a> <a id="684" class="Number">30</a> <a id="687" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">_⊙_</a>

<a id="692" class="Keyword">private</a>
  <a id="702" class="Keyword">variable</a>
    <a id="715" href="Definition.Modality.Substitution.html#715" class="Generalizable">k</a> <a id="717" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="719" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="721" class="Symbol">:</a> <a id="723" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a>

<a id="728" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>

<a id="807" class="Keyword">data</a> <a id="Substₘ"></a><a id="812" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="819" class="Symbol">:</a> <a id="821" class="Symbol">(</a><a id="822" href="Definition.Modality.Substitution.html#822" class="Bound">m</a> <a id="824" href="Definition.Modality.Substitution.html#824" class="Bound">n</a> <a id="826" class="Symbol">:</a> <a id="828" href="Agda.Builtin.Nat.html#186" class="Datatype">Nat</a><a id="831" class="Symbol">)</a> <a id="833" class="Symbol">→</a> <a id="835" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="839" href="Definition.Modality.Substitution.html#297" class="Bound">a</a> <a id="841" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="849" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>  <a id="853" class="Symbol">:</a> <a id="855" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="862" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="864" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="868" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">_⊙_</a> <a id="872" class="Symbol">:</a> <a id="874" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="881" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="883" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="885" class="Symbol">→</a> <a id="887" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="892" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="894" class="Symbol">→</a> <a id="896" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="903" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="905" class="Symbol">(</a><a id="906" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="909" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="910" class="Symbol">)</a>

<a id="913" class="Keyword">private</a>
  <a id="923" class="Keyword">variable</a>
    <a id="936" href="Definition.Modality.Substitution.html#936" class="Generalizable">Ψ</a> <a id="938" href="Definition.Modality.Substitution.html#938" class="Generalizable">Φ</a> <a id="940" class="Symbol">:</a> <a id="942" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="949" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="951" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>

<a id="954" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="1007" href="Definition.Modality.Substitution.html#1007" class="Function Operator">_*&gt;_</a> <a id="1012" class="Symbol">:</a> <a id="1014" class="Symbol">(</a><a id="1015" href="Definition.Modality.Substitution.html#1015" class="Bound">Ψ</a> <a id="1017" class="Symbol">:</a> <a id="1019" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1026" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1028" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1029" class="Symbol">)</a> <a id="1031" class="Symbol">→</a> <a id="1033" class="Symbol">(</a><a id="1034" href="Definition.Modality.Substitution.html#1034" class="Bound">γ</a> <a id="1036" class="Symbol">:</a> <a id="1038" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="1043" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1044" class="Symbol">)</a> <a id="1046" class="Symbol">→</a> <a id="1048" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="1053" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a>
<a id="1055" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a> <a id="1058" href="Definition.Modality.Substitution.html#1007" class="Function Operator">*&gt;</a> <a id="1061" href="Definition.Modality.Context.html#654" class="InductiveConstructor">ε</a> <a id="1063" class="Symbol">=</a> <a id="1065" href="Definition.Modality.Context.html#2011" class="Function">𝟘ᶜ</a>
<a id="1068" class="Symbol">(</a><a id="1069" href="Definition.Modality.Substitution.html#1069" class="Bound">Ψ</a> <a id="1071" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1073" href="Definition.Modality.Substitution.html#1073" class="Bound">δ</a><a id="1074" class="Symbol">)</a> <a id="1076" href="Definition.Modality.Substitution.html#1007" class="Function Operator">*&gt;</a> <a id="1079" class="Symbol">(</a><a id="1080" href="Definition.Modality.Substitution.html#1080" class="Bound">γ</a> <a id="1082" href="Definition.Modality.Context.html#669" class="InductiveConstructor Operator">∙</a> <a id="1084" href="Definition.Modality.Substitution.html#1084" class="Bound">p</a><a id="1085" class="Symbol">)</a> <a id="1087" class="Symbol">=</a> <a id="1089" href="Definition.Modality.Substitution.html#1084" class="Bound">p</a> <a id="1091" href="Definition.Modality.Context.html#1668" class="Function Operator">·ᶜ</a> <a id="1094" href="Definition.Modality.Substitution.html#1073" class="Bound">δ</a> <a id="1096" href="Definition.Modality.Context.html#1436" class="Function Operator">+ᶜ</a> <a id="1099" class="Symbol">(</a><a id="1100" href="Definition.Modality.Substitution.html#1069" class="Bound">Ψ</a> <a id="1102" href="Definition.Modality.Substitution.html#1007" class="Function Operator">*&gt;</a> <a id="1105" href="Definition.Modality.Substitution.html#1080" class="Bound">γ</a><a id="1106" class="Symbol">)</a>

<a id="substₘ"></a><a id="1109" href="Definition.Modality.Substitution.html#1109" class="Function">substₘ</a> <a id="1116" class="Symbol">=</a> <a id="1118" href="Definition.Modality.Substitution.html#1007" class="Function Operator">_*&gt;_</a>

<a id="1124" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1178" href="Definition.Modality.Substitution.html#1178" class="Function Operator">_&lt;*_</a> <a id="1183" class="Symbol">:</a> <a id="1185" class="Symbol">(</a><a id="1186" href="Definition.Modality.Substitution.html#1186" class="Bound">γ</a> <a id="1188" class="Symbol">:</a> <a id="1190" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="1195" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a><a id="1196" class="Symbol">)</a> <a id="1198" class="Symbol">→</a> <a id="1200" class="Symbol">(</a><a id="1201" href="Definition.Modality.Substitution.html#1201" class="Bound">Ψ</a> <a id="1203" class="Symbol">:</a> <a id="1205" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1212" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1214" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1215" class="Symbol">)</a> <a id="1217" class="Symbol">→</a> <a id="1219" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="1224" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="1226" href="Definition.Modality.Substitution.html#1226" class="Bound">γ</a> <a id="1228" href="Definition.Modality.Substitution.html#1178" class="Function Operator">&lt;*</a> <a id="1231" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a> <a id="1234" class="Symbol">=</a> <a id="1236" href="Definition.Modality.Context.html#654" class="InductiveConstructor">ε</a>
<a id="1238" href="Definition.Modality.Substitution.html#1238" class="Bound">γ</a> <a id="1240" href="Definition.Modality.Substitution.html#1178" class="Function Operator">&lt;*</a> <a id="1243" class="Symbol">(</a><a id="1244" href="Definition.Modality.Substitution.html#1244" class="Bound">Ψ</a> <a id="1246" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1248" href="Definition.Modality.Substitution.html#1248" class="Bound">δ</a><a id="1249" class="Symbol">)</a> <a id="1251" class="Symbol">=</a> <a id="1253" class="Symbol">(</a><a id="1254" href="Definition.Modality.Substitution.html#1238" class="Bound">γ</a> <a id="1256" href="Definition.Modality.Substitution.html#1178" class="Function Operator">&lt;*</a> <a id="1259" href="Definition.Modality.Substitution.html#1244" class="Bound">Ψ</a><a id="1260" class="Symbol">)</a> <a id="1262" href="Definition.Modality.Context.html#669" class="InductiveConstructor Operator">∙</a> <a id="1264" class="Symbol">(</a><a id="1265" href="Definition.Modality.Substitution.html#1238" class="Bound">γ</a> <a id="1267" href="Definition.Modality.Context.html#1325" class="Function Operator">*</a> <a id="1269" href="Definition.Modality.Substitution.html#1248" class="Bound">δ</a><a id="1270" class="Symbol">)</a>

<a id="1273" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1314" href="Definition.Modality.Substitution.html#1314" class="Function Operator">_&lt;*&gt;_</a> <a id="1320" class="Symbol">:</a> <a id="1322" class="Symbol">(</a><a id="1323" href="Definition.Modality.Substitution.html#1323" class="Bound">Ψ</a> <a id="1325" class="Symbol">:</a> <a id="1327" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1334" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1336" href="Definition.Modality.Substitution.html#715" class="Generalizable">k</a><a id="1337" class="Symbol">)</a> <a id="1339" class="Symbol">(</a><a id="1340" href="Definition.Modality.Substitution.html#1340" class="Bound">Φ</a> <a id="1342" class="Symbol">:</a> <a id="1344" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1351" href="Definition.Modality.Substitution.html#715" class="Generalizable">k</a> <a id="1353" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1354" class="Symbol">)</a> <a id="1356" class="Symbol">→</a> <a id="1358" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1365" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1367" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="1369" href="Definition.Modality.Substitution.html#1369" class="Bound">Ψ</a> <a id="1371" href="Definition.Modality.Substitution.html#1314" class="Function Operator">&lt;*&gt;</a> <a id="1375" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a> <a id="1378" class="Symbol">=</a> <a id="1380" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>
<a id="1383" href="Definition.Modality.Substitution.html#1383" class="Bound">Ψ</a> <a id="1385" href="Definition.Modality.Substitution.html#1314" class="Function Operator">&lt;*&gt;</a> <a id="1389" class="Symbol">(</a><a id="1390" href="Definition.Modality.Substitution.html#1390" class="Bound">Φ</a> <a id="1392" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1394" href="Definition.Modality.Substitution.html#1394" class="Bound">δ</a><a id="1395" class="Symbol">)</a> <a id="1397" class="Symbol">=</a> <a id="1399" class="Symbol">(</a><a id="1400" href="Definition.Modality.Substitution.html#1383" class="Bound">Ψ</a> <a id="1402" href="Definition.Modality.Substitution.html#1314" class="Function Operator">&lt;*&gt;</a> <a id="1406" href="Definition.Modality.Substitution.html#1390" class="Bound">Φ</a><a id="1407" class="Symbol">)</a> <a id="1409" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1411" class="Symbol">(</a><a id="1412" href="Definition.Modality.Substitution.html#1383" class="Bound">Ψ</a> <a id="1414" href="Definition.Modality.Substitution.html#1007" class="Function Operator">*&gt;</a> <a id="1417" href="Definition.Modality.Substitution.html#1394" class="Bound">δ</a><a id="1418" class="Symbol">)</a>

<a id="1421" class="Comment">-- Prepend a substitution matrix with a row</a>

<a id="addrow"></a><a id="1466" href="Definition.Modality.Substitution.html#1466" class="Function">addrow</a> <a id="1473" class="Symbol">:</a> <a id="1475" class="Symbol">(</a><a id="1476" href="Definition.Modality.Substitution.html#1476" class="Bound">Ψ</a> <a id="1478" class="Symbol">:</a> <a id="1480" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1487" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1489" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1490" class="Symbol">)</a> <a id="1492" class="Symbol">→</a> <a id="1494" class="Symbol">(</a><a id="1495" href="Definition.Modality.Substitution.html#1495" class="Bound">γ</a> <a id="1497" class="Symbol">:</a> <a id="1499" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="1504" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="1505" class="Symbol">)</a> <a id="1507" class="Symbol">→</a> <a id="1509" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1516" class="Symbol">(</a><a id="1517" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="1520" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a><a id="1521" class="Symbol">)</a> <a id="1523" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="1525" href="Definition.Modality.Substitution.html#1466" class="Function">addrow</a> <a id="1532" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a> <a id="1535" href="Definition.Modality.Context.html#654" class="InductiveConstructor">ε</a> <a id="1537" class="Symbol">=</a> <a id="1539" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>
<a id="1542" href="Definition.Modality.Substitution.html#1466" class="Function">addrow</a> <a id="1549" class="Symbol">(</a><a id="1550" href="Definition.Modality.Substitution.html#1550" class="Bound">Ψ</a> <a id="1552" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1554" href="Definition.Modality.Substitution.html#1554" class="Bound">δ</a><a id="1555" class="Symbol">)</a> <a id="1557" class="Symbol">(</a><a id="1558" href="Definition.Modality.Substitution.html#1558" class="Bound">γ</a> <a id="1560" href="Definition.Modality.Context.html#669" class="InductiveConstructor Operator">∙</a> <a id="1562" href="Definition.Modality.Substitution.html#1562" class="Bound">p</a><a id="1563" class="Symbol">)</a> <a id="1565" class="Symbol">=</a> <a id="1567" href="Definition.Modality.Substitution.html#1466" class="Function">addrow</a> <a id="1574" href="Definition.Modality.Substitution.html#1550" class="Bound">Ψ</a> <a id="1576" href="Definition.Modality.Substitution.html#1558" class="Bound">γ</a> <a id="1578" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="1580" class="Symbol">(</a><a id="1581" href="Definition.Modality.Substitution.html#1554" class="Bound">δ</a> <a id="1583" href="Definition.Modality.Context.html#669" class="InductiveConstructor Operator">∙</a> <a id="1585" href="Definition.Modality.Substitution.html#1562" class="Bound">p</a><a id="1586" class="Symbol">)</a>

<a id="1589" class="Comment">---------------------------------------------------------------</a>

<a id="1654" class="Comment">-- Well-formed modality substitutions: if ∀ x. γ_x ▸[ γ x ] σ x, where</a>
<a id="1725" class="Comment">-- γ_x is the x-th column vector of Ψ, multiplied by ⌜ γ x ⌝, then</a>
<a id="1792" class="Comment">-- Ψ ▶[ γ ] σ.</a>

<a id="_▶[_]_"></a><a id="1808" href="Definition.Modality.Substitution.html#1808" class="Function Operator">_▶[_]_</a> <a id="1815" class="Symbol">:</a> <a id="1817" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="1824" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1826" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="1828" class="Symbol">→</a> <a id="1830" href="Definition.Mode.html#4332" class="Function">Mode-vector</a> <a id="1842" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="1844" class="Symbol">→</a> <a id="1846" href="Definition.Untyped.html#11676" class="Function">Subst</a> <a id="1852" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1854" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="1856" class="Symbol">→</a> <a id="1858" href="Agda.Primitive.html#320" class="Primitive">Set</a> <a id="1862" href="Definition.Modality.Substitution.html#297" class="Bound">a</a>
<a id="1864" href="Definition.Modality.Substitution.html#1808" class="Function Operator">_▶[_]_</a> <a id="1871" class="Symbol">{</a><a id="1872" class="Argument">n</a> <a id="1874" class="Symbol">=</a> <a id="1876" href="Definition.Modality.Substitution.html#1876" class="Bound">n</a><a id="1877" class="Symbol">}</a> <a id="1879" href="Definition.Modality.Substitution.html#1879" class="Bound">Ψ</a> <a id="1881" href="Definition.Modality.Substitution.html#1881" class="Bound">γ</a> <a id="1883" href="Definition.Modality.Substitution.html#1883" class="Bound">σ</a> <a id="1885" class="Symbol">=</a>
  <a id="1889" class="Symbol">(</a><a id="1890" href="Definition.Modality.Substitution.html#1890" class="Bound">x</a> <a id="1892" class="Symbol">:</a> <a id="1894" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1898" href="Definition.Modality.Substitution.html#1876" class="Bound">n</a><a id="1899" class="Symbol">)</a> <a id="1901" class="Symbol">→</a> <a id="1903" class="Symbol">(</a><a id="1904" href="Definition.Modality.Substitution.html#1879" class="Bound">Ψ</a> <a id="1906" href="Definition.Modality.Substitution.html#1007" class="Function Operator">*&gt;</a> <a id="1909" class="Symbol">(</a><a id="1910" href="Definition.Modality.Context.html#2011" class="Function">𝟘ᶜ</a> <a id="1913" href="Definition.Modality.Context.html#1042" class="Function Operator">,</a> <a id="1915" href="Definition.Modality.Substitution.html#1890" class="Bound">x</a> <a id="1917" href="Definition.Modality.Context.html#1042" class="Function Operator">≔</a> <a id="1919" href="Definition.Mode.html#3616" class="Function Operator">⌜</a> <a id="1921" href="Definition.Modality.Substitution.html#1881" class="Bound">γ</a> <a id="1923" href="Definition.Modality.Substitution.html#1890" class="Bound">x</a> <a id="1925" href="Definition.Mode.html#3616" class="Function Operator">⌝</a><a id="1926" class="Symbol">))</a> <a id="1929" href="Definition.Modality.Usage.html#1055" class="Datatype Operator">▸[</a> <a id="1932" href="Definition.Modality.Substitution.html#1881" class="Bound">γ</a> <a id="1934" href="Definition.Modality.Substitution.html#1890" class="Bound">x</a> <a id="1936" href="Definition.Modality.Usage.html#1055" class="Datatype Operator">]</a> <a id="1938" href="Definition.Modality.Substitution.html#1883" class="Bound">σ</a> <a id="1940" href="Definition.Modality.Substitution.html#1890" class="Bound">x</a>

<a id="1943" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="1977" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥_∥</a> <a id="1981" class="Symbol">:</a> <a id="1983" href="Definition.Untyped.html#11676" class="Function">Subst</a> <a id="1989" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="1991" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="1993" class="Symbol">→</a> <a id="1995" href="Definition.Mode.html#4332" class="Function">Mode-vector</a> <a id="2007" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="2009" class="Symbol">→</a> <a id="2011" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2018" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="2020" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="2022" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥_∥</a> <a id="2026" class="Symbol">{</a><a id="2027" class="Argument">n</a> <a id="2029" class="Symbol">=</a> <a id="2031" class="Number">0</a><a id="2032" class="Symbol">}</a>    <a id="2037" class="Symbol">_</a> <a id="2039" class="Symbol">_</a>  <a id="2042" class="Symbol">=</a> <a id="2044" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>
<a id="2047" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥_∥</a> <a id="2051" class="Symbol">{</a><a id="2052" class="Argument">n</a> <a id="2054" class="Symbol">=</a> <a id="2056" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2059" href="Definition.Modality.Substitution.html#2059" class="Bound">n</a><a id="2060" class="Symbol">}</a> <a id="2062" href="Definition.Modality.Substitution.html#2062" class="Bound">σ</a> <a id="2064" href="Definition.Modality.Substitution.html#2064" class="Bound">ms</a> <a id="2067" class="Symbol">=</a> <a id="2069" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥</a> <a id="2071" href="Definition.Untyped.html#12448" class="Function">tail</a> <a id="2076" href="Definition.Modality.Substitution.html#2062" class="Bound">σ</a> <a id="2078" href="Definition.Modality.Substitution.html#1977" class="Function Operator">∥</a> <a id="2080" class="Symbol">(</a><a id="2081" href="Definition.Mode.html#4732" class="Function">tailᵐ</a> <a id="2087" href="Definition.Modality.Substitution.html#2064" class="Bound">ms</a><a id="2089" class="Symbol">)</a> <a id="2091" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="2093" href="Definition.Modality.Usage.html#2836" class="Function Operator">⌈</a> <a id="2095" href="Definition.Untyped.html#12265" class="Function">head</a> <a id="2100" href="Definition.Modality.Substitution.html#2062" class="Bound">σ</a> <a id="2102" href="Definition.Modality.Usage.html#2836" class="Function Operator">⌉</a> <a id="2104" class="Symbol">(</a><a id="2105" href="Definition.Mode.html#4649" class="Function">headᵐ</a> <a id="2111" href="Definition.Modality.Substitution.html#2064" class="Bound">ms</a><a id="2113" class="Symbol">)</a>

<a id="2116" class="Comment">---------------------------------------------------------------</a>
<a id="2180" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2244" class="Comment">---------------------------------------------------------------</a>

<a id="2309" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2360" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2370" class="Symbol">:</a> <a id="2372" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2379" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="2381" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="2383" class="Symbol">→</a> <a id="2385" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2392" class="Symbol">(</a><a id="2393" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2396" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a><a id="2397" class="Symbol">)</a> <a id="2399" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="2401" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2411" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a> <a id="2414" class="Symbol">=</a> <a id="2416" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>
<a id="2419" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2429" class="Symbol">(</a><a id="2430" href="Definition.Modality.Substitution.html#2430" class="Bound">Ψ</a> <a id="2432" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="2434" href="Definition.Modality.Substitution.html#2434" class="Bound">δ</a><a id="2435" class="Symbol">)</a> <a id="2437" class="Symbol">=</a> <a id="2439" class="Symbol">(</a><a id="2440" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2450" href="Definition.Modality.Substitution.html#2430" class="Bound">Ψ</a><a id="2451" class="Symbol">)</a> <a id="2453" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="2455" href="Definition.Modality.Usage.Weakening.html#1149" class="Function">wkConₘ</a> <a id="2462" class="Symbol">(</a><a id="2463" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="2468" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a><a id="2470" class="Symbol">)</a> <a id="2472" href="Definition.Modality.Substitution.html#2434" class="Bound">δ</a>

<a id="2475" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2509" href="Definition.Modality.Substitution.html#2509" class="Function">liftSubstₘ</a> <a id="2520" class="Symbol">:</a> <a id="2522" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2529" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="2531" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="2533" class="Symbol">→</a> <a id="2535" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2542" class="Symbol">(</a><a id="2543" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2546" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a><a id="2547" class="Symbol">)</a> <a id="2549" class="Symbol">(</a><a id="2550" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2553" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="2554" class="Symbol">)</a>
<a id="2556" href="Definition.Modality.Substitution.html#2509" class="Function">liftSubstₘ</a> <a id="2567" href="Definition.Modality.Substitution.html#2567" class="Bound">Ψ</a> <a id="2569" class="Symbol">=</a> <a id="2571" class="Symbol">(</a><a id="2572" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2582" href="Definition.Modality.Substitution.html#2567" class="Bound">Ψ</a><a id="2583" class="Symbol">)</a> <a id="2585" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">⊙</a> <a id="2587" class="Symbol">(</a><a id="2588" href="Definition.Modality.Context.html#2011" class="Function">𝟘ᶜ</a> <a id="2591" href="Definition.Modality.Context.html#669" class="InductiveConstructor Operator">∙</a> <a id="2593" href="Definition.Modality.html#823" class="Function">𝟙</a><a id="2594" class="Symbol">)</a>

<a id="2597" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2630" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a> <a id="2639" class="Symbol">:</a> <a id="2641" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2648" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="2650" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="2652" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a> <a id="2661" class="Symbol">{</a><a id="2662" class="Argument">n</a> <a id="2664" class="Symbol">=</a> <a id="2666" class="Number">0</a><a id="2667" class="Symbol">}</a> <a id="2669" class="Symbol">=</a> <a id="2671" href="Definition.Modality.Substitution.html#849" class="InductiveConstructor">[]</a>
<a id="2674" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a> <a id="2683" class="Symbol">{</a><a id="2684" class="Argument">n</a> <a id="2686" class="Symbol">=</a> <a id="2688" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="2691" href="Definition.Modality.Substitution.html#2691" class="Bound">n</a><a id="2692" class="Symbol">}</a> <a id="2694" class="Symbol">=</a> <a id="2696" href="Definition.Modality.Substitution.html#2509" class="Function">liftSubstₘ</a> <a id="2707" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a>

<a id="2717" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2758" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2767" class="Symbol">:</a> <a id="2769" class="Symbol">(</a><a id="2770" href="Definition.Modality.Substitution.html#2770" class="Bound">ρ</a> <a id="2772" class="Symbol">:</a> <a id="2774" href="Definition.Untyped.NotParametrised.html#2135" class="Datatype">Wk</a> <a id="2777" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="2779" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="2780" class="Symbol">)</a> <a id="2782" class="Symbol">→</a> <a id="2784" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="2791" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="2793" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a>
<a id="2795" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2804" href="Definition.Untyped.NotParametrised.html#2164" class="InductiveConstructor">id</a>       <a id="2813" class="Symbol">=</a> <a id="2815" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a>
<a id="2824" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2833" class="Symbol">(</a><a id="2834" href="Definition.Untyped.NotParametrised.html#2228" class="InductiveConstructor">step</a> <a id="2839" href="Definition.Modality.Substitution.html#2839" class="Bound">ρ</a><a id="2840" class="Symbol">)</a> <a id="2842" class="Symbol">=</a> <a id="2844" href="Definition.Modality.Substitution.html#2360" class="Function">wk1Substₘ</a> <a id="2854" class="Symbol">(</a><a id="2855" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2864" href="Definition.Modality.Substitution.html#2839" class="Bound">ρ</a><a id="2865" class="Symbol">)</a>
<a id="2867" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2876" class="Symbol">(</a><a id="2877" href="Definition.Untyped.NotParametrised.html#2317" class="InductiveConstructor">lift</a> <a id="2882" href="Definition.Modality.Substitution.html#2882" class="Bound">ρ</a><a id="2883" class="Symbol">)</a> <a id="2885" class="Symbol">=</a> <a id="2887" href="Definition.Modality.Substitution.html#2509" class="Function">liftSubstₘ</a> <a id="2898" class="Symbol">(</a><a id="2899" href="Definition.Modality.Substitution.html#2758" class="Function">wkSubstₘ</a> <a id="2908" href="Definition.Modality.Substitution.html#2882" class="Bound">ρ</a><a id="2909" class="Symbol">)</a>

<a id="2912" class="Comment">------------------------------------------------------------------</a>
<a id="2979" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="3046" class="Comment">------------------------------------------------------------------</a>

<a id="3114" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3180" href="Definition.Modality.Substitution.html#3180" class="Function">consSubstₘ</a> <a id="3191" class="Symbol">:</a> <a id="3193" class="Symbol">(</a><a id="3194" href="Definition.Modality.Substitution.html#3194" class="Bound">Ψ</a> <a id="3196" class="Symbol">:</a> <a id="3198" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="3205" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="3207" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="3208" class="Symbol">)</a> <a id="3210" class="Symbol">→</a> <a id="3212" class="Symbol">(</a><a id="3213" href="Definition.Modality.Substitution.html#3213" class="Bound">γ</a> <a id="3215" class="Symbol">:</a> <a id="3217" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="3222" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a><a id="3223" class="Symbol">)</a> <a id="3225" class="Symbol">→</a> <a id="3227" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="3234" href="Definition.Modality.Substitution.html#717" class="Generalizable">m</a> <a id="3236" class="Symbol">(</a><a id="3237" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3240" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="3241" class="Symbol">)</a>
<a id="3243" href="Definition.Modality.Substitution.html#3180" class="Function">consSubstₘ</a> <a id="3254" class="Symbol">=</a> <a id="3256" href="Definition.Modality.Substitution.html#868" class="InductiveConstructor Operator">_⊙_</a>

<a id="3261" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3297" href="Definition.Modality.Substitution.html#3297" class="Function">sgSubstₘ</a> <a id="3306" class="Symbol">:</a> <a id="3308" class="Symbol">(</a><a id="3309" href="Definition.Modality.Substitution.html#3309" class="Bound">γ</a> <a id="3311" class="Symbol">:</a> <a id="3313" href="Definition.Modality.Context.html#627" class="Datatype">Conₘ</a> <a id="3318" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="3319" class="Symbol">)</a> <a id="3321" class="Symbol">→</a> <a id="3323" href="Definition.Modality.Substitution.html#812" class="Datatype">Substₘ</a> <a id="3330" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a> <a id="3332" class="Symbol">(</a><a id="3333" href="Tools.Nat.html#408" class="InductiveConstructor">1+</a> <a id="3336" href="Definition.Modality.Substitution.html#719" class="Generalizable">n</a><a id="3337" class="Symbol">)</a>
<a id="3339" href="Definition.Modality.Substitution.html#3297" class="Function">sgSubstₘ</a> <a id="3348" class="Symbol">=</a> <a id="3350" href="Definition.Modality.Substitution.html#3180" class="Function">consSubstₘ</a> <a id="3361" href="Definition.Modality.Substitution.html#2630" class="Function">idSubstₘ</a>
</pre></body></html>