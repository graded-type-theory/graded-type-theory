------------------------------------------------------------------------
-- Sizes of derivations
------------------------------------------------------------------------

open import Definition.Typed.Restrictions
open import Graded.Modality

module Definition.Typed.Size
  {‚Ñì} {M : Set ‚Ñì}
  {ùïÑ : Modality M}
  (R : Type-restrictions ùïÑ)
  where

open import Definition.Untyped M
open import Definition.Typed R

open import Tools.Size

private variable
  Œì       : Con Term _
  A B t u : Term _

opaque mutual

  -- The size of a derivation.

  size-‚ä¢‚Ä≤ : ‚ä¢ Œì ‚Üí Size
  size-‚ä¢‚Ä≤ Œµ         = leaf
  size-‚ä¢‚Ä≤ (‚ä¢Œì ‚àô ‚ä¢A) = size-‚ä¢‚Ä≤ ‚ä¢Œì ‚äï size-‚ä¢ ‚ä¢A

  -- The size of a derivation.

  size-‚ä¢ : Œì ‚ä¢ A ‚Üí Size
  size-‚ä¢ (U‚±º ‚ä¢Œì)       = node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢ (univ ‚ä¢A)     = node (size-‚ä¢‚à∑ ‚ä¢A)
  size-‚ä¢ (Œ†Œ£‚±º ‚ä¢A ‚ä¢B _) = size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B
  size-‚ä¢ (Empty‚±º ‚ä¢Œì)   = node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢ (Unit‚±º ‚ä¢Œì _)  = node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢ (‚Ñï‚±º ‚ä¢Œì)       = node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢ (Id‚±º ‚ä¢t ‚ä¢u)   = size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u

  -- The size of a derivation.

  size-‚ä¢‚à∑ : Œì ‚ä¢ t ‚à∑ A ‚Üí Size
  size-‚ä¢‚à∑ (conv ‚ä¢t B‚â°A) =
    size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚â° B‚â°A
  size-‚ä¢‚à∑ (var ‚ä¢Œì _) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (U‚±º ‚ä¢Œì) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (Œ†Œ£‚±º ‚ä¢A ‚ä¢B _) =
    size-‚ä¢‚à∑ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢B
  size-‚ä¢‚à∑ (lam‚±º ‚ä¢A ‚ä¢t _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t
  size-‚ä¢‚à∑ (‚ä¢t ‚àò‚±º ‚ä¢u) =
    size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚à∑ (prod‚±º ‚ä¢A ‚ä¢B ‚ä¢t ‚ä¢u _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚à∑ (fst‚±º ‚ä¢A ‚ä¢B ‚ä¢t) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚à∑ ‚ä¢t
  size-‚ä¢‚à∑ (snd‚±º ‚ä¢A ‚ä¢B ‚ä¢t) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚à∑ ‚ä¢t
  size-‚ä¢‚à∑ (prodrec‚±º ‚ä¢A ‚ä¢B ‚ä¢C ‚ä¢t ‚ä¢u _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢ ‚ä¢C ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚à∑ (Empty‚±º ‚ä¢Œì) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (emptyrec‚±º ‚ä¢A ‚ä¢t) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t
  size-‚ä¢‚à∑ (Unit‚±º ‚ä¢Œì _) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (star‚±º ‚ä¢Œì _) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (unitrec‚±º ‚ä¢A ‚ä¢t ‚ä¢u _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚à∑ (‚Ñï‚±º ‚ä¢Œì) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (zero‚±º ‚ä¢Œì) =
    node (size-‚ä¢‚Ä≤ ‚ä¢Œì)
  size-‚ä¢‚à∑ (suc‚±º ‚ä¢t) =
    node (size-‚ä¢‚à∑ ‚ä¢t)
  size-‚ä¢‚à∑ (natrec‚±º ‚ä¢A ‚ä¢t ‚ä¢u ‚ä¢v) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t) ‚äï (size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v)
  size-‚ä¢‚à∑ (Id‚±º ‚ä¢A ‚ä¢t ‚ä¢u) =
    size-‚ä¢‚à∑ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚à∑ (rfl‚±º ‚ä¢t) =
    node (size-‚ä¢‚à∑ ‚ä¢t)
  size-‚ä¢‚à∑ (J‚±º ‚ä¢A ‚ä¢t ‚ä¢B ‚ä¢u ‚ä¢v ‚ä¢w) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢ ‚ä¢B) ‚äï
    (size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v ‚äï size-‚ä¢‚à∑ ‚ä¢w)
  size-‚ä¢‚à∑ (K‚±º ‚ä¢t ‚ä¢B ‚ä¢u ‚ä¢v _) =
    (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v)
  size-‚ä¢‚à∑ ([]-cong‚±º ‚ä¢t ‚ä¢u ‚ä¢v _) =
    size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v

  -- The size of a derivation.

  size-‚ä¢‚â° : Œì ‚ä¢ A ‚â° B ‚Üí Size
  size-‚ä¢‚â° (univ A‚â°B) =
    node (size-‚ä¢‚â°‚à∑ A‚â°B)
  size-‚ä¢‚â° (refl ‚ä¢A) =
    node (size-‚ä¢ ‚ä¢A)
  size-‚ä¢‚â° (sym B‚â°A) =
    node (size-‚ä¢‚â° B‚â°A)
  size-‚ä¢‚â° (trans A‚â°B B‚â°C) =
    size-‚ä¢‚â° A‚â°B ‚äï size-‚ä¢‚â° B‚â°C
  size-‚ä¢‚â° (Œ†Œ£-cong ‚ä¢A A‚ÇÅ‚â°B‚ÇÅ A‚ÇÇ‚â°B‚ÇÇ _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚â° A‚ÇÅ‚â°B‚ÇÅ ‚äï size-‚ä¢‚â° A‚ÇÇ‚â°B‚ÇÇ
  size-‚ä¢‚â° (Id-cong A‚â°B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ) =
    size-‚ä¢‚â° A‚â°B ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ

  -- The size of a derivation.

  size-‚ä¢‚â°‚à∑ : Œì ‚ä¢ t ‚â° u ‚à∑ A ‚Üí Size
  size-‚ä¢‚â°‚à∑ (refl ‚ä¢t) =
    node (size-‚ä¢‚à∑ ‚ä¢t)
  size-‚ä¢‚â°‚à∑ (sym u‚â°t) =
    node (size-‚ä¢‚â°‚à∑ u‚â°t)
  size-‚ä¢‚â°‚à∑ (trans t‚â°u u‚â°v) =
    size-‚ä¢‚â°‚à∑ t‚â°u ‚äï size-‚ä¢‚â°‚à∑ u‚â°v
  size-‚ä¢‚â°‚à∑ (conv t‚â°u B‚â°A) =
    size-‚ä¢‚â°‚à∑ t‚â°u ‚äï size-‚ä¢‚â° B‚â°A
  size-‚ä¢‚â°‚à∑ (Œ†Œ£-cong ‚ä¢A A‚ÇÅ‚â°B‚ÇÅ A‚ÇÇ‚â°B‚ÇÇ _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚â°‚à∑ A‚ÇÅ‚â°B‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ A‚ÇÇ‚â°B‚ÇÇ
  size-‚ä¢‚â°‚à∑ (app-cong t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ) =
    size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ
  size-‚ä¢‚â°‚à∑ (Œ≤-red ‚ä¢A ‚ä¢B ‚ä¢t ‚ä¢u _ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚â°‚à∑ (Œ∑-eq ‚ä¢A ‚ä¢t‚ÇÅ ‚ä¢t‚ÇÇ t‚ÇÅ0‚â°t‚ÇÇ0) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t‚ÇÅ) ‚äï (size-‚ä¢‚à∑ ‚ä¢t‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ0‚â°t‚ÇÇ0)
  size-‚ä¢‚â°‚à∑ (fst-cong ‚ä¢A ‚ä¢B t‚â°u) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚â°‚à∑ t‚â°u
  size-‚ä¢‚â°‚à∑ (snd-cong ‚ä¢A ‚ä¢B t‚â°u) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚â°‚à∑ t‚â°u
  size-‚ä¢‚â°‚à∑ (Œ£-Œ≤‚ÇÅ ‚ä¢A ‚ä¢B ‚ä¢t ‚ä¢u _ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚â°‚à∑ (Œ£-Œ≤‚ÇÇ ‚ä¢A ‚ä¢B ‚ä¢t ‚ä¢u _ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚â°‚à∑ (Œ£-Œ∑ ‚ä¢A ‚ä¢B ‚ä¢t ‚ä¢u fst-t‚â°fst-u snd-t‚â°snd-u) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚à∑ ‚ä¢t) ‚äï
    (size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚â°‚à∑ fst-t‚â°fst-u ‚äï size-‚ä¢‚â°‚à∑ snd-t‚â°snd-u)
  size-‚ä¢‚â°‚à∑ (prod-cong ‚ä¢A ‚ä¢B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B) ‚äï (size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ)
  size-‚ä¢‚â°‚à∑ (prodrec-cong ‚ä¢A ‚ä¢B C‚â°D t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚â° C‚â°D) ‚äï
    (size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ)
  size-‚ä¢‚â°‚à∑ (prodrec-Œ≤ ‚ä¢A ‚ä¢B ‚ä¢C ‚ä¢t ‚ä¢u ‚ä¢v _ _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢ ‚ä¢C) ‚äï
    (size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v)
  size-‚ä¢‚â°‚à∑ (emptyrec-cong A‚â°B t‚â°u) =
    size-‚ä¢‚â° A‚â°B ‚äï size-‚ä¢‚â°‚à∑ t‚â°u
  size-‚ä¢‚â°‚à∑ (unitrec-cong A‚â°B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ _ _) =
    size-‚ä¢‚â° A‚â°B ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ
  size-‚ä¢‚â°‚à∑ (unitrec-Œ≤ ‚ä¢A ‚ä¢t _ _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t
  size-‚ä¢‚â°‚à∑ (unitrec-Œ≤-Œ∑ ‚ä¢A ‚ä¢t ‚ä¢u _ _) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚â°‚à∑ (Œ∑-unit ‚ä¢t ‚ä¢u _) =
    size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚â°‚à∑ (suc-cong t‚â°u) =
    node (size-‚ä¢‚â°‚à∑ t‚â°u)
  size-‚ä¢‚â°‚à∑ (natrec-cong ‚ä¢A A‚â°B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ t‚ÇÉ‚â°u‚ÇÉ) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚â° A‚â°B) ‚äï
    (size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÉ‚â°u‚ÇÉ)
  size-‚ä¢‚â°‚à∑ (natrec-zero ‚ä¢A ‚ä¢t ‚ä¢u) =
    size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚â°‚à∑ (natrec-suc ‚ä¢A ‚ä¢t ‚ä¢u ‚ä¢v) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t) ‚äï (size-‚ä¢‚à∑ ‚ä¢u ‚äï size-‚ä¢‚à∑ ‚ä¢v)
  size-‚ä¢‚â°‚à∑ (Id-cong A‚â°B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ) =
    size-‚ä¢‚â°‚à∑ A‚â°B ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ
  size-‚ä¢‚â°‚à∑ (J-cong ‚ä¢A‚ÇÅ A‚ÇÅ‚â°B‚ÇÅ ‚ä¢t‚ÇÅ t‚ÇÅ‚â°u‚ÇÅ A‚ÇÇ‚â°B‚ÇÇ t‚ÇÇ‚â°u‚ÇÇ t‚ÇÉ‚â°u‚ÇÉ t‚ÇÑ‚â°u‚ÇÑ) =
    ((size-‚ä¢ ‚ä¢A‚ÇÅ ‚äï size-‚ä¢‚â° A‚ÇÅ‚â°B‚ÇÅ) ‚äï (size-‚ä¢‚à∑ ‚ä¢t‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ)) ‚äï
    ((size-‚ä¢‚â° A‚ÇÇ‚â°B‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ) ‚äï
     (size-‚ä¢‚â°‚à∑ t‚ÇÉ‚â°u‚ÇÉ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÑ‚â°u‚ÇÑ))
  size-‚ä¢‚â°‚à∑ (K-cong A‚ÇÅ‚â°B‚ÇÅ ‚ä¢t‚ÇÅ t‚ÇÅ‚â°u‚ÇÅ A‚ÇÇ‚â°B‚ÇÇ t‚ÇÇ‚â°u‚ÇÇ t‚ÇÉ‚â°u‚ÇÉ _) =
    (size-‚ä¢‚â° A‚ÇÅ‚â°B‚ÇÅ ‚äï size-‚ä¢‚à∑ ‚ä¢t‚ÇÅ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ) ‚äï
    (size-‚ä¢‚â° A‚ÇÇ‚â°B‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÉ‚â°u‚ÇÉ)
  size-‚ä¢‚â°‚à∑ ([]-cong-cong A‚â°B t‚ÇÅ‚â°u‚ÇÅ t‚ÇÇ‚â°u‚ÇÇ t‚ÇÉ‚â°u‚ÇÉ _) =
    (size-‚ä¢‚â° A‚â°B ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÅ‚â°u‚ÇÅ) ‚äï (size-‚ä¢‚â°‚à∑ t‚ÇÇ‚â°u‚ÇÇ ‚äï size-‚ä¢‚â°‚à∑ t‚ÇÉ‚â°u‚ÇÉ)
  size-‚ä¢‚â°‚à∑ (J-Œ≤ ‚ä¢A ‚ä¢t ‚ä¢B ‚ä¢u _) =
    (size-‚ä¢ ‚ä¢A ‚äï size-‚ä¢‚à∑ ‚ä¢t) ‚äï (size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚à∑ ‚ä¢u)
  size-‚ä¢‚â°‚à∑ (K-Œ≤ ‚ä¢t ‚ä¢B ‚ä¢u _) =
    size-‚ä¢‚à∑ ‚ä¢t ‚äï size-‚ä¢ ‚ä¢B ‚äï size-‚ä¢‚à∑ ‚ä¢u
  size-‚ä¢‚â°‚à∑ ([]-cong-Œ≤ ‚ä¢t _ _) =
    node (size-‚ä¢‚à∑ ‚ä¢t)
