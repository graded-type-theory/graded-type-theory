------------------------------------------------------------------------
-- The logical relation for validity
------------------------------------------------------------------------

open import Definition.Typed.EqualityRelation
open import Definition.Typed.Restrictions
open import Graded.Modality

module Definition.LogicalRelation.Substitution
  {a} {M : Set a}
  {ğ•„ : Modality M}
  (R : Type-restrictions ğ•„)
  â¦ƒ eqrel : EqRelSet R â¦„
  where

open EqRelSet eqrel
open Type-restrictions R

open import Definition.LogicalRelation R
open import Definition.LogicalRelation.Hidden R
open import Definition.LogicalRelation.Properties R

open import Definition.Typed R
open import Definition.Typed.Properties R
open import Definition.Typed.Weakening R as TW using (_âˆ·_âŠ‡_)

open import Definition.Untyped M
open import Definition.Untyped.Neutral M
open import Definition.Untyped.Properties M

open import Tools.Fin
open import Tools.Function
open import Tools.Level
open import Tools.Nat using (Nat)
open import Tools.Product as Î£
import Tools.PropositionalEquality as PE
open import Tools.Reasoning.PropositionalEquality
open import Tools.Unit

private variable
  m n                                                   : Nat
  Î“ Î” Î—                                                 : Con Term _
  A Aâ‚ Aâ‚‚ B Bâ‚ Bâ‚‚ C Câ‚ Câ‚‚ D E t tâ‚ tâ‚‚ u uâ‚ uâ‚‚ v vâ‚ vâ‚‚ w : Term _
  Ïƒ Ïƒâ‚ Ïƒâ‚‚ Ïƒâ‚ƒ                                            : Subst _ _
  Ï                                                     : Wk _ _
  l lâ€² lâ€³ lâ€´                                            : TypeLevel

------------------------------------------------------------------------
-- The type formers

opaque mutual

  -- Valid contexts.

  infix 4 âŠ©áµ›_

  âŠ©áµ›_ : Con Term n â†’ Set a
  âŠ©áµ› Îµ       = Lift _ âŠ¤
  âŠ©áµ› (Î“ âˆ™ A) = âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A

  -- Valid types.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_

  _âŠ©áµ›âŸ¨_âŸ©_ : Con Term n â†’ TypeLevel â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_ {n} Î“ l A =
    âŠ©áµ› Î“ Ã—
    (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ])

  -- Valid substitution equality.

  infix 4 _âŠ©Ë¢_â‰¡_âˆ·_

  _âŠ©Ë¢_â‰¡_âˆ·_ : Con Term m â†’ Subst m n â†’ Subst m n â†’ Con Term n â†’ Set a
  Î” âŠ©Ë¢ _  â‰¡ _  âˆ· Îµ     = âŠ¢ Î”
  Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A =
    (âˆƒ Î» l â†’
     (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“

opaque

  -- Valid terms.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_âˆ·_

  _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ : Con Term n â†’ TypeLevel â†’ Term n â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ {n} Î“ l t A =
    Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])

opaque

  -- Valid substitutions.

  infix 4 _âŠ©Ë¢_âˆ·_

  _âŠ©Ë¢_âˆ·_ : Con Term m â†’ Subst m n â†’ Con Term n â†’ Set a
  Î” âŠ©Ë¢ _ âˆ· Îµ     = âŠ¢ Î”
  Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A =
    (âˆƒ Î» l â†’ (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“

opaque

  -- Valid term equality.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ :
    Con Term n â†’ TypeLevel â†’ Term n â†’ Term n â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ {n} Î“ l t u A =
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])

opaque

  -- Valid type equality.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ : Con Term n â†’ TypeLevel â†’ Term n â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ {n} Î“ l A B =
    Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])

------------------------------------------------------------------------
-- Some characterisation lemmas

opaque
  unfolding âŠ©áµ›_

  -- A characterisation lemma for âŠ©áµ›_.

  âŠ©áµ›Îµâ‡” : âŠ©áµ› Îµ â‡” âŠ¤
  âŠ©áµ›Îµâ‡” = _

opaque
  unfolding âŠ©áµ›_

  -- A characterisation lemma for âŠ©áµ›_.

  âŠ©áµ›âˆ™â‡” : âŠ©áµ› Î“ âˆ™ A â‡” âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  âŠ©áµ›âˆ™â‡” = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‡” :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‡”
    (âŠ©áµ› Î“ Ã—
     (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‡” = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â‡” :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
     Î“ âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
      Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ]))
  âŠ©áµ›â‰¡â‡” = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_âˆ·_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â‡” :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â‡”
    (Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
     (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›âˆ·â‡” = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â‡” :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
      Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ]))
  âŠ©áµ›â‰¡âˆ·â‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·Îµâ‡” : Î” âŠ©Ë¢ Ïƒ âˆ· Îµ â‡” âŠ¢ Î”
  âŠ©Ë¢âˆ·Îµâ‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·âˆ™â‡” :
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A â‡”
    ((âˆƒ Î» l â†’ (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“)
  âŠ©Ë¢âˆ·âˆ™â‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  âŠ©Ë¢â‰¡âˆ·Îµâ‡” : Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ â‡” âŠ¢ Î”
  âŠ©Ë¢â‰¡âˆ·Îµâ‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  âŠ©Ë¢â‰¡âˆ·âˆ™â‡” :
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A â‡”
    ((âˆƒ Î» l â†’
      (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
      Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“)
  âŠ©Ë¢â‰¡âˆ·âˆ™â‡” = idâ‡”

------------------------------------------------------------------------
-- An introduction lemma

opaque

  -- An introduction lemma for âŠ©áµ›_.

  âŠ©áµ›-âˆ™-intro : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ âŠ©áµ› Î“ âˆ™ A
  âŠ©áµ›-âˆ™-intro âŠ©A = âŠ©áµ›âˆ™â‡” .projâ‚‚ (_ , âŠ©A)

------------------------------------------------------------------------
-- Reflexivity and some related lemmas

opaque

  -- Reflexivity for _âŠ©Ë¢_â‰¡_âˆ·_.

  refl-âŠ©Ë¢â‰¡âˆ· :
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î“
  refl-âŠ©Ë¢â‰¡âˆ· {Î”} {Ïƒ} {Î“ = Îµ} =
    Î” âŠ©Ë¢ Ïƒ âˆ· Îµ      â‡”âŸ¨ âŠ©Ë¢âˆ·Îµâ‡” âŸ©â†’
    âŠ¢ Î”             â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·Îµâ‡” âŸ©â†’
    Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Îµ  â–¡
  refl-âŠ©Ë¢â‰¡âˆ· {Î”} {Ïƒ} {Î“ = Î“ âˆ™ A} =
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A                                               â‡”âŸ¨ âŠ©Ë¢âˆ·âˆ™â‡” âŸ©â†’

    ((âˆƒ Î» l â†’ (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“)                                            â†’âŸ¨ Î£.map (Î£.map idá¶  (Î£.map idá¶  refl-âŠ©â‰¡âˆ·)) refl-âŠ©Ë¢â‰¡âˆ· âŸ©

    ((âˆƒ Î» l â†’
      (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
      Î” âŠ©âŸ¨ l âŸ© head Ïƒ â‰¡ head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒ â‰¡ tail Ïƒ âˆ· Î“)                                   â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î“ âˆ™ A                                           â–¡

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ âˆ˜â†’ refl-âŠ©Ë¢â‰¡âˆ·

opaque

  -- Reflexivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  refl-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ A
  refl-âŠ©áµ›â‰¡ âŠ©A =
    âŠ©áµ›â‰¡â‡” .projâ‚‚ (âŠ©A , âŠ©A , refl-âŠ©â‰¡ âˆ˜â†’ âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©t =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ âˆ˜â†’ refl-âŠ©Ë¢â‰¡âˆ·

opaque

  -- Reflexivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  refl-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ t âˆ· A
  refl-âŠ©áµ›â‰¡âˆ· âŠ©t =
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚ (âŠ©t , âŠ©t , refl-âŠ©â‰¡âˆ· âˆ˜â†’ âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©t)

------------------------------------------------------------------------
-- Symmetry

opaque

  -- Symmetry for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  sym-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â‰¡ A
  sym-âŠ©áµ›â‰¡ Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©A , âŠ©B , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚ (âŠ©B , âŠ©A , sym-âŠ©â‰¡ âˆ˜â†’ Aâ‰¡B)

opaque

  -- Symmetry for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  sym-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© u â‰¡ t âˆ· A
  sym-âŠ©áµ›â‰¡âˆ· tâ‰¡u =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©t , âŠ©u , tâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚ (âŠ©u , âŠ©t , sym-âŠ©â‰¡âˆ· âˆ˜â†’ tâ‰¡u)

opaque

  -- Symmetry for _âŠ©Ë¢_â‰¡_âˆ·_.

  sym-âŠ©Ë¢â‰¡âˆ· :
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©Ë¢ Ïƒâ‚‚ â‰¡ Ïƒâ‚ âˆ· Î“
  sym-âŠ©Ë¢â‰¡âˆ· {Î“ = Îµ} =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚
  sym-âŠ©Ë¢â‰¡âˆ· {Î“ = _ âˆ™ _} = Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((l , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    case conv-âŠ©â‰¡âˆ· (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) $
         sym-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ of Î»
      Ïƒâ‚‚â‚€â‰¡Ïƒâ‚â‚€ â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚ ((l , âŠ©A , Ïƒâ‚‚â‚€â‰¡Ïƒâ‚â‚€) , sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š)

------------------------------------------------------------------------
-- Well-formedness lemmas

opaque

  -- A well-formedness lemma for âŠ©áµ›_.

  wf-âŠ©áµ›-âˆ™ : âŠ©áµ› Î“ âˆ™ A â†’ âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  wf-âŠ©áµ›-âˆ™ = âŠ©áµ›âˆ™â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wf-âŠ©áµ› : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ âŠ©áµ› Î“
  wf-âŠ©áµ› = projâ‚ âˆ˜â†’ âŠ©áµ›â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wf-âˆ™-âŠ©áµ› :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆƒ Î» lâ€² â†’ Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A
  wf-âˆ™-âŠ©áµ› = wf-âŠ©áµ›-âˆ™ âˆ˜â†’ wf-âŠ©áµ›

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wf-âŠ©áµ›âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  wf-âŠ©áµ›âˆ· = projâ‚ âˆ˜â†’ âŠ©áµ›âˆ·â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_âˆ·_.

  wf-âŠ©Ë¢âˆ· : Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’ âŠ©áµ› Î“
  wf-âŠ©Ë¢âˆ· {Î“ = Îµ}     = Î» _ â†’ âŠ©áµ›Îµâ‡” .projâ‚‚ _
  wf-âŠ©Ë¢âˆ· {Î“ = _ âˆ™ _} =
    âŠ©áµ›âˆ™â‡” .projâ‚‚ âˆ˜â†’ Î£.map idá¶  projâ‚ âˆ˜â†’ projâ‚ âˆ˜â†’ âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wf-âŠ©áµ›â‰¡ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã— Î“ âŠ©áµ›âŸ¨ l âŸ© B
  wf-âŠ©áµ›â‰¡ = Î£.map idá¶  projâ‚ âˆ˜â†’ âŠ©áµ›â‰¡â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wf-âŠ©áµ›â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã— Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A
  wf-âŠ©áµ›â‰¡âˆ· = Î£.map idá¶  projâ‚ âˆ˜â†’ âŠ©áµ›â‰¡âˆ·â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  wf-âŠ©Ë¢â‰¡âˆ· : Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ Î” âŠ©Ë¢ Ïƒâ‚ âˆ· Î“ Ã— Î” âŠ©Ë¢ Ïƒâ‚‚ âˆ· Î“
  wf-âŠ©Ë¢â‰¡âˆ· {Î“ = Îµ} Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      âŠ¢Î” â†’
    âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ âŠ¢Î” , âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ âŠ¢Î”
  wf-âŠ©Ë¢â‰¡âˆ· {Î“ = _ âˆ™ _} Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((l , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    case wf-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ of Î»
      (âŠ©Ïƒâ‚â‚€ , âŠ©Ïƒâ‚‚â‚€) â†’
    case conv-âŠ©âˆ· (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŠ©Ïƒâ‚‚â‚€ of Î»
      âŠ©Ïƒâ‚‚â‚€ â†’
    case wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š of Î»
      (âŠ©Ïƒâ‚â‚Š , âŠ©Ïƒâ‚‚â‚Š) â†’
      âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚ ((l , âŠ©A , âŠ©Ïƒâ‚â‚€) , âŠ©Ïƒâ‚â‚Š)
    , âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚ ((l , âŠ©A , âŠ©Ïƒâ‚‚â‚€) , âŠ©Ïƒâ‚‚â‚Š)

------------------------------------------------------------------------
-- More characterisation lemmas

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‡”âŠ©áµ›â‰¡ : (Î“ âŠ©áµ›âŸ¨ l âŸ© A) â‡” Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ A
  âŠ©áµ›â‡”âŠ©áµ›â‰¡ = refl-âŠ©áµ›â‰¡ , projâ‚ âˆ˜â†’ wf-âŠ©áµ›â‰¡

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â‡” Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ t âˆ· A
  âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· = refl-âŠ©áµ›â‰¡âˆ· , projâ‚ âˆ˜â†’ wf-âŠ©áµ›â‰¡âˆ·

opaque

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· : Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â‡” Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î“
  âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· = refl-âŠ©Ë¢â‰¡âˆ· , projâ‚ âˆ˜â†’ wf-âŠ©Ë¢â‰¡âˆ·

opaque

  -- A variant of âŠ©áµ›â‰¡â‡”.

  âŠ©áµ›â‰¡â‡”â€² :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
     Î“ âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
      Î” âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‰¡â‡”â€² {n} {Î“} {l} {A} {B} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                 â‡”âŸ¨ âŠ©áµ›â‰¡â‡” âŸ©

    Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])    â‡”âŸ¨ (Î£-cong-â‡” Î» âŠ©A â†’ Î£-cong-â‡” Î» _ â†’
                                          (Î» hyp {m = _} {Î” = _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
      A [ Ïƒâ‚ ]                                 â‰¡âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©
      A [ Ïƒâ‚‚ ]                                 â‰¡âŸ¨ hyp (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚) âŸ©âŠ©âˆ
      B [ Ïƒâ‚‚ ]                                 âˆ)
                                        , (Î» hyp {_ _ _} âŠ©Ïƒ â†’
                                             hyp (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ))) âŸ©
    Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])  â–¡â‡”

opaque

  -- A variant of âŠ©áµ›â‰¡âˆ·â‡”.

  âŠ©áµ›â‰¡âˆ·â‡”â€² :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
      Î” âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›â‰¡âˆ·â‡”â€² {n} {Î“} {l} {t} {u} {A} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                        â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡” âŸ©

    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])     â‡”âŸ¨ (Î£-cong-â‡” Î» âŠ©t â†’ Î£-cong-â‡” Î» _ â†’
                                                     (Î» hyp {m = _} {Î” = _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
      t [ Ïƒâ‚ ]                                            â‰¡âŸ¨ âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·
      t [ Ïƒâ‚‚ ]                                            â‰¡âŸ¨ conv-âŠ©â‰¡âˆ·
                                                               (âŠ©áµ›â‡” .projâ‚ (wf-âŠ©áµ›âˆ· âŠ©t) .projâ‚‚ (sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚))
                                                               (hyp (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚)) âŸ©âŠ©âˆ·âˆ
      u [ Ïƒâ‚‚ ]                                            âˆ)
                                                   , (Î» hyp {_ _ _} âŠ©Ïƒ â†’
                                                        hyp (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ))) âŸ©
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
     Î” âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])  â–¡â‡”

opaque

  -- A variant of âŠ©Ë¢âˆ·âˆ™â‡”.

  âŠ©Ë¢âˆ·âˆ™â‡”â€² :
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A â‡”
    ((âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     (âˆƒ Î» l â†’ Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“)
  âŠ©Ë¢âˆ·âˆ™â‡”â€² {Î”} {Ïƒ} {Î“} {A} =
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A                                              â‡”âŸ¨ âŠ©Ë¢âˆ·âˆ™â‡” âŸ©

    (âˆƒ Î» l â†’ (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“
                                                                â‡”âŸ¨ (Î» ((l , âŠ©A , âŠ©head) , âŠ©tail) â†’
                                                                      (l , âŠ©A) , (l , âŠ©head) , âŠ©tail)
                                                                 , (Î» ((lâ‚ , âŠ©A) , (_ , âŠ©head) , âŠ©tail) â†’
                                                                      (lâ‚ , âŠ©A , level-âŠ©âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A âŠ©tail) âŠ©head) , âŠ©tail)
                                                                 âŸ©
    (âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (âˆƒ Î» l â†’ Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“                                             â–¡â‡”

opaque

  -- A variant of âŠ©Ë¢â‰¡âˆ·âˆ™â‡”.

  âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² :
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A â‡”
    ((âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     (âˆƒ Î» l â†’ Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
     Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“)
  âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² {Î”} {Ïƒâ‚} {Ïƒâ‚‚} {Î“} {A} =
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A                                            â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©

    (âˆƒ Î» l â†’
     (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                      â‡”âŸ¨ (Î» ((l , âŠ©A , headâ‰¡head) , tailâ‰¡tail) â†’
                                                                          (l , âŠ©A) , (l , headâ‰¡head) , tailâ‰¡tail)
                                                                     , (Î» ((lâ‚ , âŠ©A) , (_ , headâ‰¡head) , tailâ‰¡tail) â†’
                                                                            ( lâ‚ , âŠ©A
                                                                            , level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A (wf-âŠ©Ë¢â‰¡âˆ· tailâ‰¡tail .projâ‚))
                                                                                headâ‰¡head
                                                                            )
                                                                          , tailâ‰¡tail)
                                                                     âŸ©
    (âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (âˆƒ Î» l â†’ Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                      â–¡â‡”

------------------------------------------------------------------------
-- Changing type levels

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  level-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A
  level-âŠ©áµ›âˆ· âŠ©A âŠ©t =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t of Î»
      (_ , tâ‰¡t) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©A
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) $
          tâ‰¡t Ïƒâ‚â‰¡Ïƒâ‚‚
      )

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  level-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B
  level-âŠ©áµ›â‰¡ âŠ©A âŠ©B Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (_ , _ , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©A , âŠ©B
      , Î» âŠ©Ïƒ â†’
          level-âŠ©â‰¡ (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A âŠ©Ïƒ) (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©B âŠ©Ïƒ) $
          Aâ‰¡B âŠ©Ïƒ
      )

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  level-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A
  level-âŠ©áµ›â‰¡âˆ· âŠ©A tâ‰¡u =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©t , âŠ©u , tâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( level-âŠ©áµ›âˆ· âŠ©A âŠ©t
      , level-âŠ©áµ›âˆ· âŠ©A âŠ©u
      , Î» âŠ©Ïƒ â†’
          level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A âŠ©Ïƒ) $
          tâ‰¡u âŠ©Ïƒ
      )

------------------------------------------------------------------------
-- Transitivity

opaque

  -- Transitivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  trans-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ C
  trans-âŠ©áµ›â‰¡ Aâ‰¡B Bâ‰¡C =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©A , _ , Aâ‰¡B) â†’
    case âŠ©áµ›â‰¡â‡” .projâ‚ Bâ‰¡C of Î»
      (_ , âŠ©C , Bâ‰¡C) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚ (âŠ©A , âŠ©C , Î» âŠ©Ïƒ â†’ trans-âŠ©â‰¡ (Aâ‰¡B âŠ©Ïƒ) (Bâ‰¡C âŠ©Ïƒ))

opaque

  -- Transitivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  trans-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© u â‰¡ v âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ v âˆ· A
  trans-âŠ©áµ›â‰¡âˆ· tâ‰¡u uâ‰¡v =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ uâ‰¡v of Î»
      (_ , âŠ©v , uâ‰¡v) â†’
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ $ level-âŠ©áµ›â‰¡âˆ· (wf-âŠ©áµ›âˆ· âŠ©v) tâ‰¡u of Î»
      (âŠ©t , _ , tâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚ (âŠ©t , âŠ©v , Î» âŠ©Ïƒ â†’ trans-âŠ©â‰¡âˆ· (tâ‰¡u âŠ©Ïƒ) (uâ‰¡v âŠ©Ïƒ))

opaque

  -- Transitivity for _âŠ©Ë¢_â‰¡_âˆ·_.

  trans-âŠ©Ë¢â‰¡ :
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©Ë¢ Ïƒâ‚‚ â‰¡ Ïƒâ‚ƒ âˆ· Î“ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚ƒ âˆ· Î“
  trans-âŠ©Ë¢â‰¡ {Î“ = Îµ} Ïƒâ‚â‰¡Ïƒâ‚‚ _ =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ $ âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚
  trans-âŠ©Ë¢â‰¡ {Î“ = _ âˆ™ _} Ïƒâ‚â‰¡Ïƒâ‚‚ Ïƒâ‚‚â‰¡Ïƒâ‚ƒ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((l , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚‚â‰¡Ïƒâ‚ƒ of Î»
      ((l , âŠ©A , Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€) , Ïƒâ‚‚â‚Šâ‰¡Ïƒâ‚ƒâ‚Š) â†’
    case conv-âŠ©â‰¡âˆ· (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ $ sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€ of Î»
      Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€ â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( (l , âŠ©A , trans-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€)
      , trans-âŠ©Ë¢â‰¡ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š Ïƒâ‚‚â‚Šâ‰¡Ïƒâ‚ƒâ‚Š
      )

------------------------------------------------------------------------
-- Conversion

opaque

  -- Conversion for one of the contexts for _âŠ©Ë¢_â‰¡_âˆ·_.

  conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A â†’ Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ B
  conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ {Î“} {A} {B} {Î”} {Ïƒâ‚} {Ïƒâ‚‚} Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (_ , âŠ©B , Aâ‰¡B) â†’

    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A                                            â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’
     (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                      â†’âŸ¨ (Î» ((_ , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                            (_ , âŠ©B , conv-âŠ©â‰¡âˆ· (Aâ‰¡B $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚) Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)
                                                                          , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
    (âˆƒ Î» l â†’
     (Î“ âŠ©áµ›âŸ¨ l âŸ© B) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· B [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                      â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ B                                            â–¡

opaque

  -- Conversion for one of the contexts for _âŠ©Ë¢_âˆ·_.

  conv-âŠ©Ë¢âˆ·-âˆ™ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A â†’ Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ B
  conv-âŠ©Ë¢âˆ·-âˆ™ Aâ‰¡B =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‰¡B âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- Conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_.

  conv-âˆ™-âŠ©áµ› :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C
  conv-âˆ™-âŠ©áµ› {Î“} {A} {B} {l} {C} Aâ‰¡B âŠ©C =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©A , âŠ©B , Aâ‰¡B) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›-âˆ™-intro âŠ©B
      , Î» {_} {Î” = Î”} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} â†’
          Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ B                            â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          (âˆƒ Î» l â†’
           (Î“ âŠ©áµ›âŸ¨ l âŸ© B) Ã—
           Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· B [ tail Ïƒâ‚ ]) Ã—
          Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                      â†’âŸ¨ (Î» ((_ , _ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                  (_ , âŠ©A , conv-âŠ©â‰¡âˆ· (sym-âŠ©â‰¡ $ Aâ‰¡B $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚) Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)
                                                                , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
          (âˆƒ Î» l â†’
           (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
           Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
          Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                      â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A                            â†’âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©C .projâ‚‚ âŸ©

          Î” âŠ©âŸ¨ l âŸ© C [ Ïƒâ‚ ] â‰¡ C [ Ïƒâ‚‚ ]                    â–¡
      )

opaque

  -- Another kind of conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_.

  conv-âˆ™âˆ™-âŠ©áµ› :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    Î“ âˆ™ Aâ‚ âŠ©áµ›âŸ¨ lâ€³ âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î“ âˆ™ Aâ‚ âˆ™ Bâ‚ âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ âˆ™ Aâ‚‚ âˆ™ Bâ‚‚ âŠ©áµ›âŸ¨ l âŸ© C
  conv-âˆ™âˆ™-âŠ©áµ› {Î“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} {l} {C} Aâ‚â‰¡Aâ‚‚ Bâ‚â‰¡Bâ‚‚ âŠ©C =
    case sym-âŠ©áµ›â‰¡ Aâ‚â‰¡Aâ‚‚ of Î»
      Aâ‚‚â‰¡Aâ‚ â†’
    case âŠ©áµ›â‰¡â‡” .projâ‚ Bâ‚â‰¡Bâ‚‚ of Î»
      (âŠ©Bâ‚ , âŠ©Bâ‚‚ , Bâ‚â‰¡Bâ‚‚) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›-âˆ™-intro (conv-âˆ™-âŠ©áµ› Aâ‚â‰¡Aâ‚‚ âŠ©Bâ‚‚)
      , Î» {_} {Î” = Î”} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} â†’
          Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ Aâ‚‚ âˆ™ Bâ‚‚                       â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          (âˆƒ Î» l â†’
           (Î“ âˆ™ Aâ‚‚ âŠ©áµ›âŸ¨ l âŸ© Bâ‚‚) Ã—
           Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· Bâ‚‚ [ tail Ïƒâ‚ ]) Ã—
          Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“ âˆ™ Aâ‚‚                  â†’âŸ¨ ((Î» ((_ , _ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                   ( _ , âŠ©Bâ‚
                                                                   , conv-âŠ©â‰¡âˆ·
                                                                       (sym-âŠ©â‰¡ $ Bâ‚â‰¡Bâ‚‚ $
                                                                        conv-âŠ©Ë¢âˆ·-âˆ™ Aâ‚‚â‰¡Aâ‚ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚)
                                                                       Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€
                                                                   )
                                                                 , conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‚‚â‰¡Aâ‚ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š)) âŸ©
          (âˆƒ Î» l â†’
           (Î“ âˆ™ Aâ‚ âŠ©áµ›âŸ¨ l âŸ© Bâ‚) Ã—
           Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· Bâ‚ [ tail Ïƒâ‚ ]) Ã—
          Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“ âˆ™ Aâ‚                  â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ Aâ‚ âˆ™ Bâ‚                       â†’âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©C .projâ‚‚ âŸ©

          Î” âŠ©âŸ¨ l âŸ© C [ Ïƒâ‚ ] â‰¡ C [ Ïƒâ‚‚ ]                     â–¡
      )

opaque

  -- Conversion for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  conv-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· B
  conv-âŠ©áµ›âˆ· Aâ‰¡B âŠ©t =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (_ , âŠ©B , Aâ‰¡B) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©B
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          conv-âŠ©â‰¡âˆ· (Aâ‰¡B $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) $
          âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚
      )

opaque

  -- Conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  conv-âˆ™-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î“ âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C
  conv-âˆ™-âŠ©áµ›âˆ· Aâ‰¡B âŠ©t =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t of Î»
      (âŠ©C , tâ‰¡t) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( conv-âˆ™-âŠ©áµ› Aâ‰¡B âŠ©C
      , tâ‰¡t âˆ˜â†’ conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ (sym-âŠ©áµ›â‰¡ Aâ‰¡B)
      )

opaque

  -- Conversion for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  conv-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· B
  conv-âŠ©áµ›â‰¡âˆ· Aâ‰¡B tâ‰¡u =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©t , âŠ©u , tâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( conv-âŠ©áµ›âˆ· Aâ‰¡B âŠ©t
      , conv-âŠ©áµ›âˆ· Aâ‰¡B âŠ©u
      , Î» âŠ©Ïƒ â†’
          conv-âŠ©â‰¡âˆ· (âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B .projâ‚‚ .projâ‚‚ âŠ©Ïƒ) $
          tâ‰¡u âŠ©Ïƒ
      )

------------------------------------------------------------------------
-- Expansion

opaque

  -- An expansion lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·-â‡ :
    (âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
     Î” âŠ¢ t [ Ïƒ ] â‡’ u [ Ïƒ ] âˆ· A [ Ïƒ ]) â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A
  âŠ©áµ›âˆ·-â‡ {n} {Î“} {t} {u} {A} {l} tâ‡’u âŠ©u =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u of Î»
      (âŠ©A , uâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›âˆ·â‡” .projâ‚‚
          ( âŠ©A
          , Î» {_} {_} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
              case wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
                (âŠ©Ïƒâ‚ , âŠ©Ïƒâ‚‚) â†’
              t [ Ïƒâ‚ ]             â‰¡âŸ¨ lemma âŠ©Ïƒâ‚ âŸ©âŠ©âˆ·
              u [ Ïƒâ‚ ] âˆ· A [ Ïƒâ‚ ]  â‰¡âŸ¨ uâ‰¡u Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆ·
                                    âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·
              u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚‚ ]  â‰¡Ë˜âŸ¨ lemma âŠ©Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆâˆ·
              t [ Ïƒâ‚‚ ]             âˆ
          )
      , âŠ©u
      , lemma
      )
    where
    lemma :
      âˆ€ {m Î”} {Ïƒ : Subst m n} â†’
      Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ]
    lemma âŠ©Ïƒ =
      case âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©u âŠ©Ïƒ of Î»
        âŠ©u[Ïƒ] â†’
      âŠ©âˆ·-â‡* (tâ‡’u âŠ©Ïƒ â‡¨ id (escape-âŠ©âˆ· âŠ©u[Ïƒ])) âŠ©u[Ïƒ]

------------------------------------------------------------------------
-- Some lemmas related to _âŠ©Ë¢_âˆ·_ and _âŠ©Ë¢_â‰¡_âˆ·_

opaque

  -- A cast lemma for _âŠ©Ë¢_âˆ·_.

  cast-âŠ©Ë¢âˆ· :
    ((x : Fin n) â†’ Ïƒâ‚ x PE.â‰¡ Ïƒâ‚‚ x) â†’
    Î” âŠ©Ë¢ Ïƒâ‚ âˆ· Î“ â†’ Î” âŠ©Ë¢ Ïƒâ‚‚ âˆ· Î“
  cast-âŠ©Ë¢âˆ· {Î“ = Îµ} _ âŠ©Ïƒâ‚ =
    âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ $ âŠ©Ë¢âˆ·Îµâ‡” .projâ‚ âŠ©Ïƒâ‚
  cast-âŠ©Ë¢âˆ· {Î“ = _ âˆ™ A} Ïƒâ‚â‰¡Ïƒâ‚‚ âŠ©Ïƒâ‚ =
    case âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ âŠ©Ïƒâ‚ of Î»
      ((_ , âŠ©A , âŠ©Ïƒâ‚â‚€) , âŠ©Ïƒâ‚â‚Š) â†’
    case Ïƒâ‚â‰¡Ïƒâ‚‚ âˆ˜â†’ (_+1) of Î»
      Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š â†’
    âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_âˆ·_ _ _) (Ïƒâ‚â‰¡Ïƒâ‚‚ x0)
            (substVar-to-subst Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š A) âŠ©Ïƒâ‚â‚€
        )
      , cast-âŠ©Ë¢âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š âŠ©Ïƒâ‚â‚Š
      )

opaque

  -- A lemma related to _â€¢â‚›_.

  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› :
    âŠ¢ Î— â†’
    Ï âˆ· Î— âŠ‡ Î” â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î— âŠ©Ë¢ Ï â€¢â‚› Ïƒâ‚ â‰¡ Ï â€¢â‚› Ïƒâ‚‚ âˆ· Î“
  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› {Î“ = Îµ} âŠ¢Î— _ _ =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ âŠ¢Î—
  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› {Î“ = _ âˆ™ A} âŠ¢Î— ÏâŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk-subst A)
            (wk-âŠ©â‰¡âˆ· ÏâŠ‡ âŠ¢Î— Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)
        )
      , âŠ©Ë¢â‰¡âˆ·-â€¢â‚› âŠ¢Î— ÏâŠ‡ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š
      )

opaque

  -- A lemma related to _â€¢â‚›_.

  âŠ©Ë¢âˆ·-â€¢â‚› :
    âŠ¢ Î— â†’
    Ï âˆ· Î— âŠ‡ Î” â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î— âŠ©Ë¢ Ï â€¢â‚› Ïƒ âˆ· Î“
  âŠ©Ë¢âˆ·-â€¢â‚› âŠ¢Î— ÏâŠ‡ =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-â€¢â‚› âŠ¢Î— ÏâŠ‡ âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to _â‚›â€¢_.

  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ :
    Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î“ â†’ Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    Î— âŠ©Ë¢ Ïƒâ‚ â‚›â€¢ Ï â‰¡ Ïƒâ‚‚ â‚›â€¢ Ï âˆ· Î“
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ TW.id _ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    Ïƒâ‚â‰¡Ïƒâ‚‚
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ (TW.step ÏâŠ‡) âŠ©Î“ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , âŠ©A , headâ‰¡head) , tailâ‰¡tail) â†’
    âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î“ tailâ‰¡tail
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ (TW.lift {A} ÏâŠ‡) âŠ©Î“âˆ™A Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âŠ©áµ›-âˆ™ âŠ©Î“âˆ™A of Î»
      (_ , âŠ©A) â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , _ , headâ‰¡head) , tailâ‰¡tail) â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©A)
      , (_ , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (subst-wk A) headâ‰¡head)
      , âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› âŠ©A) tailâ‰¡tail
      )

opaque

  -- A lemma related to _â‚›â€¢_.

  âŠ©Ë¢âˆ·-â‚›â€¢ : Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î“ â†’ Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’ Î— âŠ©Ë¢ Ïƒ â‚›â€¢ Ï âˆ· Î“
  âŠ©Ë¢âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î“ =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î“ âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to wk1Subst.

  âŠ©Ë¢â‰¡âˆ·-wk1Subst :
    Î” âŠ¢ A â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A âŠ©Ë¢ wk1Subst Ïƒâ‚ â‰¡ wk1Subst Ïƒâ‚‚ âˆ· Î“
  âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A = âŠ©Ë¢â‰¡âˆ·-â€¢â‚› (âŠ¢â†’âŠ¢âˆ™ âŠ¢A) (TW.step TW.id)

opaque

  -- A lemma related to wk1Subst.

  âŠ©Ë¢âˆ·-wk1Subst :
    Î” âŠ¢ A â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A âŠ©Ë¢ wk1Subst Ïƒ âˆ· Î“
  âŠ©Ë¢âˆ·-wk1Subst âŠ¢A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to liftSubst.

  âŠ©Ë¢â‰¡âˆ·-liftSubst :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒâ‚ ] âŠ©Ë¢ liftSubst Ïƒâ‚ â‰¡ liftSubst Ïƒâ‚‚ âˆ· Î“ âˆ™ A
  âŠ©Ë¢â‰¡âˆ·-liftSubst {A} âŠ©A Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case escape-âŠ© $ âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) of Î»
      âŠ¢A[Ïƒâ‚] â†’
    case âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A[Ïƒâ‚] Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š â†’
    case var (âŠ¢â†’âŠ¢âˆ™ âŠ¢A[Ïƒâ‚])
           (PE.substâ‚‚ (_âˆ·_âˆˆ_ _) (PE.sym $ wk1Subst-wk1 A) PE.refl
              here) of Î»
      âŠ¢0 â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , neutral-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š .projâ‚)
            (var _) (var _) âŠ¢0 âŠ¢0 (~-var âŠ¢0)
        )
      , Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š
      )

opaque

  -- A lemma related to liftSubst.

  âŠ©Ë¢âˆ·-liftSubst :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒ ] âŠ©Ë¢ liftSubst Ïƒ âˆ· Î“ âˆ™ A
  âŠ©Ë¢âˆ·-liftSubst âŠ©A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©A âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A variant of âŠ©Ë¢â‰¡âˆ·-liftSubst.

  âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² :
    Î“ âŠ©áµ›âŸ¨ l âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ Aâ‚ [ Ïƒâ‚ ] âŠ©Ë¢ liftSubst Ïƒâ‚ â‰¡ liftSubst Ïƒâ‚‚ âˆ· Î“ âˆ™ Aâ‚‚
  âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² {Aâ‚} {Aâ‚‚} {Ïƒâ‚} Aâ‚â‰¡Aâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‚â‰¡Aâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âŠ©áµ›â‰¡ Aâ‚â‰¡Aâ‚‚ .projâ‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A variant of âŠ©Ë¢âˆ·-liftSubst.

  âŠ©Ë¢âˆ·-liftSubstâ€² :
    Î“ âŠ©áµ›âŸ¨ l âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ Aâ‚ [ Ïƒ ] âŠ©Ë¢ liftSubst Ïƒ âˆ· Î“ âˆ™ Aâ‚‚
  âŠ©Ë¢âˆ·-liftSubstâ€² Aâ‚â‰¡Aâ‚‚ =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² Aâ‚â‰¡Aâ‚‚ âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to idSubst.

  âŠ©Ë¢âˆ·-idSubst :
    âŠ©áµ› Î“ â†’
    Î“ âŠ©Ë¢ idSubst âˆ· Î“
  âŠ©Ë¢âˆ·-idSubst {Î“ = Îµ} _ =
    âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ Îµ
  âŠ©Ë¢âˆ·-idSubst {Î“ = _ âˆ™ _} âŠ©Î“âˆ™A =
    case âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î“âˆ™A .projâ‚‚ of Î»
      âŠ©A â†’
    PE.substâ‚ƒ _âŠ©Ë¢_âˆ·_ (PE.cong (_âˆ™_ _) $ subst-id _) PE.refl PE.refl $
    cast-âŠ©Ë¢âˆ· subst-lift-id $
    âŠ©Ë¢âˆ·-liftSubst (âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î“âˆ™A .projâ‚‚)
      (âŠ©Ë¢âˆ·-idSubst (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚))

opaque

  -- A lemma related to sgSubst.

  âŠ©Ë¢â‰¡âˆ·-sgSubst :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â†’
    Î“ âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©Ë¢ sgSubst t â‰¡ sgSubst u âˆ· Î“ âˆ™ A
  âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A tâ‰¡u =
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©A)
      , (_ , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (PE.sym $ subst-id _) tâ‰¡u)
      , refl-âŠ©Ë¢â‰¡âˆ· (âŠ©Ë¢âˆ·-idSubst (wf-âŠ©áµ› âŠ©A))
      )

opaque

  -- A lemma related to sgSubst.

  âŠ©Ë¢âˆ·-sgSubst :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â†’
    Î“ âŠ©âŸ¨ l âŸ© t âˆ· A â†’
    Î“ âŠ©Ë¢ sgSubst t âˆ· Î“ âˆ™ A
  âŠ©Ë¢âˆ·-sgSubst âŠ©A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A âˆ˜â†’ âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- Reducibility from validity

opaque

  -- If there is a valid equality between A andÂ B, then there is a
  -- reducible equality between A andÂ B.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ©âŸ¨ l âŸ© A â‰¡ B
  âŠ©áµ›â‰¡â†’âŠ©â‰¡ {Î“} {l} {A} {B} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                            â‡”âŸ¨ âŠ©áµ›â‰¡â‡” âŸ©â†’

    (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (Î“ âŠ©áµ›âŸ¨ l âŸ© B) Ã—
    (âˆ€ {m} {Î” : Con Term m} {Ïƒ} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])  â†’âŸ¨ (Î» (âŠ©A , _ , Aâ‰¡B) â†’ Aâ‰¡B $ âŠ©Ë¢âˆ·-idSubst $ wf-âŠ©áµ› âŠ©A) âŸ©

    Î“ âŠ©âŸ¨ l âŸ© A [ idSubst ] â‰¡ B [ idSubst ]     â‰¡âŸ¨ PE.congâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (subst-id _) (subst-id _) âŸ©â†’

    Î“ âŠ©âŸ¨ l âŸ© A â‰¡ B                             â–¡

opaque

  -- If A is valid, then A is reducible.

  âŠ©áµ›â†’âŠ© : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ âŠ©âŸ¨ l âŸ© A
  âŠ©áµ›â†’âŠ© = âŠ©â‡”âŠ©â‰¡ .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‰¡â†’âŠ©â‰¡ âˆ˜â†’ âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚

opaque

  -- If there is a valid equality between t andÂ u, then there is a
  -- reducible equality between t andÂ u.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· {Î“} {l} {t} {u} {A} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                                     â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡” âŸ©â†’

    (Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A) Ã—
    (Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A) Ã—
    (âˆ€ {m} {Î” : Con Term m} {Ïƒ} â†’
     Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’ Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])     â†’âŸ¨ (Î» (âŠ©t , _ , tâ‰¡u) â†’ tâ‰¡u $ âŠ©Ë¢âˆ·-idSubst $ wf-âŠ©áµ› $ wf-âŠ©áµ›âˆ· âŠ©t) âŸ©

    Î“ âŠ©âŸ¨ l âŸ© t [ idSubst ] â‰¡ u [ idSubst ] âˆ· A [ idSubst ]  â‰¡âŸ¨ PE.congâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
                                                                 (subst-id _) (subst-id _) (subst-id _) âŸ©â†’

    Î“ âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A                                      â–¡

opaque

  -- If t is valid, then t is reducible.

  âŠ©áµ›âˆ·â†’âŠ©âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ©âŸ¨ l âŸ© t âˆ· A
  âŠ©áµ›âˆ·â†’âŠ©âˆ· = âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- Escape lemmas

opaque

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  escape-âŠ©áµ› : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ âŠ¢ A
  escape-âŠ©áµ› = escape-âŠ© âˆ˜â†’ âŠ©áµ›â†’âŠ©

opaque

  -- An escape lemma for âŠ©áµ›_.

  escape-âŠ©áµ›â€² : âŠ©áµ› Î“ â†’ âŠ¢ Î“
  escape-âŠ©áµ›â€² {Î“ = Îµ}     = Î» _ â†’ Îµ
  escape-âŠ©áµ›â€² {Î“ = _ âˆ™ _} = âŠ¢â†’âŠ¢âˆ™ âˆ˜â†’ escape-âŠ©áµ› âˆ˜â†’ projâ‚‚ âˆ˜â†’ âŠ©áµ›âˆ™â‡” .projâ‚

opaque

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  escape-âŠ©áµ›â‰¡ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ¢ A â‰… B
  escape-âŠ©áµ›â‰¡ = escape-âŠ©â‰¡ âˆ˜â†’ âŠ©áµ›â‰¡â†’âŠ©â‰¡

opaque

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  escape-âŠ©áµ›âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ¢ t âˆ· A
  escape-âŠ©áµ›âˆ· = escape-âŠ©âˆ· âˆ˜â†’ âŠ©áµ›âˆ·â†’âŠ©âˆ·

opaque

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  escape-âŠ©áµ›â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ¢ t â‰… u âˆ· A
  escape-âŠ©áµ›â‰¡âˆ· = escape-âŠ©â‰¡âˆ· âˆ˜â†’ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·

opaque

  -- An escape lemma for _âŠ©Ë¢_âˆ·_.

  escape-âŠ©Ë¢âˆ· : Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’ âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒ âˆ· Î“
  escape-âŠ©Ë¢âˆ· {Î”} {Ïƒ} {Î“ = Îµ} =
    Î” âŠ©Ë¢ Ïƒ âˆ· Îµ        â‡”âŸ¨ âŠ©Ë¢âˆ·Îµâ‡” âŸ©â†’
    âŠ¢ Î”               â†’âŸ¨ _, id âŸ©
    âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒ âˆ· Îµ  â–¡
  escape-âŠ©Ë¢âˆ· {Î”} {Ïƒ} {Î“ = Î“ âˆ™ A} =
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ âˆ™ A                                              â‡”âŸ¨ âŠ©Ë¢âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’ (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒ âˆ· Î“                                             â†’âŸ¨ (Î» ((_ , _ , âŠ©Ïƒâ‚€) , âŠ©Ïƒâ‚Š) â†’
                                                                      escape-âŠ©âˆ· âŠ©Ïƒâ‚€ , escape-âŠ©Ë¢âˆ· âŠ©Ïƒâ‚Š) âŸ©

    Î” âŠ¢ head Ïƒ âˆ· A [ tail Ïƒ ] Ã— âŠ¢ Î” Ã— Î” âŠ¢Ë¢ tail Ïƒ âˆ· Î“           â†’âŸ¨ (Î» (âŠ¢Ïƒâ‚€ , âŠ¢Î” , âŠ¢Ïƒâ‚Š) â†’ âŠ¢Î” , (âŠ¢Ïƒâ‚Š , âŠ¢Ïƒâ‚€)) âŸ©

    âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒ âˆ· Î“ âˆ™ A                                        â–¡

opaque

  -- An escape lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  escape-âŠ©Ë¢â‰¡âˆ· : Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’ âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“
  escape-âŠ©Ë¢â‰¡âˆ· {Î”} {Ïƒâ‚} {Ïƒâ‚‚} {Î“ = Îµ} =
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ        â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·Îµâ‡” âŸ©â†’
    âŠ¢ Î”                     â†’âŸ¨ _, id âŸ©
    âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ  â–¡
  escape-âŠ©Ë¢â‰¡âˆ· {Î”} {Ïƒâ‚} {Ïƒâ‚‚} {Î“ = Î“ âˆ™ A} =
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A                                            â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’
     (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã— Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                      â†’âŸ¨ (Î» ((_ , _ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                          â‰…â‚œ-eq (escape-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , escape-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
    Î” âŠ¢ head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ] Ã—
    âŠ¢ Î” Ã— Î” âŠ¢Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“                                â†’âŸ¨ (Î» (Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ , âŠ¢Î” , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’ âŠ¢Î” , (Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)) âŸ©

    âŠ¢ Î” Ã— Î” âŠ¢Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A                                      â–¡

------------------------------------------------------------------------
-- Embedding

opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_.

  emb-âŠ©áµ› :
    l â‰¤ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A
  emb-âŠ©áµ› lâ‰¤lâ€² âŠ©A =
    case âŠ©áµ›â‡” .projâ‚ âŠ©A of Î»
      (âŠ©Î“ , Aâ‰¡A) â†’
    âŠ©áµ›â‡” .projâ‚‚ (âŠ©Î“ , emb-âŠ©â‰¡ lâ‰¤lâ€² âˆ˜â†’ Aâ‰¡A)

opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  emb-âŠ©áµ›âˆ· :
    l â‰¤ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A
  emb-âŠ©áµ›âˆ· lâ‰¤lâ€² âŠ©t =
    level-âŠ©áµ›âˆ· (emb-âŠ©áµ› lâ‰¤lâ€² (wf-âŠ©áµ›âˆ· âŠ©t)) âŠ©t

------------------------------------------------------------------------
-- Weakening

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wk-âŠ©áµ› : Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î” â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î” âŠ©áµ›âŸ¨ l âŸ© wk Ï A
  wk-âŠ©áµ› {Ï} {A} ÏâŠ‡ âŠ©Î” âŠ©A =
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©Î”
      , Î» {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          wk Ï A [ Ïƒâ‚ ]  â‰¡âŸ¨ subst-wk A âŸ©âŠ©â‰¡
          A [ Ïƒâ‚ â‚›â€¢ Ï ]  â‰¡âŸ¨ âŠ©áµ›â‰¡â‡”â€² .projâ‚ (refl-âŠ©áµ›â‰¡ âŠ©A) .projâ‚‚ .projâ‚‚ $
                            âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› âŠ©A) Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆâ‰¡
          A [ Ïƒâ‚‚ â‚›â€¢ Ï ]  â‰¡Ë˜âŸ¨ subst-wk A âŸ©
          wk Ï A [ Ïƒâ‚‚ ]  âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_.

  wk1-âŠ©áµ› : Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 A
  wk1-âŠ©áµ› âŠ©B =
    wk-âŠ©áµ› (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wk-âŠ©áµ›âˆ· :
    Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î” â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î” âŠ©áµ›âŸ¨ l âŸ© wk Ï t âˆ· wk Ï A
  wk-âŠ©áµ›âˆ· {Ï} {t} {A} ÏâŠ‡ âŠ©Î” âŠ©t =
    case wf-âŠ©áµ›âˆ· âŠ©t of Î»
      âŠ©A â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( wk-âŠ©áµ› ÏâŠ‡ âŠ©Î” âŠ©A
      , Î» {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          wk Ï t [ Ïƒâ‚ ] âˆ· wk Ï A [ Ïƒâ‚ ]  â‰¡âŸ¨ subst-wk t âŸ©âŠ©âˆ·âˆ·â‰¡
                                          âŸ¨ subst-wk A âŸ©âŠ©âˆ·â‰¡
          t [ Ïƒâ‚ â‚›â€¢ Ï ] âˆ· A [ Ïƒâ‚ â‚›â€¢ Ï ]  â‰¡âŸ¨ âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) .projâ‚‚ .projâ‚‚ $
                                            âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› âŠ©A) Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆâˆ·â‰¡
          t [ Ïƒâ‚‚ â‚›â€¢ Ï ]                  â‰¡Ë˜âŸ¨ subst-wk t âŸ©
          wk Ï t [ Ïƒâ‚‚ ]                  âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wk1-âŠ©áµ›âˆ· : Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 t âˆ· wk1 A
  wk1-âŠ©áµ›âˆ· âŠ©B =
    wk-âŠ©áµ›âˆ· (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wk-âŠ©áµ›â‰¡ :
    Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î” â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î” âŠ©áµ›âŸ¨ l âŸ© wk Ï A â‰¡ wk Ï B
  wk-âŠ©áµ›â‰¡ {Ï} {A} {B} ÏâŠ‡ âŠ©Î” Aâ‰¡B =
    case wf-âŠ©áµ›â‰¡ Aâ‰¡B of Î»
      (âŠ©A , âŠ©B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( wk-âŠ©áµ› ÏâŠ‡ âŠ©Î” âŠ©A
      , wk-âŠ©áµ› ÏâŠ‡ âŠ©Î” âŠ©B
      , Î» {_ _} {Ïƒ = Ïƒ} âŠ©Ïƒ â†’
          wk Ï A [ Ïƒ ]  â‰¡âŸ¨ subst-wk A âŸ©âŠ©â‰¡
          A [ Ïƒ â‚›â€¢ Ï ]  â‰¡âŸ¨ âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B .projâ‚‚ .projâ‚‚ $
                           âŠ©Ë¢âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› âŠ©A) âŠ©Ïƒ âŸ©âŠ©âˆâ‰¡
          B [ Ïƒ â‚›â€¢ Ï ]  â‰¡Ë˜âŸ¨ subst-wk B âŸ©
          wk Ï B [ Ïƒ ]  âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wk1-âŠ©áµ›â‰¡ : Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© C â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âˆ™ C âŠ©áµ›âŸ¨ l âŸ© wk1 A â‰¡ wk1 B
  wk1-âŠ©áµ›â‰¡ âŠ©C =
    wk-âŠ©áµ›â‰¡ (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©C)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wk-âŠ©áµ›â‰¡âˆ· :
    Ï âˆ· Î” âŠ‡ Î“ â†’ âŠ©áµ› Î” â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î” âŠ©áµ›âŸ¨ l âŸ© wk Ï t â‰¡ wk Ï u âˆ· wk Ï A
  wk-âŠ©áµ›â‰¡âˆ· {Ï} {t} {u} {A} ÏâŠ‡ âŠ©Î” tâ‰¡u =
    case wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u of Î»
      (âŠ©t , âŠ©u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( wk-âŠ©áµ›âˆ· ÏâŠ‡ âŠ©Î” âŠ©t
      , wk-âŠ©áµ›âˆ· ÏâŠ‡ âŠ©Î” âŠ©u
      , Î» {_ _} {Ïƒ = Ïƒ} âŠ©Ïƒ â†’
          wk Ï t [ Ïƒ ] âˆ· wk Ï A [ Ïƒ ]  â‰¡âŸ¨ subst-wk t âŸ©âŠ©âˆ·âˆ·â‰¡
                                        âŸ¨ subst-wk A âŸ©âŠ©âˆ·â‰¡
          t [ Ïƒ â‚›â€¢ Ï ] âˆ· A [ Ïƒ â‚›â€¢ Ï ]  â‰¡âŸ¨ âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u .projâ‚‚ .projâ‚‚ $
                                          âŠ©Ë¢âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› $ wf-âŠ©áµ›âˆ· âŠ©t) âŠ©Ïƒ âŸ©âŠ©âˆ·âˆâˆ·â‰¡
          u [ Ïƒ â‚›â€¢ Ï ]                 â‰¡Ë˜âŸ¨ subst-wk u âŸ©
          wk Ï u [ Ïƒ ]                 âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wk1-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 t â‰¡ wk1 u âˆ· wk1 A
  wk1-âŠ©áµ›â‰¡âˆ· âŠ©B =
    wk-âŠ©áµ›â‰¡âˆ· (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

------------------------------------------------------------------------
-- Substitution lemmas

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B [ t ]â‚€
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ {B} âŠ©B âŠ©t =
    case âŠ©áµ›â‡” .projâ‚ âŠ©B of Î»
      (âŠ©Î“âˆ™A , Bâ‰¡B) â†’
    case âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î“âˆ™A of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substConsId B) (substConsId B) $
          Bâ‰¡B $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , âŠ©A)
            , (_ , âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
            , Ïƒâ‚â‰¡Ïƒâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B [ t ]â‚€ â‰¡ C [ u ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ {B} {C} {t} {u} Bâ‰¡C tâ‰¡u =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Bâ‰¡C of Î»
      (âŠ©B , âŠ©C , Bâ‰¡C) â†’
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©t , âŠ©u , tâ‰¡u) â†’
    case wf-âŠ©áµ›âˆ· âŠ©t of Î»
      âŠ©A â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ âŠ©B âŠ©t
      , âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ âŠ©C âŠ©u
      , Î» {_ _} {Ïƒ = Ïƒ} âŠ©Ïƒ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substConsId B) (substConsId C)
            (B [ consSubst Ïƒ (t [ Ïƒ ]) ]  â‰¡âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©B .projâ‚‚ $
                                             âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚ ((_ , âŠ©A , tâ‰¡u âŠ©Ïƒ) , refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ) âŸ©âŠ©
             B [ consSubst Ïƒ (u [ Ïƒ ]) ]  â‰¡âŸ¨ Bâ‰¡C $
                                             âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚ ((_ , âŠ©A , âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©u âŠ©Ïƒ) , âŠ©Ïƒ) âŸ©âŠ©âˆ
             C [ consSubst Ïƒ (u [ Ïƒ ]) ]  âˆ)
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t [ u ]â‚€ âˆ· B [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€âˆ· {t} {B} âŠ©t âŠ©u =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t of Î»
      (âŠ©B , tâ‰¡t) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ âŠ©B âŠ©u
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
            (substConsId t) (substConsId t) (substConsId B) $
          tâ‰¡t $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› âŠ©B
            , (_ , âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
            , Ïƒâ‚â‰¡Ïƒâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© u âˆ· B [ t ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© C [ t , u ]â‚â‚€
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ {B} {C} âŠ©C âŠ©t âŠ©u =
    case âŠ©áµ›â‡” .projâ‚ âŠ©C of Î»
      (âŠ©Î“âˆ™Aâˆ™B , Câ‰¡C) â†’
    case âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î“âˆ™Aâˆ™B of Î»
      (_ , âŠ©B) â†’
    case wf-âˆ™-âŠ©áµ› âŠ©B of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
            (PE.sym $ [,]-[]-fusion C) (PE.sym $ [,]-[]-fusion C) $
          Câ‰¡C $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , âŠ©B)
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (PE.sym $ substConsId B)
                  (âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚))
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                ( (_ , âŠ©A)
                , (_ , âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
                , Ïƒâ‚â‰¡Ïƒâ‚‚
                )
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€ :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· B [ tâ‚ ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© Câ‚ [ tâ‚ , uâ‚ ]â‚â‚€ â‰¡ Câ‚‚ [ tâ‚‚ , uâ‚‚ ]â‚â‚€
  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€
    {B} {Câ‚} {Câ‚‚} {tâ‚} {tâ‚‚} {uâ‚} {uâ‚‚} Câ‚â‰¡Câ‚‚ tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Câ‚â‰¡Câ‚‚ of Î»
      (âŠ©Câ‚ , âŠ©Câ‚‚ , Câ‚â‰¡Câ‚‚) â†’
    case wf-âˆ™-âŠ©áµ› âŠ©Câ‚ of Î»
      (_ , âŠ©B) â†’
    case wf-âˆ™-âŠ©áµ› âŠ©B of Î»
      (_ , âŠ©A) â†’
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ uâ‚â‰¡uâ‚‚ of Î»
      (âŠ©uâ‚ , âŠ©uâ‚‚ , uâ‚â‰¡uâ‚‚) â†’
    case conv-âŠ©áµ›âˆ· (âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) tâ‚â‰¡tâ‚‚) âŠ©uâ‚‚ of Î»
      âŠ©uâ‚‚ â†’
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‚â‰¡tâ‚‚ of Î»
      (âŠ©tâ‚ , âŠ©tâ‚‚ , tâ‚â‰¡tâ‚‚) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ âŠ©Câ‚ âŠ©tâ‚ âŠ©uâ‚
      , âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ âŠ©Câ‚‚ âŠ©tâ‚‚ âŠ©uâ‚‚
      , Î» {_ _} {Ïƒ = Ïƒ} âŠ©Ïƒ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
            (PE.sym $ [,]-[]-fusion Câ‚) (PE.sym $ [,]-[]-fusion Câ‚‚)
            (Câ‚ [ consSubst (consSubst Ïƒ (tâ‚ [ Ïƒ ])) (uâ‚ [ Ïƒ ]) ]  â‰¡âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©Câ‚ .projâ‚‚ $
                                                                      âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                                                                        ( (_ , âŠ©B)
                                                                        , ( _
                                                                          , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (PE.sym $ substConsId B)
                                                                              (uâ‚â‰¡uâ‚‚ âŠ©Ïƒ)
                                                                          )
                                                                        , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚ ((_ , âŠ©A) , (_ , tâ‚â‰¡tâ‚‚ âŠ©Ïƒ) , refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
                                                                        ) âŸ©âŠ©
             Câ‚ [ consSubst (consSubst Ïƒ (tâ‚‚ [ Ïƒ ])) (uâ‚‚ [ Ïƒ ]) ]  â‰¡âŸ¨ Câ‚â‰¡Câ‚‚ $
                                                                      âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚
                                                                        ( ( _ , âŠ©B
                                                                          , PE.subst (_âŠ©âŸ¨_âŸ©_âˆ·_ _ _ _) (PE.sym $ substConsId B)
                                                                              (âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©uâ‚‚ âŠ©Ïƒ)
                                                                          )
                                                                        , âŠ©Ë¢âˆ·âˆ™â‡”â€² .projâ‚‚ ((_ , âŠ©A) , (_ , âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©tâ‚‚ âŠ©Ïƒ) , âŠ©Ïƒ)
                                                                        ) âŸ©âŠ©âˆ
             Câ‚‚ [ consSubst (consSubst Ïƒ (tâ‚‚ [ Ïƒ ])) (uâ‚‚ [ Ïƒ ]) ]  âˆ)
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© v âˆ· B [ u ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t [ u , v ]â‚â‚€ âˆ· C [ u , v ]â‚â‚€
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· {B} {t} {C} âŠ©t âŠ©u âŠ©v =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· âŠ©t) of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ (wf-âŠ©áµ›âˆ· âŠ©t) âŠ©u âŠ©v
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ [,]-[]-fusion t)
            (PE.sym $ [,]-[]-fusion t) (PE.sym $ [,]-[]-fusion C) $
          âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , âŠ©B)
            , ( _
              , (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _)
                   (PE.sym $ substConsId B) $
                 âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©v .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                ( wf-âˆ™-âŠ©áµ› âŠ©B
                , (_ , âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
                , Ïƒâ‚â‰¡Ïƒâ‚‚
                )
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© vâ‚ â‰¡ vâ‚‚ âˆ· B [ uâ‚ ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© tâ‚ [ uâ‚ , vâ‚ ]â‚â‚€ â‰¡ tâ‚‚ [ uâ‚‚ , vâ‚‚ ]â‚â‚€ âˆ· C [ uâ‚ , vâ‚ ]â‚â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€âˆ· {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ vâ‚â‰¡vâ‚‚ =
    case wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ of Î»
      (âŠ©tâ‚ , âŠ©tâ‚‚) â†’
    case wf-âŠ©áµ›âˆ· âŠ©tâ‚ of Î»
      âŠ©C â†’
    case wf-âˆ™-âŠ©áµ› âŠ©C of Î»
      (_ , âŠ©B) â†’
    case wf-âŠ©áµ›â‰¡âˆ· uâ‚â‰¡uâ‚‚ of Î»
      (âŠ©uâ‚ , âŠ©uâ‚‚) â†’
    case wf-âŠ©áµ›â‰¡âˆ· vâ‚â‰¡vâ‚‚ of Î»
      (âŠ©vâ‚ , âŠ©vâ‚‚) â†’
    case conv-âŠ©áµ›âˆ· (âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) uâ‚â‰¡uâ‚‚) âŠ©vâ‚‚ of Î»
      âŠ©vâ‚‚ â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· âŠ©tâ‚ âŠ©uâ‚ âŠ©vâ‚
      , conv-âŠ©áµ›âˆ·
          (sym-âŠ©áµ›â‰¡ $
           âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€ (refl-âŠ©áµ›â‰¡ âŠ©C) uâ‚â‰¡uâ‚‚ vâ‚â‰¡vâ‚‚)
          (âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· âŠ©tâ‚‚ âŠ©uâ‚‚ âŠ©vâ‚‚)
      , Î» âŠ©Ïƒ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ [,]-[]-fusion tâ‚)
            (PE.sym $ [,]-[]-fusion tâ‚‚) (PE.sym $ [,]-[]-fusion C) $
          âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‚â‰¡tâ‚‚ .projâ‚‚ .projâ‚‚ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , âŠ©B)
            , ( _
              , (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _)
                   (PE.sym $ substConsId B) $
                 âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ vâ‚â‰¡vâ‚‚ .projâ‚‚ .projâ‚‚ âŠ©Ïƒ)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                ( wf-âˆ™-âŠ©áµ› âŠ©B
                , (_ , âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ uâ‚â‰¡uâ‚‚ .projâ‚‚ .projâ‚‚ âŠ©Ïƒ)
                , refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ
                )
            )

      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© D â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· wk2 A â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ l âŸ© D [ t ]â†‘Â²
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² {A} {D} âŠ©D âŠ©t =
    âŠ©áµ›â‡” .projâ‚‚
      ( wf-âŠ©áµ› (wf-âŠ©áµ›âˆ· âŠ©t)
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substCompâ†‘Â² D _) (substCompâ†‘Â² D _) $
          âŠ©áµ›â‡” .projâ‚ âŠ©D .projâ‚‚ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› âŠ©D
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk2-tail A)
                  (âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â² :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© D â‰¡ E â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· wk2 A â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ l âŸ© D [ t ]â†‘Â² â‰¡ E [ t ]â†‘Â²
  âŠ©áµ›â‰¡â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â² {A} {D} {E} Dâ‰¡E âŠ©t =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Dâ‰¡E of Î»
      (âŠ©D , âŠ©E , Dâ‰¡E) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² âŠ©D âŠ©t
      , âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² âŠ©E âŠ©t
      , Î» âŠ©Ïƒ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substCompâ†‘Â² D _) (substCompâ†‘Â² E _) $
          Dâ‰¡E $
          âŠ©Ë¢âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› âŠ©D
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_âˆ·_ _ _ _) (wk2-tail A)
                  (âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©t âŠ©Ïƒ)
              )
            , âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ âŠ©Ïƒ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· D â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· wk2 A â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ l âŸ© t [ u ]â†‘Â² âˆ· D [ u ]â†‘Â²
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· {A} {t} {D} âŠ©t âŠ©u =
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² (wf-âŠ©áµ›âˆ· âŠ©t) âŠ©u
      , Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (substCompâ†‘Â² t _) (substCompâ†‘Â² t _)
            (substCompâ†‘Â² D _) $
          âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· âŠ©t)
            , ( _
              , (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk2-tail A) $
                 âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ (refl-âŠ©áµ›â‰¡âˆ· âŠ©u) .projâ‚‚ .projâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â²âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· D â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© v âˆ· wk2 A â†’
    Î“ âˆ™ B âˆ™ C âŠ©áµ›âŸ¨ l âŸ© t [ v ]â†‘Â² â‰¡ u [ v ]â†‘Â² âˆ· D [ v ]â†‘Â²
  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â²âˆ· {A} {t} {u} {D} tâ‰¡u âŠ©v =
    case wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u of Î»
      (âŠ©t , âŠ©u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· âŠ©t âŠ©v
      , âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· âŠ©u âŠ©v
      , Î» âŠ©Ïƒ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (substCompâ†‘Â² t _) (substCompâ†‘Â² u _)
            (substCompâ†‘Â² D _) $
          âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u .projâ‚‚ .projâ‚‚ $
          âŠ©Ë¢âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· âŠ©t)
            , ( _
              , (PE.subst (_âŠ©âŸ¨_âŸ©_âˆ·_ _ _ _) (wk2-tail A) $
                 âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©v âŠ©Ïƒ)
              )
            , âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ âŠ©Ïƒ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© B [ t ]â‚€ â‰¡ C [ u ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ Bâ‰¡C tâ‰¡u =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‰¡C .projâ‚) of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‰¡â‡”â€² .projâ‚ Bâ‰¡C .projâ‚‚ .projâ‚‚
      (âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A (level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ© âŠ©A) tâ‰¡u))

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©[]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© B [ t ]â‚€
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©[]â‚€ âŠ©B âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© v â‰¡ w âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© t [ v ]â‚€ â‰¡ u [ w ]â‚€ âˆ· B [ v ]â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· tâ‰¡u vâ‰¡w =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u .projâ‚)) of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‰¡u .projâ‚‚ .projâ‚‚
      (âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A (level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ© âŠ©A) vâ‰¡w))

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©[]â‚€âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© t [ u ]â‚€ âˆ· B [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©[]â‚€âˆ· âŠ©t âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ l âŸ© Bâ‚ [ consSubst Ïƒâ‚ tâ‚ ] â‰¡ Bâ‚‚ [ consSubst Ïƒâ‚‚ tâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ =
    âŠ©áµ›â‰¡â‡”â€² .projâ‚ Bâ‚â‰¡Bâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚ (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‚â‰¡Bâ‚‚ .projâ‚) , (_ , tâ‚â‰¡tâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ l âŸ© B [ consSubst Ïƒ t ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,] âŠ©B âŠ©Ïƒ âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ) (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ l âŸ© tâ‚ [ consSubst Ïƒâ‚ uâ‚ ] â‰¡ tâ‚‚ [ consSubst Ïƒâ‚‚ uâ‚‚ ] âˆ·
      B [ consSubst Ïƒâ‚ uâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ =
    âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‚â‰¡tâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· $ wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚) , (_ , uâ‚â‰¡uâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ l âŸ© t [ consSubst Ïƒ u ] âˆ· B [ consSubst Ïƒ u ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,]âˆ· âŠ©t âŠ©Ïƒ âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒâ‚ ] âŠ©âŸ¨ l âŸ© Bâ‚ [ Ïƒâ‚ â‡‘ ] â‰¡ Bâ‚‚ [ Ïƒâ‚‚ â‡‘ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©áµ›â‰¡â‡”â€² .projâ‚ Bâ‚â‰¡Bâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‚â‰¡Bâ‚‚ .projâ‚) .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒ ] âŠ©âŸ¨ l âŸ© B [ Ïƒ â‡‘ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘] âŠ©B âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒâ‚ ] âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ ] âˆ· B [ Ïƒâ‚ â‡‘ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‚â‰¡tâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) .projâ‚‚)
      Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒ ] âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ ] âˆ· B [ Ïƒ â‡‘ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘]âˆ· âŠ©t âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒâ‚ ] âˆ™ B [ Ïƒâ‚ â‡‘ ] âŠ©âŸ¨ l âŸ© Câ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] â‰¡ Câ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Câ‚â‰¡Câ‚‚ .projâ‚) of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›â‰¡â‡”â€² .projâ‚ Câ‚â‰¡Câ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©B $ âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› âŠ©B .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘] :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒ ] âˆ™ B [ Ïƒ â‡‘ ] âŠ©âŸ¨ l âŸ© C [ Ïƒ â‡‘ â‡‘ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘] âŠ©C âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] (refl-âŠ©áµ›â‰¡ âŠ©C) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒâ‚ ] âˆ™ B [ Ïƒâ‚ â‡‘ ] âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] âˆ·
      C [ Ïƒâ‚ â‡‘ â‡‘ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‚â‰¡tâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©B $ âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› âŠ©B .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘]âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âˆ™ A [ Ïƒ ] âˆ™ B [ Ïƒ â‡‘ ] âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ â‡‘ ] âˆ· C [ Ïƒ â‡‘ â‡‘ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘]âˆ· âŠ©t âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ l âŸ© Bâ‚ [ Ïƒâ‚ â‡‘ ] [ tâ‚ ]â‚€ â‰¡ Bâ‚‚ [ Ïƒâ‚‚ â‡‘ ] [ tâ‚‚ ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ {Bâ‚} {Bâ‚‚} Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ singleSubstComp _ _ Bâ‚)
      (PE.sym $ singleSubstComp _ _ Bâ‚‚) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€ :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ l âŸ© B [ Ïƒ â‡‘ ] [ t ]â‚€
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€ âŠ©B âŠ©Ïƒ âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€ â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ ] [ uâ‚‚ ]â‚€ âˆ·
      B [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· {tâ‚} {tâ‚‚} {B} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
      (PE.sym $ singleSubstComp _ _ tâ‚)
      (PE.sym $ singleSubstComp _ _ tâ‚‚)
      (PE.sym $ singleSubstComp _ _ B) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ ] [ u ]â‚€ âˆ· B [ Ïƒ â‡‘ ] [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€âˆ· âŠ©t âŠ©Ïƒ âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© tâ‚ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© Bâ‚ [ tâ‚ ]â‚€ [ Ïƒâ‚ ] â‰¡ Bâ‚‚ [ tâ‚‚ ]â‚€ [ Ïƒâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] {Bâ‚} {Bâ‚‚} Bâ‚â‰¡Bâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ singleSubstLift Bâ‚ _)
      (PE.sym $ singleSubstLift Bâ‚‚ _) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚]

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[] :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© B [ t ]â‚€ [ Ïƒ ]
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[] {t} âŠ©B âŠ©t[Ïƒ] âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] {tâ‚‚ = t} (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©â‰¡âˆ· âŠ©t[Ïƒ])
      (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© tâ‚ [ uâ‚ ]â‚€ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ uâ‚‚ ]â‚€ [ Ïƒâ‚‚ ] âˆ· B [ uâ‚ ]â‚€ [ Ïƒâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· {tâ‚} {tâ‚‚} {B} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ singleSubstLift tâ‚ _)
      (PE.sym $ singleSubstLift tâ‚‚ _) (PE.sym $ singleSubstLift B _) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· tâ‚â‰¡tâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[]âˆ· :
    Î“ âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© u [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© t [ u ]â‚€ [ Ïƒ ] âˆ· B [ u ]â‚€ [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[]âˆ· {u} âŠ©t âŠ©u[Ïƒ] âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· {uâ‚‚ = u} (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ])
      (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· B [ Ïƒâ‚ â‡‘ ] [ tâ‚ ]â‚€ â†’
    Î” âŠ©âŸ¨ l âŸ© Câ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] [ tâ‚ , uâ‚ ]â‚â‚€ â‰¡ Câ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] [ tâ‚‚ , uâ‚‚ ]â‚â‚€
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€
    {B} {Câ‚} {Câ‚‚} Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ doubleSubstComp Câ‚ _ _ _)
      (PE.sym $ doubleSubstComp Câ‚‚ _ _ _) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Câ‚â‰¡Câ‚‚
      (âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
         ( wf-âˆ™-âŠ©áµ› (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Câ‚â‰¡Câ‚‚ .projâ‚) .projâ‚‚)
         , (_ , tâ‚â‰¡tâ‚‚)
         , Ïƒâ‚â‰¡Ïƒâ‚‚
         )) $
    PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstComp _ _ B) uâ‚â‰¡uâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€ :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© u âˆ· B [ Ïƒ â‡‘ ] [ t ]â‚€ â†’
    Î” âŠ©âŸ¨ l âŸ© C [ Ïƒ â‡‘ â‡‘ ] [ t , u ]â‚â‚€
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€ âŠ©C âŠ©Ïƒ âŠ©t âŠ©u =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ (refl-âŠ©áµ›â‰¡ âŠ©C) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© vâ‚ â‰¡ vâ‚‚ âˆ· B [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€ â†’
    Î” âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] [ uâ‚ , vâ‚ ]â‚â‚€ â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] [ uâ‚‚ , vâ‚‚ ]â‚â‚€ âˆ·
      C [ Ïƒâ‚ â‡‘ â‡‘ ] [ uâ‚ , vâ‚ ]â‚â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ·
    {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ vâ‚â‰¡vâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) of Î»
      (_ , âŠ©B) â†’
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
      (PE.sym $ doubleSubstComp tâ‚ _ _ _)
      (PE.sym $ doubleSubstComp tâ‚‚ _ _ _)
      (PE.sym $ doubleSubstComp C _ _ _) $
    âŠ©áµ›â‰¡âˆ·â‡”â€² .projâ‚ tâ‚â‰¡tâ‚‚ .projâ‚‚ .projâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©B)
      , ( _
        , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstComp _ _ B) vâ‚â‰¡vâ‚‚
        )
      , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚ (wf-âˆ™-âŠ©áµ› âŠ©B , (_ , uâ‚â‰¡uâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© v âˆ· B [ Ïƒ â‡‘ ] [ u ]â‚€ â†’
    Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ â‡‘ ] [ u , v ]â‚â‚€ âˆ· C [ Ïƒ â‡‘ â‡‘ ] [ u , v ]â‚â‚€
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€âˆ· âŠ©t âŠ©Ïƒ âŠ©u âŠ©v =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©u) (refl-âŠ©â‰¡âˆ· âŠ©v)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[] :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© tâ‚ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· B [ tâ‚ ]â‚€ [ Ïƒâ‚ ] â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© Câ‚ [ tâ‚ , uâ‚ ]â‚â‚€ [ Ïƒâ‚ ] â‰¡ Câ‚‚ [ tâ‚‚ , uâ‚‚ ]â‚â‚€ [ Ïƒâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]
    {B} {Câ‚} {Câ‚‚} Câ‚â‰¡Câ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚] uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ [,]-[]-commute Câ‚)
      (PE.sym $ [,]-[]-commute Câ‚‚) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚]
      (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstLift B _)
         uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚])

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[] :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© u [ Ïƒ ] âˆ· B [ t ]â‚€ [ Ïƒ ] â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© C [ t , u ]â‚â‚€ [ Ïƒ ]
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[] {t} {u} âŠ©C âŠ©t[Ïƒ] âŠ©u[Ïƒ] âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[] {tâ‚‚ = t} {uâ‚‚ = u} (refl-âŠ©áµ›â‰¡ âŠ©C)
      (refl-âŠ©â‰¡âˆ· âŠ©t[Ïƒ]) (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ]) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© vâ‚ [ Ïƒâ‚ ] â‰¡ vâ‚‚ [ Ïƒâ‚‚ ] âˆ· B [ uâ‚ ]â‚€ [ Ïƒâ‚ ] â†’
    Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© tâ‚ [ uâ‚ , vâ‚ ]â‚â‚€ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ uâ‚‚ , vâ‚‚ ]â‚â‚€ [ Ïƒâ‚‚ ] âˆ·
      C [ uâ‚ , vâ‚ ]â‚â‚€ [ Ïƒâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ·
    {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] vâ‚[Ïƒâ‚]â‰¡vâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ [,]-[]-commute tâ‚)
      (PE.sym $ [,]-[]-commute tâ‚‚) (PE.sym $ [,]-[]-commute C) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚]
      (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstLift B _)
         vâ‚[Ïƒâ‚]â‰¡vâ‚‚[Ïƒâ‚‚])

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[]âˆ· :
    Î“ âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î” âŠ©âŸ¨ lâ€² âŸ© u [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    Î” âŠ©âŸ¨ lâ€³ âŸ© v [ Ïƒ ] âˆ· B [ u ]â‚€ [ Ïƒ ] â†’
    Î” âŠ©Ë¢ Ïƒ âˆ· Î“ â†’
    Î” âŠ©âŸ¨ l âŸ© t [ u , v ]â‚â‚€ [ Ïƒ ] âˆ· C [ u , v ]â‚â‚€ [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[]âˆ· {u} {v} âŠ©t âŠ©u[Ïƒ] âŠ©v[Ïƒ] âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ· {uâ‚‚ = u} {vâ‚‚ = v} (refl-âŠ©áµ›â‰¡âˆ· âŠ©t)
      (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ]) (refl-âŠ©â‰¡âˆ· âŠ©v[Ïƒ]) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
