------------------------------------------------------------------------
-- The logical relation for validity
------------------------------------------------------------------------

open import Definition.Typed.EqualityRelation
open import Definition.Typed.Restrictions
open import Graded.Modality

module Definition.LogicalRelation.Substitution
  {a} {M : Set a}
  {ğ•„ : Modality M}
  (R : Type-restrictions ğ•„)
  â¦ƒ eqrel : EqRelSet R â¦„
  where

open EqRelSet eqrel
open Type-restrictions R

import Definition.LogicalRelation.Hidden R as H
open import Definition.LogicalRelation.Hidden.Restricted R

open import Definition.Typed R
open import Definition.Typed.Properties R
open import Definition.Typed.Substitution R
open import Definition.Typed.Weakening R as TW using (_âˆ·_âŠ‡_; _Â»_âˆ·Ê·_âŠ‡_)
open import Definition.Typed.Weakening.Definition R

open import Definition.Untyped M
open import Definition.Untyped.Neutral M type-variant
open import Definition.Untyped.Properties M

open import Tools.Fin
open import Tools.Function
open import Tools.Level
open import Tools.Nat using (Nat)
open import Tools.Product as Î£
import Tools.PropositionalEquality as PE
open import Tools.Reasoning.PropositionalEquality

private variable
  m n Îº                                                 : Nat
  âˆ‡ âˆ‡â€² âˆ‡â€³                                               : DCon (Term 0) _
  Î” Î— Î¦                                                 : Con Term _
  Î“                                                     : Cons _ _
  A Aâ‚ Aâ‚‚ B Bâ‚ Bâ‚‚ C Câ‚ Câ‚‚ D E t tâ‚ tâ‚‚ u uâ‚ uâ‚‚ v vâ‚ vâ‚‚ w : Term _
  Ïƒ Ïƒâ‚ Ïƒâ‚‚ Ïƒâ‚ƒ                                            : Subst _ _
  Ï                                                     : Wk _ _
  l lâ€² lâ€³ lâ€´                                            : Universe-level

------------------------------------------------------------------------
-- The type formers

opaque mutual

  -- Valid contexts.

  infix 4 _Â»âŠ©áµ›_

  _Â»âŠ©áµ›_ : DCon (Term 0) Îº â†’ Con Term n â†’ Set a
  âˆ‡ Â»âŠ©áµ› Îµ       = Â» âˆ‡
  âˆ‡ Â»âŠ©áµ› (Î“ âˆ™ A) = âˆƒ Î» l â†’ âˆ‡ Â» Î“ âŠ©áµ›âŸ¨ l âŸ© A

  -- Valid types.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_

  _âŠ©áµ›âŸ¨_âŸ©_ : Cons Îº n â†’ Universe-level â†’ Term n â†’ Set a
  Î“ âŠ©áµ›âŸ¨ l âŸ© A = Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ A

  -- Valid type equality.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ : Cons Îº n â†’ Universe-level â†’ Term n â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ {Îº} {n} (âˆ‡ Â» Î“) l A B =
    âˆ‡ Â»âŠ©áµ› Î“ Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
     âˆ‡â€² Â» Î” âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])

  -- Valid substitution equality.

  infix 4 _âŠ©Ë¢_â‰¡_âˆ·_

  _âŠ©Ë¢_â‰¡_âˆ·_ : Cons Îº m â†’ Subst m n â†’ Subst m n â†’ Con Term n â†’ Set a
  âˆ‡ Â» Î” âŠ©Ë¢ _ â‰¡ _ âˆ· Îµ =
    Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î” â¦„ â†’ âˆ‡ Â»âŠ¢ Î”)
  âˆ‡ Â» Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ âˆ™ A =
    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     âˆ‡ Â» Î” âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î” âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î“

-- Valid context pairs.

infix 4 âŠ©áµ›_

âŠ©áµ›_ : Cons m n â†’ Set a
âŠ©áµ› (âˆ‡ Â» Î“) = âˆ‡ Â»âŠ©áµ› Î“

opaque

  -- Valid substitutions.

  infix 4 _âŠ©Ë¢_âˆ·_

  _âŠ©Ë¢_âˆ·_ : Cons Îº m â†’ Subst m n â†’ Con Term n â†’ Set a
  Î” âŠ©Ë¢ Ïƒ âˆ· Î“ = Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î“

opaque

  -- Valid term equality.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ :
    Cons Îº n â†’ Universe-level â†’ Term n â†’ Term n â†’ Term n â†’ Set a
  _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ {Îº} {n} (âˆ‡ Â» Î“) l t u A =
    âˆ‡ Â» Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î”} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î“ â†’
     âˆ‡â€² Â» Î” âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])

opaque

  -- Valid terms.

  infix 4 _âŠ©áµ›âŸ¨_âŸ©_âˆ·_

  _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ : Cons Îº n â†’ Universe-level â†’ Term n â†’ Term n â†’ Set a
  Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A = Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ t âˆ· A

------------------------------------------------------------------------
-- Some characterisation lemmas

opaque
  unfolding _Â»âŠ©áµ›_

  -- A characterisation lemma for âŠ©áµ›_.

  âŠ©áµ›Îµâ‡” : âˆ‡ Â»âŠ©áµ› Îµ â‡” Â» âˆ‡
  âŠ©áµ›Îµâ‡” = idâ‡”

opaque
  unfolding _Â»âŠ©áµ›_

  -- A characterisation lemma for âŠ©áµ›_.

  âŠ©áµ›âˆ™â‡” : âŠ©áµ› Î“ Â»âˆ™ A â‡” âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  âŠ©áµ›âˆ™â‡” = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‡”âŠ©áµ›â‰¡ : (Î“ âŠ©áµ›âŸ¨ l âŸ© A) â‡” Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ A
  âŠ©áµ›â‡”âŠ©áµ›â‰¡ = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_ _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‡” :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‡”
    (âˆ‡ Â»âŠ©áµ› Î” Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‡” = idâ‡”

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‡”Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‡”
    (âˆ‡ Â»âŠ©áµ› Î” Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‡”Ê° {âˆ‡} {n} {Î”} {l} {A} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A                                                â‡”âŸ¨ âŠ©áµ›â‡” âŸ©

    âˆ‡ Â»âŠ©áµ› Î” Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ])                            â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                         Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡â‡”)) âŸ©
    âˆ‡ Â»âŠ©áµ› Î” Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ A [ Ïƒâ‚‚ ])  â–¡â‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â‡” :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â»âŠ©áµ› Î” Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‰¡â‡” = idâ‡”

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â‰¡â‡”Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â»âŠ©áµ› Î” Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
      â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‰¡â‡”Ê° {âˆ‡} {n} {Î”} {l} {A} {B} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                                            â‡”âŸ¨ âŠ©áµ›â‰¡â‡” âŸ©

    âˆ‡ Â»âŠ©áµ› Î” Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])                            â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                         implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                         Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡â‡”)) âŸ©
    âˆ‡ Â»âŠ©áµ› Î” Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])  â–¡â‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_âˆ·_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â‡” Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ t âˆ· A
  âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· = idâ‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â‡” :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›âˆ·â‡” = idâ‡”

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â‡”Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
      â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›âˆ·â‡”Ê° {âˆ‡} {n} {Î”} {l} {t} {A} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A                                                       â‡”âŸ¨ âŠ©áµ›âˆ·â‡” âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])                            â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                                    Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡âˆ·â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ t [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])  â–¡â‡”

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â‡” :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›â‰¡âˆ·â‡” = idâ‡”

opaque

  -- A characterisation lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â‡”Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›â‰¡âˆ·â‡”Ê° {âˆ‡} {n} {Î”} {l} {t} {u} {A} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                                                   â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡” âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])                            â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                                    implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                                    Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡âˆ·â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])  â–¡â‡”

opaque
  unfolding _âŠ©Ë¢_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  âŠ©Ë¢â‰¡âˆ·Îµâ‡” :
    âˆ‡ Â» Î” âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ â‡”
    (Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î” â¦„ â†’ âˆ‡ Â»âŠ¢ Î”))
  âŠ©Ë¢â‰¡âˆ·Îµâ‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_â‰¡_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  âŠ©Ë¢â‰¡âˆ·âˆ™â‡” :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A â‡”
    ((âˆƒ Î» l â†’
      (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
      âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
     âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”)
  âŠ©Ë¢â‰¡âˆ·âˆ™â‡” = idâ‡”

opaque
  unfolding _âŠ©Ë¢_âˆ·_

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· : âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â‡” âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î”
  âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· = idâ‡”

opaque

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·Îµâ‡” :
    âˆ‡ Â» Î” âŠ©Ë¢ Ïƒ âˆ· Îµ â‡”
    (Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î” â¦„ â†’ âˆ‡ Â»âŠ¢ Î”))
  âŠ©Ë¢âˆ·Îµâ‡” {âˆ‡} {Î”} {Ïƒ} =
    âˆ‡ Â» Î” âŠ©Ë¢ Ïƒ âˆ· Îµ                                      â‡”âŸ¨ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· âŸ©
    âˆ‡ Â» Î” âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Îµ                                  â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·Îµâ‡” âŸ©
    Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î” â¦„ â†’ âˆ‡ Â»âŠ¢ Î”)  â–¡â‡”

opaque

  -- A characterisation lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·âˆ™â‡” :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A â‡”
    ((âˆƒ Î» l â†’ (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”)
  âŠ©Ë¢âˆ·âˆ™â‡” {âˆ‡} {Î—} {Ïƒ} {Î”} {A} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A                                                  â‡”âŸ¨ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· âŸ©

    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î” âˆ™ A                                              â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©

    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ â‰¡ head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ â‰¡ tail Ïƒ âˆ· Î”                                        â‡”Ë˜âŸ¨ (Î£-cong-â‡” Î» _ â†’ Î£-cong-â‡” Î» _ â†’ âŠ©âˆ·â‡”âŠ©â‰¡âˆ·)
                                                                              Ã—-cong-â‡”
                                                                            âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· âŸ©
    (âˆƒ Î» l â†’ (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”                                                 â–¡â‡”

------------------------------------------------------------------------
-- An introduction lemma

opaque

  -- An introduction lemma for âŠ©áµ›_.

  âŠ©áµ›-âˆ™-intro : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ âŠ©áµ› Î“ Â»âˆ™ A
  âŠ©áµ›-âˆ™-intro âŠ©A = âŠ©áµ›âˆ™â‡” .projâ‚‚ (_ , âŠ©A)

------------------------------------------------------------------------
-- Reflexivity

opaque

  -- Reflexivity for _âŠ©Ë¢_â‰¡_âˆ·_.

  refl-âŠ©Ë¢â‰¡âˆ· :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ â‰¡ Ïƒ âˆ· Î”
  refl-âŠ©Ë¢â‰¡âˆ· = âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- Reflexivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  refl-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ A
  refl-âŠ©áµ›â‰¡ = âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚

opaque

  -- Reflexivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  refl-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ t âˆ· A
  refl-âŠ©áµ›â‰¡âˆ· = âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- Some substitution lemmas

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] Aâ‰¡B = âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B .projâ‚‚ idâŠ‡

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ idâŠ‡ âˆ˜â†’ refl-âŠ©Ë¢â‰¡âˆ·

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‰¡u = âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u .projâ‚‚ idâŠ‡

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· âŠ©t =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ idâŠ‡ âˆ˜â†’ refl-âŠ©Ë¢â‰¡âˆ·

------------------------------------------------------------------------
-- Symmetry

opaque

  -- Symmetry for _âŠ©Ë¢_â‰¡_âˆ·_.

  sym-âŠ©Ë¢â‰¡âˆ· :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚‚ â‰¡ Ïƒâ‚ âˆ· Î”
  sym-âŠ©Ë¢â‰¡âˆ· {Î” = Îµ} =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚
  sym-âŠ©Ë¢â‰¡âˆ· {Î” = _ âˆ™ _} = Î» Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((l , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    case conv-âŠ©â‰¡âˆ· (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ idâŠ‡ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) $
         sym-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ of Î»
      Ïƒâ‚‚â‚€â‰¡Ïƒâ‚â‚€ â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚ ((l , âŠ©A , Ïƒâ‚‚â‚€â‰¡Ïƒâ‚â‚€) , sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š)

opaque

  -- Symmetry for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  sym-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â‰¡ A
  sym-âŠ©áµ›â‰¡ Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©Î“ , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚ (âŠ©Î“ , Î» Î¾âŠ‡ â†’ sym-âŠ©â‰¡ âˆ˜â†’ Aâ‰¡B Î¾âŠ‡ âˆ˜â†’ sym-âŠ©Ë¢â‰¡âˆ·)

opaque

  -- Symmetry for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  sym-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© u â‰¡ t âˆ· A
  sym-âŠ©áµ›â‰¡âˆ· tâ‰¡u =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©A , tâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©A
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          conv-âŠ©â‰¡âˆ· (sym-âŠ©â‰¡ $ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚) $
          sym-âŠ©â‰¡âˆ· $ tâ‰¡u Î¾âŠ‡ $ sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚)

------------------------------------------------------------------------
-- One transitivity lemma

opaque

  -- Transitivity for _âŠ©Ë¢_â‰¡_âˆ·_.

  trans-âŠ©Ë¢â‰¡ :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚‚ â‰¡ Ïƒâ‚ƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚ƒ âˆ· Î”
  trans-âŠ©Ë¢â‰¡ {Î” = Îµ} Ïƒâ‚â‰¡Ïƒâ‚‚ _ =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ $ âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚
  trans-âŠ©Ë¢â‰¡ {Î” = _ âˆ™ _} Ïƒâ‚â‰¡Ïƒâ‚‚ Ïƒâ‚‚â‰¡Ïƒâ‚ƒ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((l , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚‚â‰¡Ïƒâ‚ƒ of Î»
      ((l , âŠ©A , Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€) , Ïƒâ‚‚â‚Šâ‰¡Ïƒâ‚ƒâ‚Š) â†’
    case conv-âŠ©â‰¡âˆ· (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ idâŠ‡ $ sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š)
           Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€ of Î»
      Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€ â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( (l , âŠ©A , trans-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ Ïƒâ‚‚â‚€â‰¡Ïƒâ‚ƒâ‚€)
      , trans-âŠ©Ë¢â‰¡ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š Ïƒâ‚‚â‚Šâ‰¡Ïƒâ‚ƒâ‚Š
      )

------------------------------------------------------------------------
-- Some well-formedness lemmas

opaque

  -- A well-formedness lemma for âŠ©áµ›_.

  wf-âŠ©áµ›-âˆ™ : âŠ©áµ› Î“ Â»âˆ™ A â†’ âˆƒ Î» l â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  wf-âŠ©áµ›-âˆ™ = âŠ©áµ›âˆ™â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wf-âŠ©áµ› : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ âŠ©áµ› Î“
  wf-âŠ©áµ› = projâ‚ âˆ˜â†’ âŠ©áµ›â‡” .projâ‚

opaque

  -- A well-formedness lemma for âŠ©áµ›_.

  wf-âŠ©áµ›â€² : âˆ‡ Â»âŠ©áµ› Î” â†’ Â» âˆ‡
  wf-âŠ©áµ›â€² {Î” = Îµ}     = âŠ©áµ›Îµâ‡” .projâ‚
  wf-âŠ©áµ›â€² {Î” = Î” âˆ™ A} = wf-âŠ©áµ›â€² âˆ˜â†’ wf-âŠ©áµ› âˆ˜â†’ projâ‚‚ âˆ˜â†’ âŠ©áµ›âˆ™â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wf-âˆ™-âŠ©áµ› :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆƒ Î» lâ€² â†’ Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A
  wf-âˆ™-âŠ©áµ› = wf-âŠ©áµ›-âˆ™ âˆ˜â†’ wf-âŠ©áµ›

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wf-âŠ©áµ›âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A
  wf-âŠ©áµ›âˆ· = projâ‚ âˆ˜â†’ âŠ©áµ›âˆ·â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_âˆ·_.

  wf-âŠ©Ë¢âˆ· : âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’ âˆ‡ Â»âŠ©áµ› Î”
  wf-âŠ©Ë¢âˆ· {Î” = Îµ}     = âŠ©áµ›Îµâ‡” .projâ‚‚ âˆ˜â†’ projâ‚ âˆ˜â†’ âŠ©Ë¢âˆ·Îµâ‡” .projâ‚
  wf-âŠ©Ë¢âˆ· {Î” = _ âˆ™ _} =
    âŠ©áµ›âˆ™â‡” .projâ‚‚ âˆ˜â†’ Î£.map idá¶  projâ‚ âˆ˜â†’ projâ‚ âˆ˜â†’ âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_âˆ·_.

  âŠ©Ë¢âˆ·â†’Â» : âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’ Â» âˆ‡
  âŠ©Ë¢âˆ·â†’Â» = wf-âŠ©áµ›â€² âˆ˜â†’ wf-âŠ©Ë¢âˆ·

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  wf-âŠ©Ë¢â‰¡âˆ· : âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ âˆ· Î” Ã— âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚‚ âˆ· Î”
  wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ =
      âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ (trans-âŠ©Ë¢â‰¡ Ïƒâ‚â‰¡Ïƒâ‚‚ (sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚))
    , âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ (trans-âŠ©Ë¢â‰¡ (sym-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚)

opaque

  -- A well-formedness lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  âŠ©Ë¢â‰¡âˆ·â†’Â» : âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ Â» âˆ‡
  âŠ©Ë¢â‰¡âˆ·â†’Â» = âŠ©Ë¢âˆ·â†’Â» âˆ˜â†’ projâ‚ âˆ˜â†’ wf-âŠ©Ë¢â‰¡âˆ·

------------------------------------------------------------------------
-- Weakening of the definition context

opaque mutual

  -- A definitional weakening lemma for âŠ©áµ›_.

  defn-wk-âŠ©áµ›â€² : Â» âˆ‡â€² âŠ‡ âˆ‡ â†’ âˆ‡ Â»âŠ©áµ› Î” â†’ âˆ‡â€² Â»âŠ©áµ› Î”
  defn-wk-âŠ©áµ›â€² {Î” = Îµ} Î¾âŠ‡ âŠ©Î” =
    âŠ©áµ›Îµâ‡” .projâ‚‚ (wf-Â»âŠ‡ Î¾âŠ‡ (âŠ©áµ›Îµâ‡” .projâ‚ âŠ©Î”))
  defn-wk-âŠ©áµ›â€² {Î” = Î” âˆ™ A} Î¾âŠ‡ âŠ©Î” =
    let (l , âŠ©A) = âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î” in
    âŠ©áµ›âˆ™â‡” .projâ‚‚ (l , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A)

  -- A definitional weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  defn-wk-âŠ©áµ› : Â» âˆ‡â€² âŠ‡ âˆ‡ â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â†’ âˆ‡â€² Â» Î” âŠ©áµ›âŸ¨ l âŸ© A
  defn-wk-âŠ©áµ› Î¾âŠ‡ = âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ âˆ˜â†’ defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ âˆ˜â†’ âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚

  -- A definitional weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  defn-wk-âŠ©áµ›â‰¡ : Â» âˆ‡â€² âŠ‡ âˆ‡ â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ âˆ‡â€² Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B
  defn-wk-âŠ©áµ›â‰¡ {A} {B} Î¾âŠ‡ Aâ‰¡B =
    let (âŠ©Î” , Aâ‰¡B) = âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B
    in  âŠ©áµ›â‰¡â‡” .projâ‚‚
          ( defn-wk-âŠ©áµ›â€² Î¾âŠ‡ âŠ©Î”
          , Î» Î¾âŠ‡â€² â†’ Aâ‰¡B (Â»âŠ‡-trans Î¾âŠ‡â€² Î¾âŠ‡)
          )

opaque

  -- A definitional weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  defn-wk-âŠ©áµ›â‰¡âˆ· :
    Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    âˆ‡â€² Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A
  defn-wk-âŠ©áµ›â‰¡âˆ· {t} {u} {A} Î¾âŠ‡ tâ‰¡u =
    let (âŠ©A , tâ‰¡u) = âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u
    in  âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
          ( defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A
          , Î» Î¾âŠ‡â€² â†’ tâ‰¡u (Â»âŠ‡-trans Î¾âŠ‡â€² Î¾âŠ‡)
          )

opaque

  -- A definitional weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  defn-wk-âŠ©áµ›âˆ· :
    Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    âˆ‡â€² Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A
  defn-wk-âŠ©áµ›âˆ· Î¾âŠ‡ = âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ âˆ˜â†’ defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

opaque

  -- A definitional weakening lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  defn-wk-âŠ©Ë¢â‰¡âˆ· :
    â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
    Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î”
  defn-wk-âŠ©Ë¢â‰¡âˆ· {Î” = Îµ} â¦ƒ inc â¦„ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ (wf-Â»âŠ‡ Î¾âŠ‡ (âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚) , defn-wkâ€² Î¾âŠ‡ (âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚ â¦ƒ inc â¦„))
  defn-wk-âŠ©Ë¢â‰¡âˆ· {Î” = Î” âˆ™ A} Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    let ((l , âŠ©A , hâ‰¡h) , tâ‰¡t) = âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚
    in  âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚ $ (l , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A , defn-wk-âŠ©â‰¡âˆ· Î¾âŠ‡ hâ‰¡h)
                      , defn-wk-âŠ©Ë¢â‰¡âˆ· Î¾âŠ‡ tâ‰¡t

opaque

  -- A definitional weakening lemma for _âŠ©Ë¢_âˆ·_.

  defn-wk-âŠ©Ë¢âˆ· : Â» âˆ‡â€² âŠ‡ âˆ‡ â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î”
  defn-wk-âŠ©Ë¢âˆ· {Î” = Îµ} Î¾âŠ‡ âŠ©Ïƒ =
    âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ (wf-Â»âŠ‡ Î¾âŠ‡ (âŠ©Ë¢âˆ·â†’Â» âŠ©Ïƒ) , defn-wkâ€² Î¾âŠ‡ (âŠ©Ë¢âˆ·Îµâ‡” .projâ‚ âŠ©Ïƒ .projâ‚‚))
  defn-wk-âŠ©Ë¢âˆ· {Î” = Î” âˆ™ A} Î¾âŠ‡ âŠ©Ïƒ =
    let ((l , âŠ©A , âŠ©h) , âŠ©t) = âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ âŠ©Ïƒ
    in  âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚ $ (l , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A , defn-wk-âŠ©âˆ· Î¾âŠ‡ âŠ©h)
                     , defn-wk-âŠ©Ë¢âˆ· Î¾âŠ‡ âŠ©t

------------------------------------------------------------------------
-- Changing type levels

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  level-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B
  level-âŠ©áµ›â‰¡ âŠ©A âŠ©B Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©Î“ , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©Î“
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          case wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
            (âŠ©Ïƒâ‚ , âŠ©Ïƒâ‚‚) â†’
          level-âŠ©â‰¡ (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A) âŠ©Ïƒâ‚)
                   (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©B) âŠ©Ïƒâ‚‚) $
          Aâ‰¡B Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚
      )

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  level-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A
  level-âŠ©áµ›â‰¡âˆ· âŠ©A tâ‰¡u =
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©A
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’ let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ in
          level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A) $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) $
          âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) Ïƒâ‚â‰¡Ïƒâ‚‚
      )

opaque

  -- Changing type levels for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  level-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A
  level-âŠ©áµ›âˆ· âŠ©A =
    âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ âˆ˜â†’ level-âŠ©áµ›â‰¡âˆ· âŠ©A âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- More transitivity lemmas

opaque

  -- Transitivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  trans-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ C
  trans-âŠ©áµ›â‰¡ {A} {B} {C} Aâ‰¡B Bâ‰¡C =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©Î“ , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©Î“
      , Î» Î¾âŠ‡ {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          A [ Ïƒâ‚ ]  â‰¡âŸ¨ Aâ‰¡B Î¾âŠ‡ $ refl-âŠ©Ë¢â‰¡âˆ· (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) âŸ©âŠ©
          B [ Ïƒâ‚ ]  â‰¡âŸ¨ âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] (defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Bâ‰¡C) Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ
          C [ Ïƒâ‚‚ ]  âˆ
      )

opaque

  -- Transitivity for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  trans-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© u â‰¡ v âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ v âˆ· A
  trans-âŠ©áµ›â‰¡âˆ· {t} {u} {v} tâ‰¡u uâ‰¡v =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ uâ‰¡v of Î»
      (âŠ©A , uâ‰¡v) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©A
      , Î» Î¾âŠ‡ {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          t [ Ïƒâ‚ ]  â‰¡âŸ¨ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ (level-âŠ©áµ›â‰¡âˆ· âŠ©A tâ‰¡u)) $
                       refl-âŠ©Ë¢â‰¡âˆ· (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) âŸ©âŠ©âˆ·
          u [ Ïƒâ‚ ]  â‰¡âŸ¨ uâ‰¡v Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆ
          v [ Ïƒâ‚‚ ]  âˆ
      )

------------------------------------------------------------------------
-- More well-formedness lemmas

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wf-âŠ©áµ›â‰¡ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A Ã— Î“ âŠ©áµ›âŸ¨ l âŸ© B
  wf-âŠ©áµ›â‰¡ Aâ‰¡B =
      âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ (trans-âŠ©áµ›â‰¡ Aâ‰¡B (sym-âŠ©áµ›â‰¡ Aâ‰¡B))
    , âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ (trans-âŠ©áµ›â‰¡ (sym-âŠ©áµ›â‰¡ Aâ‰¡B) Aâ‰¡B)

opaque

  -- A well-formedness lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wf-âŠ©áµ›â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã— Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A
  wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u =
      âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ (trans-âŠ©áµ›â‰¡âˆ· tâ‰¡u (sym-âŠ©áµ›â‰¡âˆ· tâ‰¡u))
    , âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ (trans-âŠ©áµ›â‰¡âˆ· (sym-âŠ©áµ›â‰¡âˆ· tâ‰¡u) tâ‰¡u)

------------------------------------------------------------------------
-- More characterisation lemmas

opaque

  -- A variant of âŠ©áµ›â‰¡â‡”.

  âŠ©áµ›â‰¡â‡”â€² :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ]))
  âŠ©áµ›â‰¡â‡”â€² {A} {B} =
      (Î» Aâ‰¡B â†’
         case wf-âŠ©áµ›â‰¡ Aâ‰¡B of Î»
           (âŠ©A , âŠ©B) â†’
         âŠ©A , âŠ©B , Î» {_ _} Î¾âŠ‡ {_ _ _} âŠ©Ïƒ â†’
                     âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] (defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Aâ‰¡B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ))
    , (Î» (âŠ©A , _ , Aâ‰¡B) â†’
         âŠ©áµ›â‰¡â‡” .projâ‚‚
           ( wf-âŠ©áµ› âŠ©A
           , Î» Î¾âŠ‡ {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
               A [ Ïƒâ‚ ]  â‰¡âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©
               A [ Ïƒâ‚‚ ]  â‰¡âŸ¨ Aâ‰¡B Î¾âŠ‡ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚ âŸ©âŠ©âˆ
               B [ Ïƒâ‚‚ ]  âˆ
           ))

opaque

  -- A variant of âŠ©áµ›â‰¡â‡”â€².

  âŠ©áµ›â‰¡â‡”â€²Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ]))
  âŠ©áµ›â‰¡â‡”â€²Ê° {âˆ‡} {n} {Î”} {l} {A} {B} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                           â‡”âŸ¨ âŠ©áµ›â‰¡â‡”â€² âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])             â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’ Î£-cong-â‡” Î» _ â†’
                                                      implicit-Î -cong-â‡” Î» _ â†’
                                                      implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                      implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                      implicit-Î -cong-â‡” Î» _ â†’
                                                      Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
     âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])           â–¡â‡”

opaque

  -- A variant of âŠ©áµ›â‰¡â‡”.

  âŠ©áµ›â‰¡â‡”â€³ :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‰¡â‡”â€³ =
      (Î» Aâ‰¡B â†’
         case wf-âŠ©áµ›â‰¡ Aâ‰¡B of Î»
           (âŠ©A , âŠ©B) â†’
         âŠ©A , âŠ©B , Î» {_ _} Î¾âŠ‡ {_ _ _ _} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
                     âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] (defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Aâ‰¡B) Ïƒâ‚â‰¡Ïƒâ‚‚)
    , (Î» (âŠ©A , _ , Aâ‰¡B) â†’
         âŠ©áµ›â‰¡â‡” .projâ‚‚ (wf-âŠ©áµ› âŠ©A , Aâ‰¡B))

opaque

  -- A variant of âŠ©áµ›â‰¡â‡”â€³.

  âŠ©áµ›â‰¡â‡”â€³Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ]))
  âŠ©áµ›â‰¡â‡”â€³Ê° {âˆ‡} {n} {Î”} {l} {A} {B} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                                     â‡”âŸ¨ âŠ©áµ›â‰¡â‡”â€³ âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])                     â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’ Î£-cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© A [ Ïƒâ‚ ] â‰¡ B [ Ïƒâ‚‚ ])                   â–¡â‡”

opaque

  -- A variant of âŠ©áµ›â‰¡âˆ·â‡”.

  âŠ©áµ›â‰¡âˆ·â‡”â€² :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ]))
  âŠ©áµ›â‰¡âˆ·â‡”â€² {t} {u} =
      (Î» tâ‰¡u â†’
         case wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u of Î»
           (âŠ©t , âŠ©u) â†’
         âŠ©t , âŠ©u , Î» {_ _} Î¾âŠ‡ {_ _ _} âŠ©Ïƒ â†’
                     âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ))
    , (Î» (_ , âŠ©u , tâ‰¡u) â†’
         âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
           ( wf-âŠ©áµ›âˆ· âŠ©u
           , Î» Î¾âŠ‡ {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
               t [ Ïƒâ‚ ]  â‰¡âŸ¨ tâ‰¡u Î¾âŠ‡ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚ âŸ©âŠ©âˆ·
               u [ Ïƒâ‚ ]  â‰¡âŸ¨ âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆ
               u [ Ïƒâ‚‚ ]  âˆ
           ))

opaque

  -- A variant of âŠ©áµ›â‰¡âˆ·â‡”â€².

  âŠ©áµ›â‰¡âˆ·â‡”â€²Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ]))
  âŠ©áµ›â‰¡âˆ·â‡”â€²Ê° {âˆ‡} {n} {Î”} {l} {t} {u} {A} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                        â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡”â€² âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])    â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’ Î£-cong-â‡” Î» _ â†’
                                                       implicit-Î -cong-â‡” Î» _ â†’
                                                       implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                       implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                       implicit-Î -cong-â‡” Î» _ â†’
                                                       Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡âˆ·â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
     âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])  â–¡â‡”

opaque

  -- A variant of âŠ©áµ›â‰¡âˆ·â‡”.

  âŠ©áµ›â‰¡âˆ·â‡”â€³ :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›â‰¡âˆ·â‡”â€³ =
      (Î» tâ‰¡u â†’
         case wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u of Î»
           (âŠ©t , âŠ©u) â†’
         âŠ©t , âŠ©u , Î» {_ _} Î¾âŠ‡ {_ _ _ _} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
                     âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) Ïƒâ‚â‰¡Ïƒâ‚‚)
    , (Î» (âŠ©t , _ , tâ‰¡u) â†’
         âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚ (wf-âŠ©áµ›âˆ· âŠ©t , tâ‰¡u))

opaque

  -- A variant of âŠ©áµ›â‰¡âˆ·â‡”â€³.

  âŠ©áµ›â‰¡âˆ·â‡”â€³Ê° :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â‡”
    (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
     âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
     (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
      âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
        â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
      âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
      âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ]))
  âŠ©áµ›â‰¡âˆ·â‡”â€³Ê° {âˆ‡} {n} {Î”} {l} {t} {u} {A} =
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                                 â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡”â€³ âŸ©

    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n} â†’ âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])          â‡”âŸ¨ (Î£-cong-â‡” Î» _ â†’ Î£-cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                implicit-Î -cong-â‡” Î» _ â†’ implicit-Î -cong-â‡” Î» _ â†’
                                                                Î â¦ƒâ¦„â†’â‡”â¦ƒâ¦„â†’Î  âˆ˜â‡” (Î -cong-â‡” Î» _ â†’ âŠ©â‰¡âˆ·â‡”)) âŸ©
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A Ã—
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A Ã—
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒâ‚ Ïƒâ‚‚ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
     âˆ‡â€² Â» Î— H.âŠ©âŸ¨ l âŸ© t [ Ïƒâ‚ ] â‰¡ u [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ])        â–¡â‡”

opaque

  -- A variant of âŠ©Ë¢âˆ·âˆ™â‡”.

  âŠ©Ë¢âˆ·âˆ™â‡”â€² :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A â‡”
    ((âˆƒ Î» l â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     (âˆƒ Î» l â†’ âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
     âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”)
  âŠ©Ë¢âˆ·âˆ™â‡”â€² {âˆ‡} {Î—} {Ïƒ} {Î”} {A} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A                                                  â‡”âŸ¨ âŠ©Ë¢âˆ·âˆ™â‡” âŸ©

    (âˆƒ Î» l â†’ (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”                                                 â‡”âŸ¨ (Î» ((l , âŠ©A , âŠ©head) , âŠ©tail) â†’
                                                                              (l , âŠ©A) , (l , âŠ©head) , âŠ©tail)
                                                                         , (Î» ((lâ‚ , âŠ©A) , (_ , âŠ©head) , âŠ©tail) â†’
                                                                              (lâ‚ , âŠ©A , level-âŠ©âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A âŠ©tail) âŠ©head) , âŠ©tail)
                                                                         âŸ©
    (âˆƒ Î» l â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (âˆƒ Î» l â†’ âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”                                                 â–¡â‡”

opaque

  -- A variant of âŠ©Ë¢â‰¡âˆ·âˆ™â‡”.

  âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² :
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A â‡”
    ((âˆƒ Î» l â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
     (âˆƒ Î» l â†’ âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
     âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”)
  âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² {âˆ‡} {Î—} {Ïƒâ‚} {Ïƒâ‚‚} {Î”} {A} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A                                                â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©

    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                          â‡”âŸ¨ (Î» ((l , âŠ©A , headâ‰¡head) , tailâ‰¡tail) â†’
                                                                                  (l , âŠ©A) , (l , headâ‰¡head) , tailâ‰¡tail)
                                                                             , (Î» ((lâ‚ , âŠ©A) , (_ , headâ‰¡head) , tailâ‰¡tail) â†’
                                                                                    ( lâ‚ , âŠ©A
                                                                                    , level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A (wf-âŠ©Ë¢â‰¡âˆ· tailâ‰¡tail .projâ‚))
                                                                                        headâ‰¡head
                                                                                    )
                                                                                  , tailâ‰¡tail)
                                                                             âŸ©
    (âˆƒ Î» l â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (âˆƒ Î» l â†’ âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                          â–¡â‡”

------------------------------------------------------------------------
-- Conversion

opaque

  -- Conversion for one of the contexts for _âŠ©Ë¢_â‰¡_âˆ·_.

  conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ B
  conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ {âˆ‡} {Î”} {A} {B} {Î—} {Ïƒâ‚} {Ïƒâ‚‚} Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡”â€² .projâ‚ Aâ‰¡B of Î»
      (_ , âŠ©B , Aâ‰¡B) â†’

    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A                                                â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                          â†’âŸ¨ (Î» ((_ , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                                    (_ , âŠ©B , conv-âŠ©â‰¡âˆ· (Aâ‰¡B idâŠ‡ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚) Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)
                                                                                  , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· B [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                          â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ B                                                â–¡

opaque

  -- Conversion for one of the contexts for _âŠ©Ë¢_âˆ·_.

  conv-âŠ©Ë¢âˆ·-âˆ™ :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ B
  conv-âŠ©Ë¢âˆ·-âˆ™ Aâ‰¡B =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‰¡B âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- Conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_.

  conv-âˆ™-âŠ©áµ› :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C
  conv-âˆ™-âŠ©áµ› {Î“} {A} {B} {l} {C} Aâ‰¡B âŠ©C =
    case âŠ©áµ›â‰¡â‡”â€² .projâ‚ Aâ‰¡B of Î»
      (âŠ©A , âŠ©B , Aâ‰¡B) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›-âˆ™-intro âŠ©B
      , Î» {_} {âˆ‡â€² = âˆ‡} Î¾âŠ‡ {_} {Î— = Î—} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          let Î” = Î“ .vars in                                  $âŸ¨ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©

          âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ B                            â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          (âˆƒ Î» l â†’
           (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© B) Ã—
           âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· B [ tail Ïƒâ‚ ]) Ã—
          âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                      â†’âŸ¨ (Î» ((_ , _ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                    (_ , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A ,
                                                                     conv-âŠ©â‰¡âˆ· (sym-âŠ©â‰¡ $ Aâ‰¡B Î¾âŠ‡ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚) Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)
                                                                    , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
          (âˆƒ Î» l â†’
           (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã—
           âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
          âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                      â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A                            â†’âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©C .projâ‚‚ Î¾âŠ‡ âŸ©

          âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© C [ Ïƒâ‚ ] â‰¡ C [ Ïƒâ‚‚ ]                    â–¡
      )

opaque

  -- Another kind of conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_.

  conv-âˆ™âˆ™-âŠ©áµ› :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    Î“ Â»âˆ™ Aâ‚ âŠ©áµ›âŸ¨ lâ€³ âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    Î“ Â»âˆ™ Aâ‚ Â»âˆ™ Bâ‚ âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ Â»âˆ™ Aâ‚‚ Â»âˆ™ Bâ‚‚ âŠ©áµ›âŸ¨ l âŸ© C
  conv-âˆ™âˆ™-âŠ©áµ› {Î“} {Aâ‚} {Aâ‚‚} {Bâ‚} {Bâ‚‚} {l} {C} Aâ‚â‰¡Aâ‚‚ Bâ‚â‰¡Bâ‚‚ âŠ©C =
    case sym-âŠ©áµ›â‰¡ Aâ‚â‰¡Aâ‚‚ of Î»
      Aâ‚‚â‰¡Aâ‚ â†’
    case âŠ©áµ›â‰¡â‡”â€² .projâ‚ Bâ‚â‰¡Bâ‚‚ of Î»
      (âŠ©Bâ‚ , âŠ©Bâ‚‚ , Bâ‚â‰¡Bâ‚‚) â†’
    âŠ©áµ›â‡” .projâ‚‚
      ( âŠ©áµ›-âˆ™-intro (conv-âˆ™-âŠ©áµ› Aâ‚â‰¡Aâ‚‚ âŠ©Bâ‚‚)
      , Î» {_} {âˆ‡â€² = âˆ‡} Î¾âŠ‡ {_} {Î— = Î—} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          let Î” = Î“ .vars
              Â»âˆ‡ = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚
              Aâ‚‚â‰¡Aâ‚ = defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Aâ‚‚â‰¡Aâ‚
          in                                                   $âŸ¨ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©

          âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ Aâ‚‚ âˆ™ Bâ‚‚                       â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          (âˆƒ Î» l â†’
           (âˆ‡ Â» Î” âˆ™ Aâ‚‚ âŠ©áµ›âŸ¨ l âŸ© Bâ‚‚) Ã—
           âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· Bâ‚‚ [ tail Ïƒâ‚ ]) Ã—
          âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î” âˆ™ Aâ‚‚                  â†’âŸ¨ (Î» ((_ , _ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                     (_ , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©Bâ‚ ,
                                                                      conv-âŠ©â‰¡âˆ·
                                                                        (sym-âŠ©â‰¡ $ Bâ‚â‰¡Bâ‚‚ Î¾âŠ‡ $ conv-âŠ©Ë¢âˆ·-âˆ™ Aâ‚‚â‰¡Aâ‚ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š .projâ‚)
                                                                        Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) ,
                                                                     conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‚‚â‰¡Aâ‚ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
          (âˆƒ Î» l â†’
           (âˆ‡ Â» Î” âˆ™ Aâ‚ âŠ©áµ›âŸ¨ l âŸ© Bâ‚) Ã—
           âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· Bâ‚ [ tail Ïƒâ‚ ]) Ã—
          âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î” âˆ™ Aâ‚                  â‡”Ë˜âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

          âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ Aâ‚ âˆ™ Bâ‚                       â†’âŸ¨ âŠ©áµ›â‡” .projâ‚ âŠ©C .projâ‚‚ Î¾âŠ‡ âŸ©

          âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© C [ Ïƒâ‚ ] â‰¡ C [ Ïƒâ‚‚ ]                     â–¡
      )

opaque

  -- Conversion for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  conv-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· B
  conv-âŠ©áµ›â‰¡âˆ· Aâ‰¡B tâ‰¡u =
    case âŠ©áµ›â‰¡â‡”â€² .projâ‚ Aâ‰¡B of Î»
      (_ , âŠ©B , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©B
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          conv-âŠ©â‰¡âˆ· (Aâ‰¡B Î¾âŠ‡ $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚) $
          âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) Ïƒâ‚â‰¡Ïƒâ‚‚
      )

opaque

  -- Conversion for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  conv-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· B
  conv-âŠ©áµ›âˆ· Aâ‰¡B =
    âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ âˆ˜â†’ conv-âŠ©áµ›â‰¡âˆ· Aâ‰¡B âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

opaque

  -- Conversion for the context for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  conv-âˆ™-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A â‰¡ B â†’
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î“ Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C
  conv-âˆ™-âŠ©áµ›âˆ· Aâ‰¡B âŠ©t =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t of Î»
      (âŠ©C , tâ‰¡t) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( conv-âˆ™-âŠ©áµ› Aâ‰¡B âŠ©C
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’ tâ‰¡t Î¾âŠ‡ (conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ (sym-âŠ©áµ›â‰¡ (defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Aâ‰¡B)) Ïƒâ‚â‰¡Ïƒâ‚‚)
      )

------------------------------------------------------------------------
-- Expansion

opaque

  -- An expansion lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·-â‡ :
    (âˆ€ {Îºâ€²} {âˆ‡â€² : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡â€² âŠ‡ âˆ‡ â†’
     âˆ€ {m Î—} {Ïƒ : Subst m n}
       â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
     âˆ‡â€² Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
     âˆ‡â€² Â» Î— âŠ¢ t [ Ïƒ ] â‡’ u [ Ïƒ ] âˆ· A [ Ïƒ ]) â†’
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© u âˆ· A â†’
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A
  âŠ©áµ›âˆ·-â‡ {t} {u} t[]â‡’u[] âŠ©u =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u of Î»
      (âŠ©A , uâ‰¡u) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©A
      , Î» Î¾âŠ‡ {_ _} {Ïƒâ‚ = Ïƒâ‚} {Ïƒâ‚‚ = Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          case wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
            (âŠ©Ïƒâ‚ , _) â†’
          case âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]âˆ· (defn-wk-âŠ©áµ›âˆ· Î¾âŠ‡ âŠ©u) âŠ©Ïƒâ‚ of Î»
            âŠ©u[Ïƒâ‚] â†’
          with-inc-âŠ©â‰¡âˆ·
            (t [ Ïƒâ‚ ]  â‰¡âŸ¨ âŠ©âˆ·-â‡* (redMany (t[]â‡’u[] Î¾âŠ‡ âŠ©Ïƒâ‚)) âŠ©u[Ïƒâ‚] âŸ©âŠ©âˆ·
             u [ Ïƒâ‚ ]  â‰¡âŸ¨ uâ‰¡u Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆ
             u [ Ïƒâ‚‚ ]  âˆ)
      )

------------------------------------------------------------------------
-- Some lemmas related to _âŠ©Ë¢_âˆ·_ and _âŠ©Ë¢_â‰¡_âˆ·_

opaque

  -- A cast lemma for _âŠ©Ë¢_âˆ·_.

  cast-âŠ©Ë¢âˆ· :
    ((x : Fin n) â†’ Ïƒâ‚ x PE.â‰¡ Ïƒâ‚‚ x) â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ âˆ· Î” â†’ âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚‚ âˆ· Î”
  cast-âŠ©Ë¢âˆ· {Î” = Îµ} _ âŠ©Ïƒâ‚ =
    âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ $ âŠ©Ë¢âˆ·Îµâ‡” .projâ‚ âŠ©Ïƒâ‚
  cast-âŠ©Ë¢âˆ· {Î” = _ âˆ™ A} Ïƒâ‚â‰¡Ïƒâ‚‚ âŠ©Ïƒâ‚ =
    case âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚ âŠ©Ïƒâ‚ of Î»
      ((_ , âŠ©A , âŠ©Ïƒâ‚â‚€) , âŠ©Ïƒâ‚â‚Š) â†’
    case Ïƒâ‚â‰¡Ïƒâ‚‚ âˆ˜â†’ (_+1) of Î»
      Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š â†’
    âŠ©Ë¢âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_âˆ·_ _ _) (Ïƒâ‚â‰¡Ïƒâ‚‚ x0)
            (substVar-to-subst Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š A) âŠ©Ïƒâ‚â‚€
        )
      , cast-âŠ©Ë¢âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š âŠ©Ïƒâ‚â‚Š
      )

opaque

  -- A lemma related to _â€¢â‚›_.

  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› :
    (â¦ƒ inc : Var-included or-empty Î¦ â¦„ â†’ âˆ‡ Â» Ï âˆ·Ê· Î¦ âŠ‡ Î—) â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î¦ âŠ©Ë¢ Ï â€¢â‚› Ïƒâ‚ â‰¡ Ï â€¢â‚› Ïƒâ‚‚ âˆ· Î”
  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› {Î” = Îµ} ÏâŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©Ë¢â‰¡âˆ·Îµâ‡” .projâ‚‚ (âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ , TW.wf-âˆ·Ê·âŠ‡ ÏâŠ‡)
  âŠ©Ë¢â‰¡âˆ·-â€¢â‚› {Î” = _ âˆ™ A} ÏâŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , with-inc-âŠ©â‰¡âˆ·
            (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk-subst A)
               (wk-âŠ©â‰¡âˆ· ÏâŠ‡ Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€))
        )
      , âŠ©Ë¢â‰¡âˆ·-â€¢â‚› ÏâŠ‡ Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š
      )

opaque

  -- A lemma related to _â€¢â‚›_.

  âŠ©Ë¢âˆ·-â€¢â‚› :
    (â¦ƒ inc : Var-included or-empty Î¦ â¦„ â†’ âˆ‡ Â» Ï âˆ·Ê· Î¦ âŠ‡ Î—) â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î¦ âŠ©Ë¢ Ï â€¢â‚› Ïƒ âˆ· Î”
  âŠ©Ë¢âˆ·-â€¢â‚› ÏâŠ‡ =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-â€¢â‚› ÏâŠ‡ âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to _â‚›â€¢_.

  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ :
    Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î” â†’ âˆ‡ Â» Î¦ âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î— â†’
    âˆ‡ Â» Î¦ âŠ©Ë¢ Ïƒâ‚ â‚›â€¢ Ï â‰¡ Ïƒâ‚‚ â‚›â€¢ Ï âˆ· Î”
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ TW.id _ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    Ïƒâ‚â‰¡Ïƒâ‚‚
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ (TW.step ÏâŠ‡) âŠ©Î” Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , âŠ©A , headâ‰¡head) , tailâ‰¡tail) â†’
    âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î” tailâ‰¡tail
  âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ (TW.lift {A} ÏâŠ‡) âŠ©Î”âˆ™A Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âŠ©áµ›-âˆ™ âŠ©Î”âˆ™A of Î»
      (_ , âŠ©A) â†’
    case âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ of Î»
      ((_ , _ , headâ‰¡head) , tailâ‰¡tail) â†’
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©A)
      , (_ , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (subst-wk A) headâ‰¡head)
      , âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› âŠ©A) tailâ‰¡tail
      )

opaque

  -- A lemma related to _â‚›â€¢_.

  âŠ©Ë¢âˆ·-â‚›â€¢ : Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î” â†’ âˆ‡ Â» Î¦ âŠ©Ë¢ Ïƒ âˆ· Î— â†’ âˆ‡ Â» Î¦ âŠ©Ë¢ Ïƒ â‚›â€¢ Ï âˆ· Î”
  âŠ©Ë¢âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î” =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ âŠ©Î” âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to wk1Subst.

  âŠ©Ë¢â‰¡âˆ·-wk1Subst :
    (â¦ƒ inc : Var-included â¦„ â†’ âˆ‡ Â» Î— âŠ¢ A) â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A âŠ©Ë¢ wk1Subst Ïƒâ‚ â‰¡ wk1Subst Ïƒâ‚‚ âˆ· Î”
  âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A =
    âŠ©Ë¢â‰¡âˆ·-â€¢â‚› $ TW.stepÊ· TW.id $ âŠ¢A â¦ƒ inc = or-empty-1+â†’ â¦„

opaque

  -- A lemma related to wk1Subst.

  âŠ©Ë¢âˆ·-wk1Subst :
    (â¦ƒ inc : Var-included â¦„ â†’ âˆ‡ Â» Î— âŠ¢ A) â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A âŠ©Ë¢ wk1Subst Ïƒ âˆ· Î”
  âŠ©Ë¢âˆ·-wk1Subst âŠ¢A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to liftSubst.

  âŠ©Ë¢â‰¡âˆ·-liftSubst :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒâ‚ ] âŠ©Ë¢ liftSubst Ïƒâ‚ â‰¡ liftSubst Ïƒâ‚‚ âˆ· Î” âˆ™ A
  âŠ©Ë¢â‰¡âˆ·-liftSubst {A} âŠ©A Ïƒâ‚â‰¡Ïƒâ‚‚ =
    let âŠ¢A[Ïƒâ‚]    = Î» â¦ƒ inc = inc â¦„ â†’
                      escape-âŠ© â¦ƒ inc = included â¦„ $
                      âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A (wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚)
        Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š = âŠ©Ë¢â‰¡âˆ·-wk1Subst âŠ¢A[Ïƒâ‚] Ïƒâ‚â‰¡Ïƒâ‚‚
    in
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚
      ( ( _ , âŠ©A
        , (with-inc-âŠ©â‰¡âˆ· $
           refl-âŠ©â‰¡âˆ· $
           neutral-âŠ©âˆ· (âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[] âŠ©A $ wf-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š .projâ‚)
             (varâ‚—â€² _) $
           ~-var $
           _âŠ¢_âˆ·_.var (âˆ™ âŠ¢A[Ïƒâ‚] â¦ƒ inc = or-empty-1+â†’ â¦„) $
           PE.substâ‚‚ (_âˆ·_âˆˆ_ _) (PE.sym $ wk1Subst-wk1 A) PE.refl here)
        )
      , Ïƒâ‚â‡‘â‚Šâ‰¡Ïƒâ‚‚â‡‘â‚Š
      )

opaque

  -- A lemma related to liftSubst.

  âŠ©Ë¢âˆ·-liftSubst :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒ ] âŠ©Ë¢ liftSubst Ïƒ âˆ· Î” âˆ™ A
  âŠ©Ë¢âˆ·-liftSubst âŠ©A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©A âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A variant of âŠ©Ë¢â‰¡âˆ·-liftSubst.

  âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ Aâ‚ [ Ïƒâ‚ ] âŠ©Ë¢ liftSubst Ïƒâ‚ â‰¡ liftSubst Ïƒâ‚‚ âˆ· Î” âˆ™ Aâ‚‚
  âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² {Aâ‚} {Aâ‚‚} {Ïƒâ‚} Aâ‚â‰¡Aâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    conv-âŠ©Ë¢â‰¡âˆ·-âˆ™ Aâ‚â‰¡Aâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âŠ©áµ›â‰¡ Aâ‚â‰¡Aâ‚‚ .projâ‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A variant of âŠ©Ë¢âˆ·-liftSubst.

  âŠ©Ë¢âˆ·-liftSubstâ€² :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© Aâ‚ â‰¡ Aâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ Aâ‚ [ Ïƒ ] âŠ©Ë¢ liftSubst Ïƒ âˆ· Î” âˆ™ Aâ‚‚
  âŠ©Ë¢âˆ·-liftSubstâ€² Aâ‚â‰¡Aâ‚‚ =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-liftSubstâ€² Aâ‚â‰¡Aâ‚‚ âˆ˜â†’ âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚

opaque

  -- A lemma related to idSubst.

  âŠ©Ë¢âˆ·-idSubst :
    âˆ‡ Â»âŠ©áµ› Î” â†’
    âˆ‡ Â» Î” âŠ©Ë¢ idSubst âˆ· Î”
  âŠ©Ë¢âˆ·-idSubst {Î” = Îµ} âŠ©Îµ =
    let Â»âˆ‡ = âŠ©áµ›Îµâ‡” .projâ‚ âŠ©Îµ in âŠ©Ë¢âˆ·Îµâ‡” .projâ‚‚ (Â»âˆ‡ , Îµ Â»âˆ‡)
  âŠ©Ë¢âˆ·-idSubst {Î” = _ âˆ™ _} âŠ©Î”âˆ™A =
    case âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î”âˆ™A .projâ‚‚ of Î»
      âŠ©A â†’
    PE.substâ‚ƒ _âŠ©Ë¢_âˆ·_ (PE.cong (_Â»âˆ™_ _) $ subst-id _) PE.refl PE.refl $
    cast-âŠ©Ë¢âˆ· subst-lift-id $
    âŠ©Ë¢âˆ·-liftSubst (âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î”âˆ™A .projâ‚‚)
      (âŠ©Ë¢âˆ·-idSubst (âŠ©áµ›â‡” .projâ‚ âŠ©A .projâ‚))

opaque

  -- A lemma related to sgSubst.

  âŠ©Ë¢â‰¡âˆ·-sgSubst :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ lâ€² âŸ© A â†’
    âˆ‡ Â» Î” âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    âˆ‡ Â» Î” âŠ©Ë¢ sgSubst t â‰¡ sgSubst u âˆ· Î” âˆ™ A
  âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A tâ‰¡u =
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©A)
      , (_ , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (PE.sym $ subst-id _) tâ‰¡u)
      , refl-âŠ©Ë¢â‰¡âˆ· (âŠ©Ë¢âˆ·-idSubst (wf-âŠ©áµ› âŠ©A))
      )

opaque

  -- A lemma related to sgSubst.

  âŠ©Ë¢âˆ·-sgSubst :
    âˆ‡ Â» Î” âŠ©áµ›âŸ¨ lâ€² âŸ© A â†’
    âˆ‡ Â» Î” âŠ©âŸ¨ l âŸ© t âˆ· A â†’
    âˆ‡ Â» Î” âŠ©Ë¢ sgSubst t âˆ· Î” âˆ™ A
  âŠ©Ë¢âˆ·-sgSubst âŠ©A =
    âŠ©Ë¢âˆ·â‡”âŠ©Ë¢â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A âˆ˜â†’ âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- Reducibility from validity

opaque

  -- If there is a valid equality between A andÂ B, then there is a
  -- reducible equality between A andÂ B.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡ : Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ©âŸ¨ l âŸ© A â‰¡ B
  âŠ©áµ›â‰¡â†’âŠ©â‰¡ {Î“} {l} {A} {B} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B                                       â‡”âŸ¨ âŠ©áµ›â‰¡â‡”â€² âŸ©â†’

    (Î“ âŠ©áµ›âŸ¨ l âŸ© A) Ã—
    (Î“ âŠ©áµ›âŸ¨ l âŸ© B) Ã—
    (âˆ€ {Îºâ€²} {âˆ‡ : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡ âŠ‡ Î“ .defs â†’
     âˆ€ {m} {Î” : Con Term m} {Ïƒ} â†’ âˆ‡ Â» Î” âŠ©Ë¢ Ïƒ âˆ· Î“ .vars â†’
     âˆ‡ Â» Î” âŠ©âŸ¨ l âŸ© A [ Ïƒ ] â‰¡ B [ Ïƒ ])                      â†’âŸ¨ (Î» (âŠ©A , _ , Aâ‰¡B) â†’ Aâ‰¡B idâŠ‡ $ âŠ©Ë¢âˆ·-idSubst $ wf-âŠ©áµ› âŠ©A) âŸ©

    Î“ âŠ©âŸ¨ l âŸ© A [ idSubst ] â‰¡ B [ idSubst ]                â‰¡âŸ¨ PE.congâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (subst-id _) (subst-id _) âŸ©â†’

    Î“ âŠ©âŸ¨ l âŸ© A â‰¡ B                                        â–¡

opaque

  -- If A is valid, then A is reducible.

  âŠ©áµ›â†’âŠ© : Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ âŠ©âŸ¨ l âŸ© A
  âŠ©áµ›â†’âŠ© = âŠ©â‡”âŠ©â‰¡ .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‰¡â†’âŠ©â‰¡ âˆ˜â†’ âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚

opaque

  -- If there is a valid equality between t andÂ u, then there is a
  -- reducible equality between t andÂ u.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· {Î“} {l} {t} {u} {A} =
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A                                     â‡”âŸ¨ âŠ©áµ›â‰¡âˆ·â‡”â€² âŸ©â†’

    (Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A) Ã—
    (Î“ âŠ©áµ›âŸ¨ l âŸ© u âˆ· A) Ã—
    (âˆ€ {Îºâ€²} {âˆ‡ : DCon (Term 0) Îºâ€²} â†’ Â» âˆ‡ âŠ‡ Î“ .defs â†’
     âˆ€ {m} {Î” : Con Term m} {Ïƒ} â†’ âˆ‡ Â» Î” âŠ©Ë¢ Ïƒ âˆ· Î“ .vars â†’
     âˆ‡ Â» Î” âŠ©âŸ¨ l âŸ© t [ Ïƒ ] â‰¡ u [ Ïƒ ] âˆ· A [ Ïƒ ])              â†’âŸ¨ (Î» (âŠ©t , _ , tâ‰¡u) â†’
                                                                  tâ‰¡u idâŠ‡ $ âŠ©Ë¢âˆ·-idSubst $ wf-âŠ©áµ› $ wf-âŠ©áµ›âˆ· âŠ©t) âŸ©

    Î“ âŠ©âŸ¨ l âŸ© t [ idSubst ] â‰¡ u [ idSubst ] âˆ· A [ idSubst ]  â‰¡âŸ¨ PE.congâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
                                                                 (subst-id _) (subst-id _) (subst-id _) âŸ©â†’

    Î“ âŠ©âŸ¨ l âŸ© t â‰¡ u âˆ· A                                      â–¡

opaque

  -- If t is valid, then t is reducible.

  âŠ©áµ›âˆ·â†’âŠ©âˆ· : Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ©âŸ¨ l âŸ© t âˆ· A
  âŠ©áµ›âˆ·â†’âŠ©âˆ· = âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ âˆ˜â†’ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ· âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

------------------------------------------------------------------------
-- Escape lemmas

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  escape-âŠ©áµ› :
    â¦ƒ inc : Var-included or-empty (Î“ .vars) â¦„ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ âŠ¢ A
  escape-âŠ©áµ› = escape-âŠ© âˆ˜â†’ âŠ©áµ›â†’âŠ©

opaque

  -- An escape lemma for âŠ©áµ›_.

  escape-âŠ©áµ›â€² :
    â¦ƒ inc : Var-included or-empty (Î“ .vars) â¦„ â†’
    âŠ©áµ› Î“ â†’ âŠ¢ Î“
  escape-âŠ©áµ›â€² {Î“ = _ Â» Îµ}     âŠ©Îµ = Îµ (âŠ©áµ›Îµâ‡” .projâ‚ âŠ©Îµ)
  escape-âŠ©áµ›â€² {Î“ = _ Â» _ âˆ™ _} âŠ©Î“ =
    âˆ™ escape-âŠ©áµ› â¦ƒ inc = or-empty-âˆ™â†’ â¦„ (âŠ©áµ›âˆ™â‡” .projâ‚ âŠ©Î“ .projâ‚‚)

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  escape-âŠ©áµ›â‰¡ :
    â¦ƒ inc : Var-included or-empty (Î“ .vars) â¦„ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ âŠ¢ A â‰… B
  escape-âŠ©áµ›â‰¡ = escape-âŠ©â‰¡ âˆ˜â†’ âŠ©áµ›â‰¡â†’âŠ©â‰¡

opaque

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  escape-âŠ©áµ›âˆ· :
    â¦ƒ inc : Var-included or-empty (Î“ .vars) â¦„ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ âŠ¢ t âˆ· A
  escape-âŠ©áµ›âˆ· = escape-âŠ©âˆ· âˆ˜â†’ âŠ©áµ›âˆ·â†’âŠ©âˆ·

opaque
  unfolding _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_

  -- An escape lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  escape-âŠ©áµ›â‰¡âˆ· :
    â¦ƒ inc : Var-included or-empty (Î“ .vars) â¦„ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’ Î“ âŠ¢ t â‰… u âˆ· A
  escape-âŠ©áµ›â‰¡âˆ· = escape-âŠ©â‰¡âˆ· âˆ˜â†’ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·

opaque

  -- An escape lemma for _âŠ©Ë¢_âˆ·_.

  escape-âŠ©Ë¢âˆ· :
    â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’ âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒ âˆ· Î”
  escape-âŠ©Ë¢âˆ· {Î—} {âˆ‡} {Ïƒ} {Î” = Îµ} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Îµ                                        â‡”âŸ¨ âŠ©Ë¢âˆ·Îµâ‡” âŸ©â†’
    (Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î— â¦„ â†’ âˆ‡ Â»âŠ¢ Î—))  â†’âŸ¨ (Î» hyp â†’ hyp .projâ‚‚) âŸ©
    âˆ‡ Â»âŠ¢ Î—                                                â†’âŸ¨ (Î» âŠ¢Î— â†’ âŠ¢Î— , âŠ¢Ë¢Ê·âˆ·Îµâ‡” .projâ‚‚ âŠ¢Î—) âŸ©
    âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒ âˆ· Îµ                              â–¡
  escape-âŠ©Ë¢âˆ· {Î—} {âˆ‡} {Ïƒ} {Î” = Î” âˆ™ A} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” âˆ™ A                                                  â‡”âŸ¨ âŠ©Ë¢âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’ (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒ âˆ· A [ tail Ïƒ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒ âˆ· Î”                                                 â†’âŸ¨ (Î» ((_ , _ , âŠ©Ïƒâ‚€) , âŠ©Ïƒâ‚Š) â†’
                                                                              escape-âŠ©âˆ· âŠ©Ïƒâ‚€ , escape-âŠ©Ë¢âˆ· âŠ©Ïƒâ‚Š) âŸ©

    âˆ‡ Â» Î— âŠ¢ head Ïƒ âˆ· A [ tail Ïƒ ] Ã— âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· tail Ïƒ âˆ· Î”       â†’âŸ¨ (Î» (âŠ¢Ïƒâ‚€ , âŠ¢Î— , âŠ¢Ïƒâ‚Š) â†’ âŠ¢Î— , â†’âŠ¢Ë¢Ê·âˆ·âˆ™ âŠ¢Ïƒâ‚Š âŠ¢Ïƒâ‚€) âŸ©

    âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒ âˆ· Î” âˆ™ A                                        â–¡

opaque

  -- An escape lemma for _âŠ©Ë¢_â‰¡_âˆ·_.

  escape-âŠ©Ë¢â‰¡âˆ· :
    â¦ƒ inc : Var-included or-empty Î— â¦„ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’ âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î”
  escape-âŠ©Ë¢â‰¡âˆ· {Î—} {âˆ‡} {Ïƒâ‚} {Ïƒâ‚‚} {Î” = Îµ} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ                                â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·Îµâ‡” âŸ©â†’
    Â» âˆ‡ Ã— (â¦ƒ inc : Var-included or-empty Î— â¦„ â†’ âˆ‡ Â»âŠ¢ Î—)  â†’âŸ¨ (Î» hyp â†’ hyp .projâ‚‚) âŸ©
    âˆ‡ Â»âŠ¢ Î—                                              â†’âŸ¨ (Î» âŠ¢Î— â†’ âŠ¢Î— , âŠ¢Ë¢Ê·â‰¡âˆ·Îµâ‡” .projâ‚‚ âŠ¢Î—) âŸ©
    âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Îµ                      â–¡
  escape-âŠ©Ë¢â‰¡âˆ· {Î—} {âˆ‡} {Ïƒâ‚} {Ïƒâ‚‚} {Î” = Î” âˆ™ A} =
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A                                                â‡”âŸ¨ âŠ©Ë¢â‰¡âˆ·âˆ™â‡” âŸ©â†’

    (âˆƒ Î» l â†’
     (âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A) Ã— âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ]) Ã—
    âˆ‡ Â» Î— âŠ©Ë¢ tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                          â†’âŸ¨ (Î» ((_ , âŠ©A , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                                  let âŠ©Ïƒâ‚â‚€ , âŠ©Ïƒâ‚‚â‚€ = wf-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ in
                                                                                  escape-âŠ©âˆ· âŠ©Ïƒâ‚â‚€ ,
                                                                                  escape-âŠ©âˆ· (conv-âŠ©âˆ· (âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] (refl-âŠ©áµ›â‰¡ âŠ©A) Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŠ©Ïƒâ‚‚â‚€) ,
                                                                                  â‰…â‚œ-eq (escape-âŠ©â‰¡âˆ· Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€) ,
                                                                                  escape-âŠ©Ë¢â‰¡âˆ· Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) âŸ©
    âˆ‡ Â» Î— âŠ¢ head Ïƒâ‚ âˆ· A [ tail Ïƒâ‚ ] Ã—
    âˆ‡ Â» Î— âŠ¢ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚‚ ] Ã—
    âˆ‡ Â» Î— âŠ¢ head Ïƒâ‚ â‰¡ head Ïƒâ‚‚ âˆ· A [ tail Ïƒâ‚ ] Ã—
    âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· tail Ïƒâ‚ â‰¡ tail Ïƒâ‚‚ âˆ· Î”                                â†’âŸ¨ (Î» (âŠ¢Ïƒâ‚â‚€ , âŠ¢Ïƒâ‚‚â‚€ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€ , âŠ¢Î— , Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š) â†’
                                                                                  âŠ¢Î— , âŠ¢Ë¢Ê·â‰¡âˆ·âˆ™â‡” .projâ‚‚ (Ïƒâ‚â‚Šâ‰¡Ïƒâ‚‚â‚Š , âŠ¢Ïƒâ‚â‚€ , âŠ¢Ïƒâ‚‚â‚€ , Ïƒâ‚â‚€â‰¡Ïƒâ‚‚â‚€)) âŸ©
    âˆ‡ Â»âŠ¢ Î— Ã— âˆ‡ Â» Î— âŠ¢Ë¢Ê· Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” âˆ™ A                                      â–¡

------------------------------------------------------------------------
-- Embedding

opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_.

  emb-âŠ©áµ› :
    l â‰¤áµ˜ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© A
  emb-âŠ©áµ› lâ‰¤lâ€² âŠ©A =
    case âŠ©áµ›â‡” .projâ‚ âŠ©A of Î»
      (âŠ©Î“ , Aâ‰¡A) â†’
    âŠ©áµ›â‡” .projâ‚‚ (âŠ©Î“ , Î» Î¾âŠ‡ â†’ emb-âŠ©â‰¡ lâ‰¤lâ€² âˆ˜â†’ Aâ‰¡A Î¾âŠ‡)

opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  emb-âŠ©áµ›â‰¡ :
    l â‰¤áµ˜ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u
  emb-âŠ©áµ›â‰¡ lâ‰¤lâ€² tâ‰¡u =
    let âŠ©t , âŠ©u = wf-âŠ©áµ›â‰¡ tâ‰¡u
    in level-âŠ©áµ›â‰¡ (emb-âŠ©áµ› lâ‰¤lâ€² âŠ©t) (emb-âŠ©áµ› lâ‰¤lâ€² âŠ©u) tâ‰¡u


opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  emb-âŠ©áµ›âˆ· :
    l â‰¤áµ˜ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A
  emb-âŠ©áµ›âˆ· lâ‰¤lâ€² âŠ©t =
    level-âŠ©áµ›âˆ· (emb-âŠ©áµ› lâ‰¤lâ€² (wf-âŠ©áµ›âˆ· âŠ©t)) âŠ©t

opaque

  -- Embedding for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  emb-âŠ©áµ›â‰¡âˆ· :
    l â‰¤áµ˜ lâ€² â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A
  emb-âŠ©áµ›â‰¡âˆ· lâ‰¤lâ€² tâ‰¡uâˆ·A =
    let âŠ©A = wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‰¡uâˆ·A .projâ‚)
    in level-âŠ©áµ›â‰¡âˆ· (emb-âŠ©áµ› lâ‰¤lâ€² âŠ©A) tâ‰¡uâˆ·A

------------------------------------------------------------------------
-- Weakening

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wk-âŠ©áµ›â‰¡ :
    Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î— â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’
    âˆ‡ Â» Î— âŠ©áµ›âŸ¨ l âŸ© wk Ï A â‰¡ wk Ï B
  wk-âŠ©áµ›â‰¡ {Ï} {A} {B} ÏâŠ‡ âŠ©Î— Aâ‰¡B =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Aâ‰¡B of Î»
      (âŠ©Î” , Aâ‰¡B) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( âŠ©Î—
      , Î» {_ _} Î¾âŠ‡ {_ _} {Ïƒâ‚} {Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          wk Ï A [ Ïƒâ‚ ]  â‰¡âŸ¨ subst-wk A âŸ©âŠ©â‰¡
          A [ Ïƒâ‚ â‚›â€¢ Ï ]  â‰¡âŸ¨ Aâ‰¡B Î¾âŠ‡ $ âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (defn-wk-âŠ©áµ›â€² Î¾âŠ‡ âŠ©Î”) Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆâ‰¡
          B [ Ïƒâ‚‚ â‚›â€¢ Ï ]  â‰¡Ë˜âŸ¨ subst-wk B âŸ©
          wk Ï B [ Ïƒâ‚‚ ]  âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  wk1-âŠ©áµ›â‰¡ :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© C â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â‰¡ B â†’ Î“ Â»âˆ™ C âŠ©áµ›âŸ¨ l âŸ© wk1 A â‰¡ wk1 B
  wk1-âŠ©áµ›â‰¡ âŠ©C =
    wk-âŠ©áµ›â‰¡ (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©C)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  wk-âŠ©áµ› : Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î— â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© A â†’ âˆ‡ Â» Î— âŠ©áµ›âŸ¨ l âŸ© wk Ï A
  wk-âŠ©áµ› ÏâŠ‡ âŠ©Î— =
    âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ âˆ˜â†’ wk-âŠ©áµ›â‰¡ ÏâŠ‡ âŠ©Î— âˆ˜â†’ âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_.

  wk1-âŠ©áµ› : Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© A â†’ Î“ Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 A
  wk1-âŠ©áµ› âŠ©B =
    wk-âŠ©áµ› (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wk-âŠ©áµ›â‰¡âˆ· :
    Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î— â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    âˆ‡ Â» Î— âŠ©áµ›âŸ¨ l âŸ© wk Ï t â‰¡ wk Ï u âˆ· wk Ï A
  wk-âŠ©áµ›â‰¡âˆ· {Ï} {t} {u} {A} ÏâŠ‡ âŠ©Î— tâ‰¡u =
    case wf-âŠ©áµ›âˆ· $ wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u .projâ‚ of Î»
      âŠ©A â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( wk-âŠ©áµ› ÏâŠ‡ âŠ©Î— âŠ©A
      , Î» {_ _} Î¾âŠ‡ {_ _} {Ïƒâ‚} {Ïƒâ‚‚} Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ in
          wk Ï t [ Ïƒâ‚ ] âˆ· wk Ï A [ Ïƒâ‚ ]  â‰¡âŸ¨ subst-wk t âŸ©âŠ©âˆ·âˆ·â‰¡
                                          âŸ¨ subst-wk A âŸ©âŠ©âˆ·â‰¡
          t [ Ïƒâ‚ â‚›â€¢ Ï ] âˆ· A [ Ïƒâ‚ â‚›â€¢ Ï ]  â‰¡âŸ¨ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) $
                                            âŠ©Ë¢â‰¡âˆ·-â‚›â€¢ ÏâŠ‡ (wf-âŠ©áµ› (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A)) Ïƒâ‚â‰¡Ïƒâ‚‚ âŸ©âŠ©âˆ·âˆâˆ·â‰¡
          u [ Ïƒâ‚‚ â‚›â€¢ Ï ]                  â‰¡Ë˜âŸ¨ subst-wk u âŸ©
          wk Ï u [ Ïƒâ‚‚ ]                  âˆ
      )

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  wk1-âŠ©áµ›â‰¡âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· A â†’
    Î“ Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 t â‰¡ wk1 u âˆ· wk1 A
  wk1-âŠ©áµ›â‰¡âˆ· âŠ©B =
    wk-âŠ©áµ›â‰¡âˆ· (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

opaque

  -- A weakening lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wk-âŠ©áµ›âˆ· :
    Ï âˆ· Î— âŠ‡ Î” â†’ âˆ‡ Â»âŠ©áµ› Î— â†’ âˆ‡ Â» Î” âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’
    âˆ‡ Â» Î— âŠ©áµ›âŸ¨ l âŸ© wk Ï t âˆ· wk Ï A
  wk-âŠ©áµ›âˆ· ÏâŠ‡ âŠ©Î— =
    âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ âˆ˜â†’ wk-âŠ©áµ›â‰¡âˆ· ÏâŠ‡ âŠ©Î— âˆ˜â†’ âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚

opaque

  -- Single-step weakening for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  wk1-âŠ©áµ›âˆ· :
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© B â†’ Î“ âŠ©áµ›âŸ¨ l âŸ© t âˆ· A â†’ Î“ Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© wk1 t âˆ· wk1 A
  wk1-âŠ©áµ›âˆ· âŠ©B =
    wk-âŠ©áµ›âˆ· (TW.step TW.id) (âŠ©áµ›-âˆ™-intro âŠ©B)

------------------------------------------------------------------------
-- Substitution lemmas

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B [ t ]â‚€ â‰¡ C [ u ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ {B} {C} Bâ‰¡C tâ‰¡u =
    case âŠ©áµ›â‰¡âˆ·â‡” .projâ‚ tâ‰¡u of Î»
      (âŠ©A , tâ‰¡u) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( wf-âŠ©áµ› âŠ©A
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’ let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ in
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substConsId B) (substConsId C) $
          âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] (defn-wk-âŠ©áµ›â‰¡ Î¾âŠ‡ Bâ‰¡C) $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚‚ ((_ , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A , tâ‰¡u Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© B [ t ]â‚€
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ âŠ©B âŠ©t =
    âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚€â‰¡[]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©áµ›â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€âˆ· :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t [ u ]â‚€ âˆ· B [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€âˆ· {t} {B} âŠ©t âŠ©u =
    case âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t of Î»
      (âŠ©B , tâ‰¡t) â†’
    âŠ©áµ›âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚€ âŠ©B âŠ©u
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
            (substConsId t) (substConsId t) (substConsId B) $
          tâ‰¡t Î¾âŠ‡ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©B)
            , (_ , âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©u .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚)
            , Ïƒâ‚â‰¡Ïƒâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€ :
    Î“ Â»âˆ™ A Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· B [ tâ‚ ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© Câ‚ [ tâ‚ , uâ‚ ]â‚â‚€ â‰¡ Câ‚‚ [ tâ‚‚ , uâ‚‚ ]â‚â‚€
  âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€ {B} {Câ‚} {Câ‚‚} Câ‚â‰¡Câ‚‚ tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Câ‚â‰¡Câ‚‚ of Î»
      (âŠ©Î“âˆ™Aâˆ™B , Câ‚â‰¡Câ‚‚) â†’
    case wf-âŠ©áµ›-âˆ™ âŠ©Î“âˆ™Aâˆ™B of Î»
      (_ , âŠ©B) â†’
    case wf-âˆ™-âŠ©áµ› âŠ©B of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( wf-âŠ©áµ› âŠ©A
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’ let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ in
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
            (PE.sym $ [,]-[]-fusion Câ‚) (PE.sym $ [,]-[]-fusion Câ‚‚) $
          Câ‚â‰¡Câ‚‚ Î¾âŠ‡ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©B)
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (PE.sym $ substConsId B)
                  (âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ uâ‚â‰¡uâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                ( (_ , defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©A)
                , (_ , âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‚â‰¡tâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚)
                , Ïƒâ‚â‰¡Ïƒâ‚‚
                )
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ :
    Î“ Â»âˆ™ A Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© t âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© u âˆ· B [ t ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© C [ t , u ]â‚â‚€
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€ âŠ©C âŠ©t âŠ©u =
    âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€
      (refl-âŠ©áµ›â‰¡ âŠ©C) (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©áµ›â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€âˆ· :
    Î“ Â»âˆ™ A Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€´ âŸ© vâ‚ â‰¡ vâ‚‚ âˆ· B [ uâ‚ ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© tâ‚ [ uâ‚ , vâ‚ ]â‚â‚€ â‰¡ tâ‚‚ [ uâ‚‚ , vâ‚‚ ]â‚â‚€ âˆ· C [ uâ‚ , vâ‚ ]â‚â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€âˆ· {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ vâ‚â‰¡vâ‚‚ =
    case wf-âŠ©áµ›âˆ· $ wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚ of Î»
      âŠ©C â†’
    case wf-âˆ™-âŠ©áµ› âŠ©C of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€
          âŠ©C (wf-âŠ©áµ›â‰¡âˆ· uâ‚â‰¡uâ‚‚ .projâ‚) (wf-âŠ©áµ›â‰¡âˆ· vâ‚â‰¡vâ‚‚ .projâ‚)
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚
              âŠ©B = defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©B
          in
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ [,]-[]-fusion tâ‚)
            (PE.sym $ [,]-[]-fusion tâ‚‚) (PE.sym $ [,]-[]-fusion C) $
          âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‚â‰¡tâ‚‚) $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( (_ , âŠ©B)
            , ( _
              , (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _)
                   (PE.sym $ substConsId B) $
                 âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ vâ‚â‰¡vâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
                ( wf-âˆ™-âŠ©áµ› âŠ©B
                , (_ , âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ uâ‚â‰¡uâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚)
                , Ïƒâ‚â‰¡Ïƒâ‚‚
                )
            )

      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· :
    Î“ Â»âˆ™ A Â»âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    Î“ âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©áµ›âŸ¨ lâ€³ âŸ© v âˆ· B [ u ]â‚€ â†’
    Î“ âŠ©áµ›âŸ¨ l âŸ© t [ u , v ]â‚â‚€ âˆ· C [ u , v ]â‚â‚€
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â‚â‚€âˆ· âŠ©t âŠ©u âŠ©v =
    âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›[]â‚â‚€â‰¡[]â‚â‚€âˆ·
      (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©áµ›â‰¡âˆ· âŠ©u) (refl-âŠ©áµ›â‰¡âˆ· âŠ©v)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â² :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© D â‰¡ E â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· wk2 A â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ l âŸ© D [ t ]â†‘Â² â‰¡ E [ t ]â†‘Â²
  âŠ©áµ›â‰¡â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â² {A} {D} {E} Dâ‰¡E âŠ©t =
    case âŠ©áµ›â‰¡â‡” .projâ‚ Dâ‰¡E of Î»
      (âŠ©Î“âˆ™A , Dâ‰¡E) â†’
    âŠ©áµ›â‰¡â‡” .projâ‚‚
      ( wf-âŠ©áµ› (wf-âŠ©áµ›âˆ· âŠ©t)
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’
          PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _) (substCompâ†‘Â² D _) (substCompâ†‘Â² E _) $
          Dâ‰¡E Î¾âŠ‡ $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âŠ©áµ›-âˆ™ (defn-wk-âŠ©áµ›â€² Î¾âŠ‡ âŠ©Î“âˆ™A)
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk2-tail A)
                  (âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©t .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© D â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© t âˆ· wk2 A â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ l âŸ© D [ t ]â†‘Â²
  âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² âŠ©D âŠ©t =
    âŠ©áµ›â‡”âŠ©áµ›â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â² (refl-âŠ©áµ›â‰¡ âŠ©D) âŠ©t

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â²âˆ· :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· D â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© v âˆ· wk2 A â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ l âŸ© t [ v ]â†‘Â² â‰¡ u [ v ]â†‘Â² âˆ· D [ v ]â†‘Â²
  âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â²âˆ· {A} {t} {u} {D} tâ‰¡u âŠ©v =
    case wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u .projâ‚) of Î»
      âŠ©D â†’
    âŠ©áµ›â‰¡âˆ·â‡” .projâ‚‚
      ( âŠ©áµ›â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â² âŠ©D âŠ©v
      , Î» Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚ â†’ let Â»âˆ‡â€² = âŠ©Ë¢â‰¡âˆ·â†’Â» Ïƒâ‚â‰¡Ïƒâ‚‚ in
          PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (substCompâ†‘Â² t _) (substCompâ†‘Â² u _)
            (substCompâ†‘Â² D _) $
          âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· (defn-wk-âŠ©áµ›â‰¡âˆ· Î¾âŠ‡ tâ‰¡u) $
          âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
            ( wf-âˆ™-âŠ©áµ› (defn-wk-âŠ©áµ› Î¾âŠ‡ âŠ©D)
            , ( _
              , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (wk2-tail A)
                  (âŠ©áµ›âˆ·â‡” .projâ‚ âŠ©v .projâ‚‚ Î¾âŠ‡ Ïƒâ‚â‰¡Ïƒâ‚‚)
              )
            , âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ (âŠ©Ë¢â‰¡âˆ·âˆ™â‡” .projâ‚ Ïƒâ‚â‰¡Ïƒâ‚‚ .projâ‚‚) .projâ‚‚
            )
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· D â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ lâ€² âŸ© u âˆ· wk2 A â†’
    Î“ Â»âˆ™ B Â»âˆ™ C âŠ©áµ›âŸ¨ l âŸ© t [ u ]â†‘Â² âˆ· D [ u ]â†‘Â²
  âŠ©áµ›âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²âˆ· âŠ©t âŠ©u =
    âŠ©áµ›âˆ·â‡”âŠ©áµ›â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©áµ›âˆ·â†’âŠ©áµ›[]â†‘Â²â‰¡[]â†‘Â²âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) âŠ©u

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â‰¡ C â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© t â‰¡ u âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© B [ t ]â‚€ â‰¡ C [ u ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ Bâ‰¡C tâ‰¡u =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‰¡C .projâ‚) of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] Bâ‰¡C $
    âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A (level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ© âŠ©A) tâ‰¡u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©[]â‚€ :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© t âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© B [ t ]â‚€
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©[]â‚€ âŠ©B âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t â‰¡ u âˆ· B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© v â‰¡ w âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© t [ v ]â‚€ â‰¡ u [ w ]â‚€ âˆ· B [ v ]â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· tâ‰¡u vâ‰¡w =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‰¡u .projâ‚)) of Î»
      (_ , âŠ©A) â†’
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‰¡u $
    âŠ©Ë¢â‰¡âˆ·-sgSubst âŠ©A (level-âŠ©â‰¡âˆ· (âŠ©áµ›â†’âŠ© âŠ©A) vâ‰¡w)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©[]â‚€âˆ· :
    Î“ Â»âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    Î“ âŠ©âŸ¨ lâ€² âŸ© u âˆ· A â†’
    Î“ âŠ©âŸ¨ l âŸ© t [ u ]â‚€ âˆ· B [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©[]â‚€âˆ· âŠ©t âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[]â‚€â‰¡[]â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© Bâ‚ [ consSubst Ïƒâ‚ tâ‚ ] â‰¡ Bâ‚‚ [ consSubst Ïƒâ‚‚ tâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ =
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] Bâ‚â‰¡Bâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚ (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‚â‰¡Bâ‚‚ .projâ‚) , (_ , tâ‚â‰¡tâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© B [ consSubst Ïƒ t ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,] âŠ©B âŠ©Ïƒ âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ) (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© tâ‚ [ consSubst Ïƒâ‚ uâ‚ ] â‰¡ tâ‚‚ [ consSubst Ïƒâ‚‚ uâ‚‚ ] âˆ·
      B [ consSubst Ïƒâ‚ uâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ =
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‚â‰¡tâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· $ wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚) , (_ , uâ‚â‰¡uâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ consSubst Ïƒ u ] âˆ· B [ consSubst Ïƒ u ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[,]âˆ· âŠ©t âŠ©Ïƒ âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒâ‚ ] âŠ©âŸ¨ l âŸ© Bâ‚ [ Ïƒâ‚ â‡‘ ] â‰¡ Bâ‚‚ [ Ïƒâ‚‚ â‡‘ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] Bâ‚â‰¡Bâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Bâ‚â‰¡Bâ‚‚ .projâ‚) .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒ ] âŠ©âŸ¨ l âŸ© B [ Ïƒ â‡‘ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘] âŠ©B âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘] (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒâ‚ ] âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ ] âˆ· B [ Ïƒâ‚ â‡‘ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‚â‰¡tâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) .projâ‚‚)
      Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒ ] âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ ] âˆ· B [ Ïƒ â‡‘ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘]âˆ· âŠ©t âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘]â‰¡[â‡‘]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒâ‚ ] âˆ™ B [ Ïƒâ‚ â‡‘ ] âŠ©âŸ¨ l âŸ© Câ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] â‰¡ Câ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ]
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Câ‚â‰¡Câ‚‚ .projâ‚) of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[] Câ‚â‰¡Câ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©B $ âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› âŠ©B .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘] :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒ ] âˆ™ B [ Ïƒ â‡‘ ] âŠ©âŸ¨ l âŸ© C [ Ïƒ â‡‘ â‡‘ ]
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘] âŠ©C âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $ âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘] (refl-âŠ©áµ›â‰¡ âŠ©C) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒâ‚ ] âˆ™ B [ Ïƒâ‚ â‡‘ ] âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] âˆ·
      C [ Ïƒâ‚ â‡‘ â‡‘ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) of Î»
      (_ , âŠ©B) â†’
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‚â‰¡tâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·-liftSubst âŠ©B $ âŠ©Ë¢â‰¡âˆ·-liftSubst (wf-âˆ™-âŠ©áµ› âŠ©B .projâ‚‚) Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âˆ™ A [ Ïƒ ] âˆ™ B [ Ïƒ â‡‘ ] âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ â‡‘ ] âˆ· C [ Ïƒ â‡‘ â‡‘ ]
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[â‡‘â‡‘]âˆ· âŠ©t âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $ âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[â‡‘â‡‘]â‰¡[â‡‘â‡‘]âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© Bâ‚ [ Ïƒâ‚ â‡‘ ] [ tâ‚ ]â‚€ â‰¡ Bâ‚‚ [ Ïƒâ‚‚ â‡‘ ] [ tâ‚‚ ]â‚€
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ {Bâ‚} {Bâ‚‚} Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ singleSubstComp _ _ Bâ‚)
      (PE.sym $ singleSubstComp _ _ Bâ‚‚) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€ :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© B [ Ïƒ â‡‘ ] [ t ]â‚€
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€ âŠ©B âŠ©Ïƒ âŠ©t =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©t)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€ â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ ] [ uâ‚‚ ]â‚€ âˆ·
      B [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· {tâ‚} {tâ‚‚} {B} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
      (PE.sym $ singleSubstComp _ _ tâ‚)
      (PE.sym $ singleSubstComp _ _ tâ‚‚)
      (PE.sym $ singleSubstComp _ _ B) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,]âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ ] [ u ]â‚€ âˆ· B [ Ïƒ â‡‘ ] [ u ]â‚€
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘][]â‚€âˆ· âŠ©t âŠ©Ïƒ âŠ©u =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© Bâ‚ â‰¡ Bâ‚‚ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© tâ‚ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© Bâ‚ [ tâ‚ ]â‚€ [ Ïƒâ‚ ] â‰¡ Bâ‚‚ [ tâ‚‚ ]â‚€ [ Ïƒâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] {Bâ‚} {Bâ‚‚} Bâ‚â‰¡Bâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ singleSubstLift Bâ‚ _)
      (PE.sym $ singleSubstLift Bâ‚‚ _) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€ Bâ‚â‰¡Bâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚]

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[] :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© B â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© B [ t ]â‚€ [ Ïƒ ]
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[] {t} âŠ©B âŠ©t[Ïƒ] âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[] {tâ‚‚ = t} (refl-âŠ©áµ›â‰¡ âŠ©B) (refl-âŠ©â‰¡âˆ· âŠ©t[Ïƒ])
      (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· B â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© tâ‚ [ uâ‚ ]â‚€ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ uâ‚‚ ]â‚€ [ Ïƒâ‚‚ ] âˆ·
      B [ uâ‚ ]â‚€ [ Ïƒâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· {tâ‚} {tâ‚‚} {B} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ singleSubstLift tâ‚ _)
      (PE.sym $ singleSubstLift tâ‚‚ _) (PE.sym $ singleSubstLift B _) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘][]â‚€â‰¡[â‡‘][]â‚€âˆ· tâ‚â‰¡tâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âŠ©áµ›âŸ¨ l âŸ© t âˆ· B â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© u [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ u ]â‚€ [ Ïƒ ] âˆ· B [ u ]â‚€ [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚€[]âˆ· {u} âŠ©t âŠ©u[Ïƒ] âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚€[]â‰¡[]â‚€[]âˆ· {uâ‚‚ = u} (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ])
      (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· B [ Ïƒâ‚ â‡‘ ] [ tâ‚ ]â‚€ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© Câ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] [ tâ‚ , uâ‚ ]â‚â‚€ â‰¡
      Câ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] [ tâ‚‚ , uâ‚‚ ]â‚â‚€
  âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€
    {B} {Câ‚} {Câ‚‚} Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚â‰¡tâ‚‚ uâ‚â‰¡uâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ doubleSubstComp Câ‚ _ _ _)
      (PE.sym $ doubleSubstComp Câ‚‚ _ _ _) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[,]â‰¡[,] Câ‚â‰¡Câ‚‚
      (âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
         ( wf-âˆ™-âŠ©áµ› (wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›â‰¡ Câ‚â‰¡Câ‚‚ .projâ‚) .projâ‚‚)
         , (_ , tâ‚â‰¡tâ‚‚)
         , Ïƒâ‚â‰¡Ïƒâ‚‚
         )) $
    PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstComp _ _ B) uâ‚â‰¡uâ‚‚

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€ :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© t âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© u âˆ· B [ Ïƒ â‡‘ ] [ t ]â‚€ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© C [ Ïƒ â‡‘ â‡‘ ] [ t , u ]â‚â‚€
  âŠ©áµ›â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€ âŠ©C âŠ©Ïƒ âŠ©t âŠ©u =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ (refl-âŠ©áµ›â‰¡ âŠ©C) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©t) (refl-âŠ©â‰¡âˆ· âŠ©u)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© uâ‚ â‰¡ uâ‚‚ âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© vâ‚ â‰¡ vâ‚‚ âˆ· B [ Ïƒâ‚ â‡‘ ] [ uâ‚ ]â‚€ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© tâ‚ [ Ïƒâ‚ â‡‘ â‡‘ ] [ uâ‚ , vâ‚ ]â‚â‚€ â‰¡ tâ‚‚ [ Ïƒâ‚‚ â‡‘ â‡‘ ] [ uâ‚‚ , vâ‚‚ ]â‚â‚€ âˆ·
      C [ Ïƒâ‚ â‡‘ â‡‘ ] [ uâ‚ , vâ‚ ]â‚â‚€
  âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ·
    {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚â‰¡uâ‚‚ vâ‚â‰¡vâ‚‚ =
    case wf-âˆ™-âŠ©áµ› (wf-âŠ©áµ›âˆ· (wf-âŠ©áµ›â‰¡âˆ· tâ‚â‰¡tâ‚‚ .projâ‚)) of Î»
      (_ , âŠ©B) â†’
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _)
      (PE.sym $ doubleSubstComp tâ‚ _ _ _)
      (PE.sym $ doubleSubstComp tâ‚‚ _ _ _)
      (PE.sym $ doubleSubstComp C _ _ _) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‰¡[]âˆ· tâ‚â‰¡tâ‚‚ $
    âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚
      ( (_ , âŠ©B)
      , ( _
        , PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstComp _ _ B) vâ‚â‰¡vâ‚‚
        )
      , âŠ©Ë¢â‰¡âˆ·âˆ™â‡”â€² .projâ‚‚ (wf-âˆ™-âŠ©áµ› âŠ©B , (_ , uâ‚â‰¡uâ‚‚) , Ïƒâ‚â‰¡Ïƒâ‚‚)
      )

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© u âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© v âˆ· B [ Ïƒ â‡‘ ] [ u ]â‚€ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ Ïƒ â‡‘ â‡‘ ] [ u , v ]â‚â‚€ âˆ· C [ Ïƒ â‡‘ â‡‘ ] [ u , v ]â‚â‚€
  âŠ©áµ›âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€âˆ· âŠ©t âŠ©Ïƒ âŠ©u âŠ©v =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· (refl-âŠ©áµ›â‰¡âˆ· âŠ©t) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
      (refl-âŠ©â‰¡âˆ· âŠ©u) (refl-âŠ©â‰¡âˆ· âŠ©v)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_ and _âŠ©âŸ¨_âŸ©_â‰¡_.

  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[] :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© Câ‚ â‰¡ Câ‚‚ â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© tâ‚ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· B [ tâ‚ ]â‚€ [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© Câ‚ [ tâ‚ , uâ‚ ]â‚â‚€ [ Ïƒâ‚ ] â‰¡ Câ‚‚ [ tâ‚‚ , uâ‚‚ ]â‚â‚€ [ Ïƒâ‚‚ ]
  âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]
    {B} {Câ‚} {Câ‚‚} Câ‚â‰¡Câ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚] uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚‚ (_âŠ©âŸ¨_âŸ©_â‰¡_ _ _)
      (PE.sym $ [,]-[]-commute Câ‚)
      (PE.sym $ [,]-[]-commute Câ‚‚) $
    âŠ©áµ›â‰¡â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€ Câ‚â‰¡Câ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ tâ‚[Ïƒâ‚]â‰¡tâ‚‚[Ïƒâ‚‚]
      (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstLift B _)
         uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚])

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_ and _âŠ©âŸ¨_âŸ©_.

  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[] :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© C â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© t [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© u [ Ïƒ ] âˆ· B [ t ]â‚€ [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© C [ t , u ]â‚â‚€ [ Ïƒ ]
  âŠ©áµ›â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[] {t} {u} âŠ©C âŠ©t[Ïƒ] âŠ©u[Ïƒ] âŠ©Ïƒ =
    âŠ©â‡”âŠ©â‰¡ .projâ‚‚ $
    âŠ©áµ›â‰¡â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[] {tâ‚‚ = t} {uâ‚‚ = u} (refl-âŠ©áµ›â‰¡ âŠ©C)
      (refl-âŠ©â‰¡âˆ· âŠ©t[Ïƒ]) (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ]) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_â‰¡_âˆ·_ and _âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_.

  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© tâ‚ â‰¡ tâ‚‚ âˆ· C â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© uâ‚ [ Ïƒâ‚ ] â‰¡ uâ‚‚ [ Ïƒâ‚‚ ] âˆ· A [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© vâ‚ [ Ïƒâ‚ ] â‰¡ vâ‚‚ [ Ïƒâ‚‚ ] âˆ· B [ uâ‚ ]â‚€ [ Ïƒâ‚ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒâ‚ â‰¡ Ïƒâ‚‚ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© tâ‚ [ uâ‚ , vâ‚ ]â‚â‚€ [ Ïƒâ‚ ] â‰¡ tâ‚‚ [ uâ‚‚ , vâ‚‚ ]â‚â‚€ [ Ïƒâ‚‚ ] âˆ·
      C [ uâ‚ , vâ‚ ]â‚â‚€ [ Ïƒâ‚ ]
  âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ·
    {B} {tâ‚} {tâ‚‚} {C} tâ‚â‰¡tâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚] vâ‚[Ïƒâ‚]â‰¡vâ‚‚[Ïƒâ‚‚] Ïƒâ‚â‰¡Ïƒâ‚‚ =
    PE.substâ‚ƒ (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _) (PE.sym $ [,]-[]-commute tâ‚)
      (PE.sym $ [,]-[]-commute tâ‚‚) (PE.sym $ [,]-[]-commute C) $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©[â‡‘â‡‘][]â‚â‚€â‰¡[â‡‘â‡‘][]â‚â‚€âˆ· tâ‚â‰¡tâ‚‚ Ïƒâ‚â‰¡Ïƒâ‚‚ uâ‚[Ïƒâ‚]â‰¡uâ‚‚[Ïƒâ‚‚]
      (PE.subst (_âŠ©âŸ¨_âŸ©_â‰¡_âˆ·_ _ _ _ _) (singleSubstLift B _)
         vâ‚[Ïƒâ‚]â‰¡vâ‚‚[Ïƒâ‚‚])

opaque

  -- A substitution lemma for _âŠ©áµ›âŸ¨_âŸ©_âˆ·_ and _âŠ©âŸ¨_âŸ©_âˆ·_.

  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[]âˆ· :
    âˆ‡ Â» Î” âˆ™ A âˆ™ B âŠ©áµ›âŸ¨ l âŸ© t âˆ· C â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€² âŸ© u [ Ïƒ ] âˆ· A [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ lâ€³ âŸ© v [ Ïƒ ] âˆ· B [ u ]â‚€ [ Ïƒ ] â†’
    âˆ‡ Â» Î— âŠ©Ë¢ Ïƒ âˆ· Î” â†’
    âˆ‡ Â» Î— âŠ©âŸ¨ l âŸ© t [ u , v ]â‚â‚€ [ Ïƒ ] âˆ· C [ u , v ]â‚â‚€ [ Ïƒ ]
  âŠ©áµ›âˆ·â†’âŠ©âˆ·â†’âŠ©âˆ·â†’âŠ©Ë¢âˆ·â†’âŠ©[]â‚â‚€[]âˆ· {u} {v} âŠ©t âŠ©u[Ïƒ] âŠ©v[Ïƒ] âŠ©Ïƒ =
    âŠ©âˆ·â‡”âŠ©â‰¡âˆ· .projâ‚‚ $
    âŠ©áµ›â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©â‰¡âˆ·â†’âŠ©Ë¢â‰¡âˆ·â†’âŠ©[]â‚â‚€[]â‰¡[]â‚â‚€[]âˆ· {uâ‚‚ = u} {vâ‚‚ = v} (refl-âŠ©áµ›â‰¡âˆ· âŠ©t)
      (refl-âŠ©â‰¡âˆ· âŠ©u[Ïƒ]) (refl-âŠ©â‰¡âˆ· âŠ©v[Ïƒ]) (refl-âŠ©Ë¢â‰¡âˆ· âŠ©Ïƒ)
